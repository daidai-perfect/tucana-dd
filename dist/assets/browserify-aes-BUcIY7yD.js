import{b as k}from"./buffer-xor-De43xBeM.js";import{s as m}from"./safe-buffer-B7h8REzA.js";import{B as Ae}from"./vite-plugin-node-polyfills-2b3IylRN.js";import{c as R}from"./cipher-base-7AdYGBPO.js";import{i as N}from"./inherits-BlmhoU4v.js";import{e as te}from"./evp_bytestokey-Dyx8YxuJ.js";var d={},P={},q={};q.encrypt=function(e,t){return e._cipher.encryptBlock(t)};q.decrypt=function(e,t){return e._cipher.decryptBlock(t)};var Z={},re=k;Z.encrypt=function(e,t){var r=re(t,e._prev);return e._prev=e._cipher.encryptBlock(r),e._prev};Z.decrypt=function(e,t){var r=e._prev;e._prev=t;var a=e._cipher.decryptBlock(t);return re(a,r)};var ae={},I=m.Buffer,Ue=k;function Y(e,t,r){var a=t.length,i=Ue(t,e._cache);return e._cache=e._cache.slice(a),e._prev=I.concat([e._prev,r?t:i]),i}ae.encrypt=function(e,t,r){for(var a=I.allocUnsafe(0),i;t.length;)if(e._cache.length===0&&(e._cache=e._cipher.encryptBlock(e._prev),e._prev=I.allocUnsafe(0)),e._cache.length<=t.length)i=e._cache.length,a=I.concat([a,Y(e,t.slice(0,i),r)]),t=t.slice(i);else{a=I.concat([a,Y(e,t,r)]);break}return a};var ie={},K=m.Buffer;function Ie(e,t,r){var a=e._cipher.encryptBlock(e._prev),i=a[0]^t;return e._prev=K.concat([e._prev.slice(1),K.from([r?t:i])]),i}ie.encrypt=function(e,t,r){for(var a=t.length,i=K.allocUnsafe(a),c=-1;++c<a;)i[c]=Ie(e,t[c],r);return i};var ce={},D=m.Buffer;function ke(e,t,r){for(var a,i=-1,c=8,n=0,h,p;++i<c;)a=e._cipher.encryptBlock(e._prev),h=t&1<<7-i?128:0,p=a[0]^h,n+=(p&128)>>i%8,e._prev=xe(e._prev,r?h:p);return n}function xe(e,t){var r=e.length,a=-1,i=D.allocUnsafe(e.length);for(e=D.concat([e,D.from([t])]);++a<r;)i[a]=e[a]<<1|e[a+1]>>7;return i}ce.encrypt=function(e,t,r){for(var a=t.length,i=D.allocUnsafe(a),c=-1;++c<a;)i[c]=ke(e,t[c],r);return i};var ne={},be=k;function $e(e){return e._prev=e._cipher.encryptBlock(e._prev),e._prev}ne.encrypt=function(e,t){for(;e._cache.length<t.length;)e._cache=Ae.concat([e._cache,$e(e)]);var r=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),be(t,r)};var L={};function Te(e){for(var t=e.length,r;t--;)if(r=e.readUInt8(t),r===255)e.writeUInt8(0,t);else{r++,e.writeUInt8(r,t);break}}var he=Te,De=k,j=m.Buffer,Fe=he;function Xe(e){var t=e._cipher.encryptBlockRaw(e._prev);return Fe(e._prev),t}var G=16;L.encrypt=function(e,t){var r=Math.ceil(t.length/G),a=e._cache.length;e._cache=j.concat([e._cache,j.allocUnsafe(r*G)]);for(var i=0;i<r;i++){var c=Xe(e),n=a+i*G;e._cache.writeUInt32BE(c[0],n+0),e._cache.writeUInt32BE(c[1],n+4),e._cache.writeUInt32BE(c[2],n+8),e._cache.writeUInt32BE(c[3],n+12)}var h=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),De(t,h)};const Re={cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},Ne={cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},Ve={cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},oe={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128:Re,aes192:Ne,aes256:Ve,"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}};var Oe={ECB:q,CBC:Z,CFB:ae,CFB8:ie,CFB1:ce,OFB:ne,CTR:L,GCM:L},F=oe;for(var ee in F)F[ee].module=Oe[F[ee].mode];var pe=F,x={},X=m.Buffer;function W(e){X.isBuffer(e)||(e=X.from(e));for(var t=e.length/4|0,r=new Array(t),a=0;a<t;a++)r[a]=e.readUInt32BE(a*4);return r}function z(e){for(var t=0;t<e.length;e++)e[t]=0}function se(e,t,r,a,i){for(var c=r[0],n=r[1],h=r[2],p=r[3],o=e[0]^t[0],f=e[1]^t[1],l=e[2]^t[2],_=e[3]^t[3],s,w,C,S,B=4,Q=1;Q<i;Q++)s=c[o>>>24]^n[f>>>16&255]^h[l>>>8&255]^p[_&255]^t[B++],w=c[f>>>24]^n[l>>>16&255]^h[_>>>8&255]^p[o&255]^t[B++],C=c[l>>>24]^n[_>>>16&255]^h[o>>>8&255]^p[f&255]^t[B++],S=c[_>>>24]^n[o>>>16&255]^h[f>>>8&255]^p[l&255]^t[B++],o=s,f=w,l=C,_=S;return s=(a[o>>>24]<<24|a[f>>>16&255]<<16|a[l>>>8&255]<<8|a[_&255])^t[B++],w=(a[f>>>24]<<24|a[l>>>16&255]<<16|a[_>>>8&255]<<8|a[o&255])^t[B++],C=(a[l>>>24]<<24|a[_>>>16&255]<<16|a[o>>>8&255]<<8|a[f&255])^t[B++],S=(a[_>>>24]<<24|a[o>>>16&255]<<16|a[f>>>8&255]<<8|a[l&255])^t[B++],s=s>>>0,w=w>>>0,C=C>>>0,S=S>>>0,[s,w,C,S]}var Me=[0,1,2,4,8,16,32,64,128,27,54],v=function(){for(var e=new Array(256),t=0;t<256;t++)t<128?e[t]=t<<1:e[t]=t<<1^283;for(var r=[],a=[],i=[[],[],[],[]],c=[[],[],[],[]],n=0,h=0,p=0;p<256;++p){var o=h^h<<1^h<<2^h<<3^h<<4;o=o>>>8^o&255^99,r[n]=o,a[o]=n;var f=e[n],l=e[f],_=e[l],s=e[o]*257^o*16843008;i[0][n]=s<<24|s>>>8,i[1][n]=s<<16|s>>>16,i[2][n]=s<<8|s>>>24,i[3][n]=s,s=_*16843009^l*65537^f*257^n*16843008,c[0][o]=s<<24|s>>>8,c[1][o]=s<<16|s>>>16,c[2][o]=s<<8|s>>>24,c[3][o]=s,n===0?n=h=1:(n=f^e[e[e[_^f]]],h^=e[e[h]])}return{SBOX:r,INV_SBOX:a,SUB_MIX:i,INV_SUB_MIX:c}}();function y(e){this._key=W(e),this._reset()}y.blockSize=4*4;y.keySize=256/8;y.prototype.blockSize=y.blockSize;y.prototype.keySize=y.keySize;y.prototype._reset=function(){for(var e=this._key,t=e.length,r=t+6,a=(r+1)*4,i=[],c=0;c<t;c++)i[c]=e[c];for(c=t;c<a;c++){var n=i[c-1];c%t===0?(n=n<<8|n>>>24,n=v.SBOX[n>>>24]<<24|v.SBOX[n>>>16&255]<<16|v.SBOX[n>>>8&255]<<8|v.SBOX[n&255],n^=Me[c/t|0]<<24):t>6&&c%t===4&&(n=v.SBOX[n>>>24]<<24|v.SBOX[n>>>16&255]<<16|v.SBOX[n>>>8&255]<<8|v.SBOX[n&255]),i[c]=i[c-t]^n}for(var h=[],p=0;p<a;p++){var o=a-p,f=i[o-(p%4?0:4)];p<4||o<=4?h[p]=f:h[p]=v.INV_SUB_MIX[0][v.SBOX[f>>>24]]^v.INV_SUB_MIX[1][v.SBOX[f>>>16&255]]^v.INV_SUB_MIX[2][v.SBOX[f>>>8&255]]^v.INV_SUB_MIX[3][v.SBOX[f&255]]}this._nRounds=r,this._keySchedule=i,this._invKeySchedule=h};y.prototype.encryptBlockRaw=function(e){return e=W(e),se(e,this._keySchedule,v.SUB_MIX,v.SBOX,this._nRounds)};y.prototype.encryptBlock=function(e){var t=this.encryptBlockRaw(e),r=X.allocUnsafe(16);return r.writeUInt32BE(t[0],0),r.writeUInt32BE(t[1],4),r.writeUInt32BE(t[2],8),r.writeUInt32BE(t[3],12),r};y.prototype.decryptBlock=function(e){e=W(e);var t=e[1];e[1]=e[3],e[3]=t;var r=se(e,this._invKeySchedule,v.INV_SUB_MIX,v.INV_SBOX,this._nRounds),a=X.allocUnsafe(16);return a.writeUInt32BE(r[0],0),a.writeUInt32BE(r[3],4),a.writeUInt32BE(r[2],8),a.writeUInt32BE(r[1],12),a};y.prototype.scrub=function(){z(this._keySchedule),z(this._invKeySchedule),z(this._key)};x.AES=y;var A=m.Buffer,Ge=A.alloc(16,0);function ze(e){return[e.readUInt32BE(0),e.readUInt32BE(4),e.readUInt32BE(8),e.readUInt32BE(12)]}function fe(e){var t=A.allocUnsafe(16);return t.writeUInt32BE(e[0]>>>0,0),t.writeUInt32BE(e[1]>>>0,4),t.writeUInt32BE(e[2]>>>0,8),t.writeUInt32BE(e[3]>>>0,12),t}function b(e){this.h=e,this.state=A.alloc(16,0),this.cache=A.allocUnsafe(0)}b.prototype.ghash=function(e){for(var t=-1;++t<e.length;)this.state[t]^=e[t];this._multiply()};b.prototype._multiply=function(){for(var e=ze(this.h),t=[0,0,0,0],r,a,i,c=-1;++c<128;){for(a=(this.state[~~(c/8)]&1<<7-c%8)!==0,a&&(t[0]^=e[0],t[1]^=e[1],t[2]^=e[2],t[3]^=e[3]),i=(e[3]&1)!==0,r=3;r>0;r--)e[r]=e[r]>>>1|(e[r-1]&1)<<31;e[0]=e[0]>>>1,i&&(e[0]=e[0]^225<<24)}this.state=fe(t)};b.prototype.update=function(e){this.cache=A.concat([this.cache,e]);for(var t;this.cache.length>=16;)t=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(t)};b.prototype.final=function(e,t){return this.cache.length&&this.ghash(A.concat([this.cache,Ge],16)),this.ghash(fe([0,e,0,t])),this.state};var He=b,Ke=x,u=m.Buffer,ve=R,Le=N,ue=He,Pe=k,qe=he;function Ze(e,t){var r=0;e.length!==t.length&&r++;for(var a=Math.min(e.length,t.length),i=0;i<a;++i)r+=e[i]^t[i];return r}function We(e,t,r){if(t.length===12)return e._finID=u.concat([t,u.from([0,0,0,1])]),u.concat([t,u.from([0,0,0,2])]);var a=new ue(r),i=t.length,c=i%16;a.update(t),c&&(c=16-c,a.update(u.alloc(c,0))),a.update(u.alloc(8,0));var n=i*8,h=u.alloc(8);h.writeUIntBE(n,0,8),a.update(h),e._finID=a.state;var p=u.from(e._finID);return qe(p),p}function E(e,t,r,a){ve.call(this);var i=u.alloc(4,0);this._cipher=new Ke.AES(t);var c=this._cipher.encryptBlock(i);this._ghash=new ue(c),r=We(this,r,c),this._prev=u.from(r),this._cache=u.allocUnsafe(0),this._secCache=u.allocUnsafe(0),this._decrypt=a,this._alen=0,this._len=0,this._mode=e,this._authTag=null,this._called=!1}Le(E,ve);E.prototype._update=function(e){if(!this._called&&this._alen){var t=16-this._alen%16;t<16&&(t=u.alloc(t,0),this._ghash.update(t))}this._called=!0;var r=this._mode.encrypt(this,e);return this._decrypt?this._ghash.update(e):this._ghash.update(r),this._len+=e.length,r};E.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var e=Pe(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID));if(this._decrypt&&Ze(e,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=e,this._cipher.scrub()};E.prototype.getAuthTag=function(){if(this._decrypt||!u.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag};E.prototype.setAuthTag=function(t){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=t};E.prototype.setAAD=function(t){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(t),this._alen+=t.length};var le=E,Je=x,H=m.Buffer,_e=R,Qe=N;function V(e,t,r,a){_e.call(this),this._cipher=new Je.AES(t),this._prev=H.from(r),this._cache=H.allocUnsafe(0),this._secCache=H.allocUnsafe(0),this._decrypt=a,this._mode=e}Qe(V,_e);V.prototype._update=function(e){return this._mode.encrypt(this,e,this._decrypt)};V.prototype._final=function(){this._cipher.scrub()};var ye=V,de=pe,Ye=le,g=m.Buffer,je=ye,me=R,et=x,tt=te,rt=N;function $(e,t,r){me.call(this),this._cache=new O,this._cipher=new et.AES(t),this._prev=g.from(r),this._mode=e,this._autopadding=!0}rt($,me);$.prototype._update=function(e){this._cache.add(e);for(var t,r,a=[];t=this._cache.get();)r=this._mode.encrypt(this,t),a.push(r);return g.concat(a)};var at=g.alloc(16,16);$.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return e=this._mode.encrypt(this,e),this._cipher.scrub(),e;if(!e.equals(at))throw this._cipher.scrub(),new Error("data not multiple of block length")};$.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this};function O(){this.cache=g.allocUnsafe(0)}O.prototype.add=function(e){this.cache=g.concat([this.cache,e])};O.prototype.get=function(){if(this.cache.length>15){var e=this.cache.slice(0,16);return this.cache=this.cache.slice(16),e}return null};O.prototype.flush=function(){for(var e=16-this.cache.length,t=g.allocUnsafe(e),r=-1;++r<e;)t.writeUInt8(e,r);return g.concat([this.cache,t])};function ge(e,t,r){var a=de[e.toLowerCase()];if(!a)throw new TypeError("invalid suite type");if(typeof t=="string"&&(t=g.from(t)),t.length!==a.key/8)throw new TypeError("invalid key length "+t.length);if(typeof r=="string"&&(r=g.from(r)),a.mode!=="GCM"&&r.length!==a.iv)throw new TypeError("invalid iv length "+r.length);return a.type==="stream"?new je(a.module,t,r):a.type==="auth"?new Ye(a.module,t,r):new $(a.module,t,r)}function it(e,t){var r=de[e.toLowerCase()];if(!r)throw new TypeError("invalid suite type");var a=tt(t,!1,r.key,r.iv);return ge(e,a.key,a.iv)}P.createCipheriv=ge;P.createCipher=it;var J={},ct=le,U=m.Buffer,Be=pe,nt=ye,Ee=R,ht=x,ot=te,pt=N;function T(e,t,r){Ee.call(this),this._cache=new M,this._last=void 0,this._cipher=new ht.AES(t),this._prev=U.from(r),this._mode=e,this._autopadding=!0}pt(T,Ee);T.prototype._update=function(e){this._cache.add(e);for(var t,r,a=[];t=this._cache.get(this._autopadding);)r=this._mode.decrypt(this,t),a.push(r);return U.concat(a)};T.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return st(this._mode.decrypt(this,e));if(e)throw new Error("data not multiple of block length")};T.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this};function M(){this.cache=U.allocUnsafe(0)}M.prototype.add=function(e){this.cache=U.concat([this.cache,e])};M.prototype.get=function(e){var t;if(e){if(this.cache.length>16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t}else if(this.cache.length>=16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t;return null};M.prototype.flush=function(){if(this.cache.length)return this.cache};function st(e){var t=e[15];if(t<1||t>16)throw new Error("unable to decrypt data");for(var r=-1;++r<t;)if(e[r+(16-t)]!==t)throw new Error("unable to decrypt data");if(t!==16)return e.slice(0,16-t)}function we(e,t,r){var a=Be[e.toLowerCase()];if(!a)throw new TypeError("invalid suite type");if(typeof r=="string"&&(r=U.from(r)),a.mode!=="GCM"&&r.length!==a.iv)throw new TypeError("invalid iv length "+r.length);if(typeof t=="string"&&(t=U.from(t)),t.length!==a.key/8)throw new TypeError("invalid key length "+t.length);return a.type==="stream"?new nt(a.module,t,r,!0):a.type==="auth"?new ct(a.module,t,r,!0):new T(a.module,t,r)}function ft(e,t){var r=Be[e.toLowerCase()];if(!r)throw new TypeError("invalid suite type");var a=ot(t,!1,r.key,r.iv);return we(e,a.key,a.iv)}J.createDecipher=ft;J.createDecipheriv=we;var Ce=P,Se=J,vt=oe;function ut(){return Object.keys(vt)}d.createCipher=d.Cipher=Ce.createCipher;d.createCipheriv=d.Cipheriv=Ce.createCipheriv;d.createDecipher=d.Decipher=Se.createDecipher;d.createDecipheriv=d.Decipheriv=Se.createDecipheriv;d.listCiphers=d.getCiphers=ut;export{d as b,pe as m};
