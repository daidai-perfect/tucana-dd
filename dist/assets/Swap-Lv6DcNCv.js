import{u as Z,r as g,j as e,M as He,a as We,b as qe,c as Je,d as Le,e as Ie,V as Y,F as q,C as Ge,H as ee,I as T,T as F,B as xe,f as X,g as Ye,h as he,i as Q,s as Ke,k as it,l as ot,S as ne,m as lt,n as ut,o as Be,p as Ce,q as Xe,t as I,R as dt,v as D,w as pt,N as xt,x as ht,y as gt,z as mt,L as St,A as Ue,P as ft,D as jt,E as Qe,G as wt,J as yt,K as Ct,O as bt,Q as Rt,U as se,W as we,X as Ze,Y as Mt,Z as vt,_ as Pt,$ as At,a0 as Ot,a1 as _t,a2 as Dt,a3 as pe,a4 as Et,a5 as Nt,a6 as $t,a7 as Bt,a8 as Ut}from"./index-BAe5U5I_.js";import{T as Fe,S as Ft}from"./SlippageSetting-B8ij9vhE.js";import{A as Vt,X as zt,Y as Ht,a as Wt}from"./AreaChart-B2MXLoiw.js";import{g as qt}from"./apiDataProcessing-D5YcVfO5.js";import{u as Ve}from"./useGetBalance-DaI529vc.js";import{u as Jt}from"./useGetTokenInfo-D6eTvf3M.js";function Lt(s){const{isOpen:t,slippageTolerance:n,receiveOrSoldText:R,receiveOrSoldValue:d,priceIsUpdate:f,handleAccept:l,onClose:p,onClick:r,clearWatchPriceTimer:i,watchPriceUpdated:x}=s,{fromToken:c,toToken:u,fromValue:o,toValue:b,priceImpact:_,feeAmount:j}=Z();g.useEffect(()=>{console.log("SwapSecondaryModal did mounted"),x()},[]),g.useEffect(()=>()=>{console.log("SwapSecondaryModal destory"),i()},[]);const y=async()=>{i(),await l(),await Ke(1e4),x()};return e.jsxs(He,{isOpen:t,onClose:p,isCentered:!0,children:[e.jsx(We,{}),e.jsxs(qe,{children:[e.jsx(Je,{children:"Review Swap"}),e.jsx(Le,{}),e.jsx(Ie,{pb:"16px",children:e.jsxs(Y,{w:"100%",children:[e.jsx(ze,{title:"You pay",token:c,value:o}),e.jsx(ze,{title:"You receive",token:u,value:b}),e.jsx(q,{w:"100%",bg:"current_price_bg",borderRadius:"8px",h:"50px",p:"12px",alignItems:"center",children:e.jsx(Ge,{fromToken:c,toToken:u,fromValue:o,toValue:b,color:"text_caption",noIcon:!0,noCenter:!0})}),f?e.jsxs(q,{mt:"16px",w:"100%",align:"center",justifyContent:"space-between",children:[e.jsxs(ee,{gap:"4px",children:[e.jsx(T,{xlinkHref:"#icon-icon_tips2"}),e.jsx(F,{color:"text_caption",children:"Price Updated"})]}),e.jsx(xe,{borderRadius:"8px",w:"112px",h:"36px",onClick:y,children:"Accept"})]}):null,e.jsxs(Y,{mt:"16px",w:"100%",gap:"0",children:[e.jsx(X,{text:"Slippage Tolerance",value:n}),e.jsx(X,{text:R,value:d,mt:"12px"}),e.jsx(X,{text:"Price lmpact",value:Ye(_,2),mt:"12px",valueColor:he(_),iconVariant:"error",iconXlinkHref:he(_)==="error"?"#icon-a-icon_tips_triangle":""}),e.jsx(X,{text:"Fees",value:`${Q(j,c==null?void 0:c.decimals)} ${c==null?void 0:c.symbol}`,mt:"12px"})]}),e.jsx(xe,{isDisabled:f,w:"100%",mt:"20px",size:"lg",onClick:r,children:"Confirm swap"})]})})]})]})}function ze(s){const{title:t,token:n,value:R}=s;return e.jsx(it,{width:"100%",p:"0px 0px 30px",backgroundColor:"background",children:e.jsx(ot,{children:e.jsxs(q,{width:"100%",alignItems:"center",justifyContent:"space-between",gap:"8px",children:[e.jsxs(Y,{w:"100%",align:"flex-start",children:[e.jsx(F,{fontSize:"sm",style:{cursor:"pointer"},children:t}),e.jsxs(F,{w:"100%",color:"text_caption",textAlign:"left",fontSize:"xl",style:{cursor:"pointer"},maxW:"350px",children:[Q(R,n==null?void 0:n.decimals)," ",n==null?void 0:n.symbol]})]}),e.jsx(ne,{imageUrl:n==null?void 0:n.image})]})})})}function It(){const{tokenPriceChartInfo:s,setTokenPriceChartInfo:t}=Z(),n=lt(ut),[R,d]=g.useState(!1),f=async(l,p,r)=>{const i=l=="hour"?"5min":l=="day"?"30min":l=="week"?"4hour":l=="month"?"day":"";console.log("ðŸš€ ~ getChartInfo ~ metadata:",p,s),d(!0);try{const x=r?await Be(`${n}?metadata=${p}&date_type=${i}&start_timestamp=${r}`):await Be(`${n}?metadata=${p}&date_type=${i}`);if(console.log("response171717",x==null?void 0:x.list),!r)console.log("ðŸš€ ~ getChartInfo ~ startTimestamp!startTimestamp:",r),t(l,p,x==null?void 0:x.list);else{const c=JSON.parse(JSON.stringify(s&&s[l]&&s[l][p]));c[0].timestamp==r&&(console.log("ðŸš€ ~ getChartInfo ~ list[0].timestamp == startTimestamp",r),c.shift(),t(l,p,x==null?void 0:x.list.concat(c))),c[1].timestamp==r&&(console.log("ðŸš€ ~ getChartInfo ~ list[1].timestamp == startTimestamp",r),c.slice(2),t(l,p,x==null?void 0:x.list.concat(c)))}d(!1)}catch(x){d(!1),console.log(x,"errorgetLineDate")}};return g.useEffect(()=>{console.log("tokenPriceChartInfo$$$$$4444444",s)},[s]),{getChartInfo:f,isLoading:R}}function Gt(){const{fromTokenChart:s,toTokenChart:t,setFromTokenChart:n,setToTokenChart:R}=Z(),[d,f]=g.useState("1H"),[l,p]=g.useState("--"),[r,i]=g.useState("--"),x=async()=>{const j=s;n(t),R(j)},c=j=>{f(j)},u=j=>{p(j)},o=j=>{i(j)},b=()=>e.jsx(dt,{options:["1H","1D","7D","30D"],size:"s",value:d,onChange:c}),{windowWidth:_}=Ce();return e.jsxs(Y,{w:"100%",justifyContent:"center",gap:"0px",bg:"card_bg",backdropFilter:"blur(10px)",borderRadius:"16px",p:"20px 0",children:[e.jsxs(Y,{w:"100%",justifyContent:"flex-start",align:"flex-start",gap:"4px",p:"0px 16px",mb:"20px",children:[e.jsxs(q,{w:"100%",justify:"space-between",sx:{"@media screen and (max-width: 810px)":{flexDirection:"column"}},children:[s&&t?e.jsxs(q,{align:"center",children:[e.jsx(Xe,{coinAIconUrl:s==null?void 0:s.image,coinBIconUrl:t==null?void 0:t.image,variant:"border"}),e.jsxs(F,{fontSize:"2xl",color:"text_caption",m:"0 4px ",children:[s==null?void 0:s.symbol,"-",t==null?void 0:t.symbol]}),e.jsx(T,{xlinkHref:"#icon-icon_swap",onClick:x})]}):e.jsxs(q,{align:"center",children:[e.jsx(ne,{imageUrl:(s==null?void 0:s.image)||(t==null?void 0:t.image),variant:"border"}),e.jsx(F,{fontSize:"2xl",color:"text_caption",m:"0 4px ",children:(s==null?void 0:s.symbol)||(t==null?void 0:t.symbol)})]}),_>810&&e.jsx(I,{h:"20px",children:b()})]}),e.jsxs(q,{align:"center",children:[e.jsx(F,{fontSize:"xl",color:"text_caption",children:r=="--"?"--":s&&t?Q(r,6):"$"+Q(r,6)}),s&&t&&e.jsx(F,{fontSize:"xl",color:"text_caption",ml:"4px",children:t==null?void 0:t.symbol})]}),e.jsx(F,{fontSize:"xs",children:l}),_<=810&&e.jsx(I,{h:"20px",mt:"4px",children:b()})]}),e.jsx(Yt,{timeChange:u,valueChange:o,dateType:d,fromToken:s,toToken:t})]})}function Yt(s){const{fromToken:t,toToken:n,dateType:R,timeChange:d,valueChange:f}=s,{getChartInfo:l,isLoading:p}=It(),{tokenPriceChartInfo:r}=Z(),[i,x]=g.useState([]),[c,u]=g.useState(!0),o=g.useMemo(()=>(u(!0),R=="1H"?"hour":R=="1D"?"day":R=="7D"?"week":R=="30D"?"month":""),[R]);g.useEffect(()=>{var C,M,B,O,U,h,N,v,P,W,G;let a;const w=Math.floor(Date.now()/1e3),m=o=="hour"?5:o=="day"?30:o=="week"?240:o=="month"?720:0;if(t)if(!(r&&r[o]&&r[o][t==null?void 0:t.metadata]))l(o,t==null?void 0:t.metadata);else{console.log("ðŸš€ ~ useEffect ~ now_timestamp:",w);const z=r&&r[o]&&r[o][t==null?void 0:t.metadata];if(console.log("ðŸš€ ~ useEffect ~ now_timestamp !== list[0].timestamp:",w,(C=z[0])==null?void 0:C.timestamp),w>((M=z[0])==null?void 0:M.timestamp)+60){const H=z.length>=2?((B=z[1])==null?void 0:B.timestamp)-((O=z[0])==null?void 0:O.timestamp):0;(H==m*60||H==0)&&(a=(U=z[0])==null?void 0:U.timestamp),H<m*60&&(a=(h=z[1])==null?void 0:h.timestamp,l(o,t==null?void 0:t.metadata,a))}}if(n)if(!(r&&r[o]&&r[o][n==null?void 0:n.metadata]))l(o,n==null?void 0:n.metadata);else{const z=r&&r[o]&&r[o][n==null?void 0:n.metadata];if(w>((N=z[0])==null?void 0:N.timestamp)+60){const H=r[o][n==null?void 0:n.metadata],k=((v=H[1])==null?void 0:v.timestamp)-((P=H[0])==null?void 0:P.timestamp);k==m*60&&(a=(W=H[0])==null?void 0:W.timestamp),k<m*60&&(a=(G=H[1])==null?void 0:G.timestamp,l(o,n==null?void 0:n.metadata,a))}}},[t,n,o]),g.useEffect(()=>{var M,B,O,U,h,N;x([]);let a,w;t&&r&&r[o]&&r[o][t==null?void 0:t.metadata]&&(a=r[o][t==null?void 0:t.metadata]),n&&r&&r[o]&&r[o][n==null?void 0:n.metadata]&&(w=r[o][n==null?void 0:n.metadata]);const m=JSON.parse(JSON.stringify(a||[])),C=JSON.parse(JSON.stringify(w||[]));if(console.log("ðŸš€ ~ useEffect ~ from:",m,C),t&&n){if((a==null?void 0:a.length)>0&&(w==null?void 0:w.length)>0)if((a==null?void 0:a.length)>=(w==null?void 0:w.length)){(a==null?void 0:a.length)>(w==null?void 0:w.length)&&(m==null||m.splice(-((m==null?void 0:m.length)-(C==null?void 0:C.length))));for(let v=0;v<(m==null?void 0:m.length);v++)m[v].newPrice=D((M=m[v])==null?void 0:M.price).div((B=C[v])==null?void 0:B.price).toString();x(m),u(!1)}else{C==null||C.splice(-((C==null?void 0:C.length)-(m==null?void 0:m.length)));for(let v=0;v<(C==null?void 0:C.length);v++)C[v].newPrice=D((O=m[v])==null?void 0:O.price).div((U=C[v])==null?void 0:U.price).toString();x(C),u(!1)}}else{if(t){for(let v=0;v<(m==null?void 0:m.length);v++)m[v].newPrice=(h=m[v])==null?void 0:h.price;x(m),u(!1)}if(n){for(let v=0;v<(C==null?void 0:C.length);v++)C[v].newPrice=(N=C[v])==null?void 0:N.price;x(C),u(!1)}}},[t,n,r,o]);const b=i&&Math.min(...i.map(a=>a.newPrice)),_=i&&Math.max(...i.map(a=>a.newPrice));g.useEffect(()=>{var a,w;f(i&&((a=i[0])==null?void 0:a.newPrice)||"--"),d((i==null?void 0:i.length)>0?ye(new Date(i&&((w=i[0])==null?void 0:w.timestamp)*1e3)):"--"),console.log("ðŸš€ ~ useEffect ~ lineDataList:",i)},[i]);const[j,y]=g.useState(null),A=a=>{var w,m,C;if(a&&a.activePayload&&((w=a.activePayload)!=null&&w.length)){const M=(m=a.activePayload[0])==null?void 0:m.payload.timestamp,B=(C=a.activePayload[0])==null?void 0:C.payload.newPrice;d(ye(new Date(M*1e3))),f(B);const O=a.activePayload[0];y(O)}},$=()=>{var a,w;y(null),d((i==null?void 0:i.length)>0?ye(new Date(i&&((a=i[0])==null?void 0:a.timestamp)*1e3)):"--"),f(i&&((w=i[0])==null?void 0:w.newPrice)||"--")},{windowWidth:V}=Ce();return e.jsx(e.Fragment,{children:c||p?e.jsx(Y,{p:"20px 0px 70px",h:"456px",justifyContent:"center",sx:{"@media screen and (max-width: 810px)":{h:"200px"}},children:e.jsx(pt,{})}):(i==null?void 0:i.length)==0?e.jsx(Y,{p:"20px 0px 70px",h:"456px",justifyContent:"center",sx:{"@media screen and (max-width: 810px)":{h:"200px"}},children:e.jsx(xt,{type:"nodata",noBg:!0,text:"No token data yet"})}):e.jsx(ht,{width:"100%",height:V<=810?200:456,children:e.jsxs(Vt,{height:V<=810?200:456,data:i,syncId:"swapChart",onMouseEnter:A,onMouseMove:A,onMouseLeave:$,margin:{top:10,right:24,left:24,bottom:24},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--chakra-colors-primary)",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"var(--chakra-colors-primary)",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorPv",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--chakra-colors-primary)",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"var(--chakra-colors-primary)",stopOpacity:0})]})]}),e.jsx(zt,{dataKey:"timestamp",tickLine:!1,label:{offset:40},tick:e.jsx(Kt,{type:o,lineDataList:i}),reversed:!0,interval:V<=810?parseInt(String((i==null?void 0:i.length)/3)):(i==null?void 0:i.length)<10?0:parseInt(String((i==null?void 0:i.length)/5))}),e.jsx(Ht,{domain:[b,_],axisLine:!1,hide:!0,tickLine:!1,orientation:"right",tick:{fill:"var(--chakra-colors-text_paragraph)",fontSize:12}}),e.jsx(gt,{cursor:{stroke:"var(--chakra-colors-primary)",strokeWidth:1,strokeDasharray:"3 2"},content:e.jsx(Xt,{})}),e.jsx(Wt,{type:"monotone",dataKey:"newPrice",stroke:"var(--chakra-colors-primary)",fill:"url(#colorUv)"}),j&&e.jsx(mt,{y:j.value,stroke:"var(--chakra-colors-primary)",strokeDasharray:"3 3"}),j&&e.jsx(St,{value:`Value: ${j.value}`,position:"top"})]})})})}const Kt=s=>{const{x:t,y:n,payload:R,type:d,lineDataList:f}=s,l=new Date(R.value*1e3),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][l.getUTCMonth()],i=l.getUTCDate();l.getUTCFullYear();let x=l.getUTCHours();const c=l.getUTCMinutes(),u=x>=12?"PM":"AM";x=x%12,x=x||12;const o=d=="month"||d=="week"?r+" "+i:(d=="day",x+":"+(c<10?"0":"")+c+" "+u);return e.jsx("g",{transform:`translate(${t},${n})`,children:e.jsx("text",{x:0,y:0,dy:24,textAnchor:"end",fill:"var(--chakra-colors-text_paragraph)",fontSize:12,children:R.value==f[f.length-1].timestamp?"":o})})},Xt=({active:s,payload:t,label:n})=>s&&t&&(t!=null&&t.length)?e.jsx("div",{className:"custom-tooltip"}):null;function ye(s){if(s=="--"||!s)return"--";const t=new Date(s),R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getUTCMonth()],d=t.getUTCDate(),f=t.getUTCFullYear();let l=t.getUTCHours();const p=t.getUTCMinutes(),r=l>=12?"PM":"AM";return l=l%12,l=l||12,R+" "+d+", "+f+", "+l+":"+(p<10?"0":"")+p+" "+r}function Qt(s){var l,p,r,i,x;const{data:t,isOpen:n,onClose:R}=s;console.log("RouteModal data: ",t);const{fromToken:d,toToken:f}=t;return e.jsxs(He,{isOpen:n,onClose:R,isCentered:!0,children:[e.jsx(We,{}),e.jsxs(qe,{children:[e.jsx(Je,{children:"Route"}),e.jsx(Le,{}),e.jsx(Ie,{p:"16px 28px 36px",children:e.jsxs(Y,{w:"100%",gap:"0",p:"0 0px 0px",children:[e.jsxs(I,{h:"0px",w:"100%",border:"1px dashed",borderColor:"route_line",borderTop:"none",borderBottom:"none",position:"relative",children:[e.jsxs(ee,{position:"absolute",top:"-10px",left:"-10px",zIndex:"99",align:"flex-start",children:[e.jsx(ne,{imageUrl:(l=t==null?void 0:t.fromToken)==null?void 0:l.image,w:"20px",h:"20px"}),e.jsxs(F,{color:"text_caption",maxW:"165px",children:[Ue((t==null?void 0:t.fromValue)||"0")," ",(p=t==null?void 0:t.fromToken)==null?void 0:p.symbol]})]}),e.jsxs(ee,{position:"absolute",top:"-10px",right:"-10px",zIndex:"99",align:"flex-start",children:[e.jsxs(F,{color:"text_caption",maxW:"165px",children:[Ue((t==null?void 0:t.toValue)||"0")," ",(r=t==null?void 0:t.toToken)==null?void 0:r.symbol]}),e.jsx(ne,{imageUrl:(i=t==null?void 0:t.toToken)==null?void 0:i.image,w:"20px",h:"20px"})]})]}),(x=t==null?void 0:t.path)==null?void 0:x.map((c,u)=>{var o;return e.jsxs(I,{h:"60px",w:"100%",border:"1px dashed",borderColor:"route_line",borderTop:"none",position:"relative",children:[e.jsx(F,{w:"44px",h:"32px",backdropFilter:"blur(10px)",lineHeight:"32px",textAlign:"center",position:"absolute",bottom:"-16px",children:c==null?void 0:c.share}),(o=c==null?void 0:c.pools)==null?void 0:o.map((b,_)=>{var A;let{token0:j,token1:y}=b;return _===0?(j==null?void 0:j.metadata)!==(d==null?void 0:d.metadata)&&(y=j,j=d):(y==null?void 0:y.metadata)!==(f==null?void 0:f.metadata)&&(j=y,y=f),e.jsx(I,{position:"absolute",bottom:"-16px",right:((A=c==null?void 0:c.pools)==null?void 0:A.length)==1?"34%":_==0?"55%":"15%",zIndex:"99",children:e.jsxs(ft,{trigger:"hover",placement:"top",children:[e.jsx(jt,{children:e.jsx(Qe,{children:e.jsxs(ee,{gap:"4px",cursor:"pointer",p:"0 8px",h:"36px",bg:"card_bg",backdropFilter:"blur(10px)",borderRadius:"8px",children:[e.jsx(I,{children:e.jsx(Xe,{ml:"-4px",w:"20px",coinAIconUrl:j==null?void 0:j.image,coinBIconUrl:y==null?void 0:y.image})}),e.jsx(q,{align:"center",justifyContent:"center",children:e.jsx(F,{maxW:"80px",color:"text_caption",lineHeight:"14px",children:b==null?void 0:b.feeRate})})]})})}),e.jsx(wt,{maxW:"180px",textAlign:"center",children:e.jsx(yt,{children:e.jsxs(F,{fontSize:"xs",children:[b==null?void 0:b.name," ",b==null?void 0:b.feeRate]})})})]})},_)})]},u)})]})})]})]})}function ke(){const{tucanaRouterSDK:s}=Ct(),t=g.useRef();return g.useEffect(()=>{t.current=s},[s]),{getSwapRouter:async(d,f,l,p)=>{var r;try{return await((r=t.current)==null?void 0:r.findBestPaths(d,f,l,p))}catch(i){console.log("getSwapRouter Error: ",i)}},getSwapPayload:(d,f,l)=>{var p;try{return(p=t.current)==null?void 0:p.buildRouterFunction(d,f,l)}catch(r){console.log("getSwapPayload Error: ",r)}}}}function Zt(){const{poolsObj:s}=bt(),{getSwapRouter:t}=ke(),{fromToken:n,toToken:R,fromValue:d,toValue:f,setFromValue:l,setToValue:p,setSwapPreInfo:r,setFeeAmount:i,setPriceImpact:x,setRouterModalData:c,setRouterSimpleInfo:u,setSparateNum:o,setIsPreSwapLoading:b}=Z(),_=(y,A,$)=>{console.log("getRouterModalData params: ",y),console.log("getRouterModalData params.amountIn: ",y.amountIn);const V={fromToken:A,toToken:$,fromValue:se(D(y.amountIn),A==null?void 0:A.decimals),toValue:se(D(y.amountOut),$==null?void 0:$.decimals)},a=[],w=y.amountIn,m=[];console.log("ðŸš€ ~ file: usePreSwap.ts:43 ~ params.combinedPaths.forEach ~ params.combinedPaths:",y.combinedPaths),y.combinedPaths.forEach(C=>{const M=D(C.amountIn).div(w).mul(100).toString(),B=[];C.basicPaths.forEach((O,U)=>{var N,v,P;const h=s[O==null?void 0:O.poolAddress];console.log("getRouterModalData poolInfo: ",h),y.combinedPaths.length===1&&(U===0&&(m==null?void 0:m.length)===0&&m.push(A),U===C.basicPaths.length-1?m.push($):m.push(((N=h==null?void 0:h.token0)==null?void 0:N.metadata)===(A==null?void 0:A.metadata)?h==null?void 0:h.token1:h==null?void 0:h.token0)),B.push({token0:O!=null&&O.a2b?h==null?void 0:h.token0:h==null?void 0:h.token1,token1:O!=null&&O.a2b?h==null?void 0:h.token1:h==null?void 0:h.token0,name:`${(v=h==null?void 0:h.displayToken0)==null?void 0:v.symbol}-${(P=h==null?void 0:h.displayToken1)==null?void 0:P.symbol}`,poolAddress:O.poolAddress,feeRate:qt(O.feeRate)})}),a.push({share:Ze(M),pools:B})}),console.log("ðŸš€ ~ file: usePreSwap.ts:74 ~ getRouterModalData ~ result:",a),console.log("ðŸš€ ~ file: usePreSwap.ts:74 ~ getRouterModalData ~ simpleInfo:",m),V.path=a,c(V),u(m)};return{preSwap:async(y,A,$,V)=>{var m,C;const a=$||n,w=V||R;if(a!=null&&a.metadata&&(w!=null&&w.metadata)&&y){if(D(y).equals(0)){A?p(""):l(""),r(void 0);return}b(!0);try{console.log("preSwap tokenFrom: ",a),console.log("preSwap tokenTo: ",w),console.log("preSwap byAmountIn: ",A),console.log("preSwap amount: ",y);const M=await t(a==null?void 0:a.metadata,w==null?void 0:w.metadata,A,Number(y)),B=[];console.log("preSwap router: ",M),(m=M==null?void 0:M.combinedPaths)==null||m.forEach(h=>{var v;const N=[];(v=h==null?void 0:h.basicPaths)==null||v.forEach(P=>{var z,H;const W=s[P==null?void 0:P.poolAddress],G=P!=null&&P.currentSqrtPrice?Rt.sqrtPriceX64ToPrice(P==null?void 0:P.currentSqrtPrice,(z=W==null?void 0:W.token0)==null?void 0:z.decimals,(H=W==null?void 0:W.token1)==null?void 0:H.decimals).toString().toString():P==null?void 0:P.currentSqrtPrice;N==null||N.push({...P,currentSqrtPrice:P!=null&&P.a2b?G:D(1).div(G).toString()})}),B.push({...h,basicPaths:N})});const O={...M,combinedPaths:B};console.log("preSwap processRouter: ",O),r(M),i(se(new we(M==null?void 0:M.feeAmount),a==null?void 0:a.decimals)),x(String(M==null?void 0:M.priceImpact));const U=M.isExceed===!0||M.isExceed&&M.isExceed.filter(h=>h===!1).length===0;if(A){const h=se(new we(M.amountOut),w.decimals);p(U||D(h).equals(0)?"":h)}else{const h=se(new we(M.amountIn),a.decimals);l(U||D(h).equals(0)?"":h)}o((C=M==null?void 0:M.combinedPaths)==null?void 0:C.length),_(M,a,w),b(!1)}catch(M){console.log("preSwap Error: ",M),b(!1),A?p(""):l("")}}}}}function kt(s,t,n,R,d,f){const l=g.useMemo(()=>(n==null?void 0:n.metadata)===(s==null?void 0:s.metadata)?"Minimum Received":"Maximum Sold",[n,s,t]),p=g.useMemo(()=>(n==null?void 0:n.metadata)===(s==null?void 0:s.metadata)?`${Q(D(d).mul(D(1).minus(f)).toString(),t==null?void 0:t.decimals)} ${t==null?void 0:t.symbol}`:`${Q(D(R).mul(D(1).add(f)).toString(),s==null?void 0:s.decimals)} ${s==null?void 0:s.symbol}`,[f,n,R,d]);return{receiveOrSoldText:l,receiveOrSoldValue:p}}function Tt(s,t,n,R,d,f,l,p){const r=g.useMemo(()=>!!(!d||D(d).lte(0)||!f||D(f).lte(0)),[d,f]),i=g.useMemo(()=>!!((!d||D(d).lte(0))&&(!f||D(f).lte(0))),[d,f]),x=g.useMemo(()=>D(d).gt(0)||D(f).gt(0),[d,f]),c=g.useMemo(()=>!n||!R,[n,R]),u=g.useMemo(()=>{if(D(l).lt(d||0))return!0},[d,l,n]),o=g.useMemo(()=>{var y;return!!(x&&p&&!p.isExceed&&((y=p==null?void 0:p.combinedPaths)==null?void 0:y.length)===0)},[p,x]),b=g.useMemo(()=>!!(x&&p&&!p.amountTooSmall&&(p.isExceed===!0||p.isExceed&&p.isExceed.filter(y=>y===!1).length===0)),[p,x]),_=g.useMemo(()=>!!(s||t||c||r||u||o||b),[s,t,d,p,l,r,c,u,o,b]),j=g.useMemo(()=>c?"Select a token":b?"Insufficient liquidity for this trade":o?"No Available Route":r?"Enter an amount":u?`Insufficent ${n==null?void 0:n.symbol} balance`:"Swap",[s,t,n,R,d,p,l,r,c,u,o,b]);return{isSubmitBtnDisabled:_,submitBtnText:j,isNoValue:r,isNoToken:c,isBothNoValue:i}}function ea(){const s=Mt(),{from:t,to:n}=vt(),{signAndExecuteTransaction:R}=Pt(),{slippage:d}=At(),f=Ot(),{getSwapRouter:l,getSwapPayload:p}=ke(),{preSwap:r}=Zt(),{fetchTokenBalances:i}=_t(),{getTokenInfo:x}=Jt(),{fromToken:c,toToken:u,fromValue:o,toValue:b,setFromToken:_,setToToken:j,setFromTokenChart:y,setToTokenChart:A,setFromValue:$,setToValue:V,swapPreInfo:a,setSubmitIsLoading:w,submitIsLoading:m,feeAmount:C,priceImpact:M,isPreSwapLoading:B,setIsPreSwapLoading:O,setSwapPreInfo:U,priceIsUpdate:h,setPriceIsUpdate:N,fixedToken:v,setFixedToken:P}=Z(),W=Ve(c),G=Ve(u),{receiveOrSoldText:z,receiveOrSoldValue:H}=kt(c,u,v,o,b,d),{isSubmitBtnDisabled:k,submitBtnText:ge,isNoValue:me,isBothNoValue:Se,isNoToken:fe}=Tt(m,B,c,u,o,b,W,a),je=async()=>{if(!t&&!n){const{fromCoin:S,toCoin:E}=Nt.swap;_(S),j(E),y(S),A(E)}else{const S=t?await x(t):void 0,E=n?await x(n):void 0;_(S),j(E),y(S),A(E)}};g.useEffect(()=>{je()},[t,n]);const re=Dt(r,500),ce=S=>{$(S),P(c);try{const E=S?pe(S,c==null?void 0:c.decimals).toString():"0";re(E,!0)}catch{r("0",!0)}},ie=S=>{V(S),P(u);try{const E=S?pe(S,u==null?void 0:u.decimals).toString():"0";re(E,!1)}catch{r("0",!1)}},oe=S=>{(S==null?void 0:S.metadata)===(u==null?void 0:u.metadata)?s(`/swap/${S==null?void 0:S.metadata}/undefined`):s(`/swap/${S==null?void 0:S.metadata}/${u==null?void 0:u.metadata}`),U(void 0)},L=S=>{(S==null?void 0:S.metadata)===(c==null?void 0:c.metadata)?s(`/swap/undefined/${S==null?void 0:S.metadata}`):s(`/swap/${c==null?void 0:c.metadata}/${S==null?void 0:S.metadata}`),U(void 0)},le=g.useMemo(()=>Ze(D(d).mul(100).toString()),[d]),[Te,be]=g.useState(!1),[et,aa]=g.useState(),tt=()=>{be(!0)},Re=()=>{h&&ve(),be(!1)},ue=g.useRef(),J=g.useRef();g.useEffect(()=>{J.current=a},[a]);const at=()=>{var S,E,K,ae;J.current&&(c!=null&&c.metadata)&&(u!=null&&u.metadata)&&l(c==null?void 0:c.metadata,u==null?void 0:u.metadata,(S=J.current)==null?void 0:S.byAmountIn,(E=J.current)!=null&&E.byAmountIn?(K=J.current)==null?void 0:K.amountIn:(ae=J.current)==null?void 0:ae.amountOut).then(_e=>{var De,Ee,Ne,$e;ue.current&&((De=J.current)!=null&&De.byAmountIn&&_e.amountOut!==((Ee=J.current)==null?void 0:Ee.amountOut)||!((Ne=J.current)!=null&&Ne.byAmountIn)&&_e.amountIn!==(($e=J.current)==null?void 0:$e.amountIn))&&N(!0)})},st=()=>{ue.current=setInterval(async()=>{at()},5e3)},Me=()=>{clearInterval(ue.current),ue.current=null},ve=async()=>{Me(),N(!1),a.byAmountIn?await r(String(a.amountIn),a.byAmountIn):await r(String(a.amountOut),a.byAmountIn)},nt=async()=>{w(!0);try{Re(),console.log("handleSubmitSwap swapPreInfo: ",a),console.log("handleSubmitSwap account: ",f),console.log("handleSubmitSwap sllipage: ",d);const S=p(f,a,d);console.log("handleSubmitSwap payload: ",S);const E=await R([S],{action:Et.Swap,description:"Swap",coinA:{...c,amount:o},coinB:{...u,amount:b}});w(!1),$(""),V(""),U(void 0),await Ke(2e3),i()}catch(S){console.log("handleSubmitAdd error: ",S),w(!1)}},rt=async()=>{const S=c;_(u),j(S),y(u),A(S);const E=o;if($(b),V(E),!o||!b)return;O(!0);const K=a.byAmountIn?a==null?void 0:a.amountIn:a==null?void 0:a.amountOut;console.log("handleToggle swapPreInfo: ",a),console.log("handleToggle amount: ",K),console.log("handleToggle swapPreInfo?.byAmountIn: ",a==null?void 0:a.byAmountIn),a.byAmountIn?$(""):V(""),r(K,!(a!=null&&a.byAmountIn),u,c)},Pe=g.useRef(),Ae=g.useRef(),te=g.useRef(),de=g.useRef(),Oe=g.useRef();g.useEffect(()=>{Oe.current=v},[v]),g.useEffect(()=>{te.current=c},[c]),g.useEffect(()=>{de.current=u},[u]),g.useEffect(()=>{Pe.current=o},[o]),g.useEffect(()=>{Ae.current=b},[b]);const ct=g.useMemo(()=>a!=null&&Object.keys(a).length!==0,[a]);return{handleFromValueChange:ce,handleToValueChange:ie,handleSubmitSwap:nt,slippageTolerance:le,receiveOrSoldText:z,receiveOrSoldValue:H,isSubmitBtnDisabled:k,submitBtnText:ge,isNoValue:me,isBothNoValue:Se,isNoToken:fe,fromTokenBalance:W,toTokenBalance:G,handleAccept:ve,priceIsUpdate:h,watchPriceUpdated:st,clearWatchPriceTimer:Me,isOpenSecondaryModal:Te,secondaryModalData:et,handleOpenSecondaryModal:tt,handleCloseSecondaryModal:Re,handleToggle:rt,handleRefresh:()=>{var S,E,K,ae;f&&i(),J.current&&(((S=Oe.current)==null?void 0:S.metadata)===((E=te.current)==null?void 0:E.metadata)?r(pe(Pe.current||"",(K=te.current)==null?void 0:K.decimals).toString(),J.current.byAmountIn,te.current,de.current):r(pe(Ae.current||"",(ae=de.current)==null?void 0:ae.decimals).toString(),J.current.byAmountIn,te.current,de.current))},showAutoRefreshAnimate:ct,handleFromTokenChange:oe,handleToTokenChange:L}}function ta(s){const{address:t,onboard:n}=$t(),{windowWidth:R}=Ce(),{onClick:d,text:f,isDisabled:l,isLoading:p,w:r,size:i,...x}=s;return t?e.jsx(xe,{w:r,size:i,isLoading:p,isDisabled:l,...x,onClick:d,children:R<=810&&f=="Insufficient liquidity for this trade"?"Insufficient liquidity":f}):e.jsx(xe,{w:r,size:i,...x,onClick:n,children:"Connect"})}function ua(){const{fromToken:s,toToken:t,fromValue:n,toValue:R,setFromToken:d,setToToken:f,resetSwapState:l,feeAmount:p,priceImpact:r,submitIsLoading:i,routerModalData:x,routerSimpleInfo:c,separateNum:u,isPreSwapLoading:o,isOpenSwapChart:b,setIsOpenSwapChart:_,fixedToken:j}=Z(),{handleFromValueChange:y,handleToValueChange:A,handleSubmitSwap:$,slippageTolerance:V,receiveOrSoldText:a,receiveOrSoldValue:w,isSubmitBtnDisabled:m,submitBtnText:C,isNoValue:M,isBothNoValue:B,isNoToken:O,fromTokenBalance:U,toTokenBalance:h,handleAccept:N,priceIsUpdate:v,clearWatchPriceTimer:P,watchPriceUpdated:W,isOpenSecondaryModal:G,secondaryModalData:z,handleOpenSecondaryModal:H,handleCloseSecondaryModal:k,handleToggle:ge,handleRefresh:me,showAutoRefreshAnimate:Se,handleFromTokenChange:fe,handleToTokenChange:je}=ea(),[re,ce]=g.useState(!1),[ie,oe]=g.useState(!1);return g.useEffect(()=>{window.scrollTo(0,0)},[]),g.useEffect(()=>()=>{_(!1),l()},[]),g.useEffect(()=>{console.log("Swap Page separateNum: ",u)},[u]),e.jsxs(ee,{w:"100%",align:"flex-start",justifyContent:"center",gap:"16px",mt:"20px",sx:{"@media screen and (max-width: 810px)":{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column-reverse"}},children:[b&&e.jsx(I,{w:"664px",minW:"580px",sx:{"@media screen and (max-width: 1000px)":{w:"unset"},"@media screen and (max-width: 810px)":{w:"100%",minW:"unset"}},children:e.jsx(Gt,{})}),e.jsxs(I,{w:"480px",minW:"420px",bg:"card_bg_20",borderRadius:"16px",backdropFilter:"blur(10px)",sx:{"@media screen and (max-width: 810px)":{w:"100%",minW:"unset"}},children:[e.jsxs(I,{p:"20px 16px",bg:"card_bg",borderRadius:"16px",children:[e.jsxs(q,{mb:"20px",alignItems:"center",justifyContent:"space-between",children:[e.jsx(F,{color:"text_caption",fontSize:"xl",children:"Swap"}),e.jsxs(q,{alignItems:"center",children:[e.jsx(Bt,{handleClickRefresh:me,noBg:!0,isAutoRefresh:!0,showAutoRefreshAnimate:Se}),e.jsx(I,{ml:"20px",children:e.jsx(T,{xlinkHref:"#icon-icon_kline",onClick:()=>_(!b)})}),e.jsx(I,{ml:"20px",children:e.jsx(T,{xlinkHref:"#icon-icon_slider",onClick:()=>ce(!0)})})]})]}),e.jsxs(Y,{gap:"0px",w:"100%",children:[e.jsx(Fe,{title:"You pay",currentCoin:s,onTokenChange:L=>{fe(L)},amount:n,balance:U,isLoading:(j==null?void 0:j.metadata)&&(j==null?void 0:j.metadata)!==(s==null?void 0:s.metadata)&&o,onAmountChange:y}),e.jsx(q,{gap:"0px",h:"8px",children:e.jsx("div",{className:"exchange swap-exchange",onClick:ge})}),e.jsx(Fe,{title:"You receive",noMax:!0,currentCoin:t,onTokenChange:L=>{je(L)},amount:R,balance:h,isLoading:(j==null?void 0:j.metadata)&&(j==null?void 0:j.metadata)!==(t==null?void 0:t.metadata)&&o,onAmountChange:A})]}),(!B&&o||!M)&&!O&&e.jsx(q,{bg:"current_price_bg",borderRadius:"8px",h:"50px",mt:"20px",alignItems:"center",children:e.jsx(Ge,{fromToken:s,toToken:t,fromValue:n,toValue:R,color:"text_caption",isLoading:o})})]}),e.jsxs(I,{mt:"16px",p:"0px 16px 20px",children:[(!B&&o||!M)&&!O&&e.jsxs(Y,{pb:"20px",gap:"16px",children:[e.jsx(X,{text:"Price Impact",value:Ye(r||"0",2),valueColor:he(r||"0"),isLoading:o,iconVariant:"error",iconXlinkHref:he(r)==="error"?"#icon-a-icon_tips_triangle":""}),e.jsx(X,{text:a,value:w,isLoading:o}),e.jsx(X,{text:"Fees",value:`${Q(p,s==null?void 0:s.decimals)} ${s==null?void 0:s.symbol}`,isLoading:o}),e.jsxs(q,{w:"100%",align:"center",justifyContent:"space-between",children:[e.jsx(F,{fontSize:"14px",children:"Route"}),o?e.jsx(Ut,{w:"180px",h:"21px",alignSelf:"end"}):e.jsxs(q,{alignItems:"center",cursor:"pointer",onClick:()=>oe(!0),children:[u>1&&e.jsxs(F,{color:"text_caption",children:[u," Separate Routes"]}),u===1&&(c==null?void 0:c.map((L,le)=>e.jsx(ee,{children:e.jsxs(Qe,{ml:"4px",children:[e.jsx(ne,{imageUrl:L==null?void 0:L.image,w:"16px"}),e.jsx(F,{pl:"4px",color:"text_caption",children:L==null?void 0:L.symbol}),le!==(c==null?void 0:c.length)-1&&e.jsx(T,{xlinkHref:"#icon-icon_lead",w:"16px",h:"16px"})]})},`swap-simple-router-${le}`))),u>0&&e.jsx(T,{xlinkHref:"#icon-icon_unfold"})]})]})]}),e.jsx(ta,{w:"100%",size:"lg",onClick:H,isLoading:i,isDisabled:m,text:C})]}),ie&&e.jsx(Qt,{isOpen:ie,onClose:()=>oe(!1),data:x}),e.jsx(Ft,{isOpen:re,onClose:()=>ce(!1)}),G&&e.jsx(Lt,{slippageTolerance:V,receiveOrSoldText:a,receiveOrSoldValue:w,isOpen:G,onClose:k,onClick:$,handleAccept:N,priceIsUpdate:v,clearWatchPriceTimer:P,watchPriceUpdated:W})]})]})}export{ua as default};
