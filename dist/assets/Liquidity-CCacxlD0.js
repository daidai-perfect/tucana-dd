import{j as e,r as l}from"./react-CxzTU07i.js";import{d as v,a4 as us,R as Ke,J as Ne,$ as qe,e as rt,g as Ve,C as jt,I as ce,f as Tt,p as bt,L as _e,S as Ge,m as re,K as Xe,a5 as Ue,a6 as Y,a7 as Ae,a8 as Ns,n as $s,H as wt,E as st,F as De,a9 as Ds,aa as Fs,a0 as hs,k as Us,o as Os,b as Xt,O as kt,Q as ht,T as Ws,s as Vs,ab as Yt,ac as mt,ad as Gs,ae as Xs,af as Kt,G as ms,U as ot,ag as Ys,ah as Ks,M as Zs,ai as Js}from"./App-Cb960mne.js";import{R as St,P as Qs,u as Ps}from"./RectangularTab-scmnr4k8.js";import{b as ct,H as As,u as lt,c as Is,d as ei,e as ti}from"./useApiUrl-BWcjgV84.js";import{c as ps}from"./zustand--BHpADek.js";import{B as Ye}from"./bn.js-CjHYPH1W.js";import"./numbro-DbF9-lIv.js";import{u as $e}from"./useWindowWidth-DaYijioX.js";import{R as gs,B as si,T as ys,d as ii,Y as js,X as ks,c as ai,A as ni,b as ri}from"./recharts-BEhUgXe7.js";import{a as oi,S as Ze,V as q,F as K,f as N,T as w,H as B,B as vt,L as it,M as ci,w as li,x as di,y as xi,z as ui,A as hi,D as mi,E as pi,G as gi,J as yi,a2 as at,X as ji,Y as ki,Z as fi,_ as Ti,a9 as bi,aa as wi,ab as Si,j as Zt,ac as Ie,i as vi,k as et,u as fs,ap as Ci,U as Mi}from"./@chakra-ui-F3U2dpjw.js";import{g as Ct,a as Ri}from"./apiDataProcessing-DjMQcQv4.js";import{T as Fe,u as Jt}from"./useGetBalance-DnuRUkOd.js";import{D as Qt}from"./decimal.js-g2JQ_dxE.js";import{T as dt}from"./@initia-CP5FTFDk.js";import{c as Ee,b as oe,M as xt,l as ut,C as _i}from"./@tucana-network-DgPNddlX.js";import{a as Oe,b as Ei,T as Pt,u as Li}from"./useSearchPools-Cn_Tjnrw.js";import{u as zi,P as Hi}from"./useSelectRange-BFBP-BxQ.js";import{c as Mt,f as Bi}from"./react-router-COZMEyo_.js";import{u as qi,a as Ni,b as $i,P as Di,c as Fi,d as Ui,e as Oi}from"./PositionIncreaseModal-BhpANlAO.js";import{T as At}from"./TableCardH5-CxOqm6xI.js";import{u as Wi}from"./position-DDE7YBux.js";import{T as It,S as Vi}from"./SlippageSetting-ChXQQLFq.js";import{L as es}from"./LockMask-CVvwyGE1.js";import{A as Gi}from"./AprTooltip-CF9YBoS1.js";import{u as Xi}from"./swr-CBRXrZzQ.js";import"./d3-transition-M3J8yfEs.js";import{i as Ts,z as bs}from"./d3-zoom-BwTkNIpI.js";import{z as Yi}from"./lodash-CF7ZZEzc.js";import{p as pe}from"./styled-components-BmMa0H8M.js";import{m as ws,A as Ki,C as Ss,n as Zi}from"./d3-shape-C66BBtZo.js";import{a as vs,b as Ji}from"./d3-axis-D9mlKfZZ.js";import{s as xe,p as Qi}from"./d3-selection-DSeOx27A.js";import{b as Pi,a as Ai}from"./d3-brush-ByO8jppl.js";import{l as ft,z as Ii}from"./d3-scale-CaKF3Vy_.js";import{m as Cs,f as ea,g as ta,h as sa,i as ia}from"./d3-array-EePf7Sik.js";import{d as aa}from"./d3-format-CzD4bSOQ.js";import{u as na}from"./index-BneEWBBi.js";import"./@improbable-eng-BU3rlaSz.js";import"./react-router-dom-DspqRS0x.js";import"./react-dom-D0CDEAqu.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-CA71pd9M.js";import"./index-oyaI18XQ.js";import"./lodash.mergewith-0oSak3fd.js";import"./framesync-BLa_7oTh.js";import"./@emotion-Ci8Bc0jK.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./@babel-Ds7TnLC8.js";import"./stylis-YPZU7XtI.js";import"./color2k-BSHHkqKj.js";import"./framer-motion-DN1fNAS_.js";import"./react-focus-lock-CdsTnkdS.js";import"./focus-lock-C3lLyJ0E.js";import"./use-sidecar-Mnt-C9DP.js";import"./use-callback-ref-BUZizod5.js";import"./react-clientside-effect-C1WRooe2.js";import"./react-remove-scroll-XbdGFyuF.js";import"./react-remove-scroll-bar-B8WFODEn.js";import"./react-style-singleton-BMjn4bnO.js";import"./get-nonce-C-Z93AgS.js";import"./aria-hidden-DQ5UC2Eg.js";import"./@zag-js-BxxExxl0.js";import"./@popperjs-BQBsAJpH.js";import"./react-fast-compare-ZNZLWkFJ.js";import"./dayjs-ChilDtai.js";import"./copy-to-clipboard-BEgmPfpW.js";import"./toggle-selection-BHUZwh74.js";import"./cosmjs-types-HHI3LIsf.js";import"./vite-plugin-node-polyfills-2b3IylRN.js";import"./usePoolList-D7LBbYQN.js";import"./clsx-B-dksMZM.js";import"./react-smooth-CJ-TEnHD.js";import"./prop-types-DJYhzm_d.js";import"./fast-equals-C7I1S-bJ.js";import"./tiny-invariant-BaFNuDhB.js";import"./victory-vendor-CWG3-CEL.js";import"./recharts-scale-DiOBu8nk.js";import"./decimal.js-light-B5-9uEc-.js";import"./axios-BGrCQLb0.js";import"./browser-headers-DaTTBGKg.js";import"./long-Bd8Jk2Sf.js";import"./@protobufjs-BFfFlHHM.js";import"./bignumber.js-CTO8iJYk.js";import"./jscrypto-DOxZ2vL9.js";import"./crypto-browserify-K7vti8ry.js";import"./randombytes-cxG1aiJq.js";import"./safe-buffer-B7h8REzA.js";import"./create-hash-B2etqZ4B.js";import"./inherits-BlmhoU4v.js";import"./md5.js-FaoCCiYs.js";import"./hash-base-Bol-vuw1.js";import"./events-BYvclee5.js";import"./util-mxsps8Rg.js";import"./is-arguments-CSFfgC6i.js";import"./has-tostringtag-BVm4gedm.js";import"./has-symbols-jRi3KFcs.js";import"./call-bind-B07GZeJl.js";import"./get-intrinsic-kTO65dkt.js";import"./es-errors-DzOT6E3C.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-DW3CJlDV.js";import"./define-data-property-BYhozZ9n.js";import"./es-define-property-BlMEMvNH.js";import"./gopd-rUakIY3f.js";import"./has-property-descriptors-B3Yvk56Z.js";import"./is-generator-function-DtmjroQB.js";import"./which-typed-array-DjIYTpty.js";import"./for-each-HDM-_-W4.js";import"./is-callable-ajMm-eR9.js";import"./available-typed-arrays-lJejVQbB.js";import"./possible-typed-array-names-ZWAIzZ1Z.js";import"./is-typed-array-BI6k7hxc.js";import"./util-deprecate-DPVjTvyT.js";import"./string_decoder-0MzJkBYb.js";import"./ripemd160-C1CpqImb.js";import"./sha.js-BDwlQsPx.js";import"./cipher-base-7AdYGBPO.js";import"./stream-browserify-BfQl1BUK.js";import"./create-hmac--QaKJlMo.js";import"./browserify-sign-GWTZlE0Z.js";import"./process-nextick-args-qzFE9GA4.js";import"./core-util-is-BRatBjl-.js";import"./browserify-rsa-CryRCbDk.js";import"./elliptic-CmlQxMT_.js";import"./minimalistic-assert-DDtZfRm3.js";import"./minimalistic-crypto-utils-BXubSNmL.js";import"./brorand-BrlY5gS_.js";import"./hash.js-itZKbfbK.js";import"./hmac-drbg-oB7aodci.js";import"./parse-asn1-DRtj1sMn.js";import"./asn1.js-BnSaV4mo.js";import"./vm-browserify-B6h6MQBh.js";import"./evp_bytestokey-Dyx8YxuJ.js";import"./browserify-aes-BUcIY7yD.js";import"./buffer-xor-De43xBeM.js";import"./pbkdf2-C-6u4RPY.js";import"./browserify-cipher-DYIcwHfU.js";import"./browserify-des-SXPfahZ7.js";import"./des.js-CDfWU-Dy.js";import"./diffie-hellman-Cjh9VIAB.js";import"./miller-rabin-D0hA1ZTO.js";import"./create-ecdh-BozzoSuA.js";import"./public-encrypt-Dmci0MFY.js";import"./randomfill-Cz20fUZ8.js";import"./keccak256-BDyJSpAN.js";import"./keccak-C1V6dJ9R.js";import"./bech32-MFBNfINK.js";import"./bs58-B7XvzY3E.js";import"./base-x-DaHpqjnx.js";import"./bip32-rT_4MDJf.js";import"./bs58check-DBgRgCjV.js";import"./tiny-secp256k1-DFomSNDX.js";import"./typeforce-Dson3yfq.js";import"./wif-Bj2Vat9l.js";import"./bip39-D04lJivS.js";import"./@noble-niMs0PSV.js";import"./secp256k1-BRtDzKq7.js";import"./ws-DLAd0t_s.js";import"./semver-DcF-0Uum.js";import"./@ledgerhq-BR4K6VrK.js";import"./use-sync-external-store-CdAcFHgC.js";import"./d3-dispatch-kxCwF96_.js";import"./d3-timer-DdKHrDhs.js";import"./d3-interpolate-m1gjL8b6.js";import"./d3-color-9lF95FHy.js";import"./d3-ease-DRPgKoYJ.js";import"./d3-drag-_qOI58SM.js";import"./d3-path-CimkQT29.js";import"./internmap-BkD7Hj8s.js";import"./d3-time-format-CKRkqwF6.js";import"./d3-time-nQs4M9wC.js";function Ms(){return e.jsx(oi,{h:"120px",children:e.jsx(Ze,{size:"lg"})})}function Rs(){const a=ct(As),[t,o]=l.useState([]),[s,n]=l.useState(!0);return{loading:s,dataList:t,getHistogramData:async i=>{n(!0);try{const h=new URLSearchParams;h.append("date_type",String(i.date_type)),h.append("histogram_type",String(i.histogram_type)),h.append("limit",String(i.limit)),i.pool_address&&h.append("id",String(i.pool_address));const d=await(await fetch(`${a}?${h.toString()}`)).json();console.log("getHistogramData: ",d);const u=[];d&&d.data&&d.data.list&&d.data.list.forEach(r=>{u.push({name:"Page A",time:r.date,uv:0,pv:r.num,amt:0})}),console.log("getHistogramData list: ",u),o(u),n(!1)}catch(h){console.log(h,"getHistogramData"),n(!1)}}}}const ra=ps(a=>({displayToken0Value:"",displayToken1Value:"",addToken0:void 0,addToken1:void 0,currentFeeTier:"",currentApiPoolInfo:null,currentContractPoolInfo:null,currentPrice:"",inversePrice:"",baseCoin:"",currentApiPoolInfoIsLoading:!0,currentContractPoolInfoIsLoading:!0,priceRangePercentage:0,defaultPriceRangePercentage:0,minPriceData:void 0,maxPriceData:void 0,precomputationInfo:void 0,ratio:{},submitIsLoading:!1,setSubmitIsLoading:t=>{a(()=>({submitIsLoading:t}))},setRatio:t=>{a(()=>({ratio:t}))},setDisplayToken0Value:t=>{a(()=>({displayToken0Value:t}))},setDisplayToken1Value:t=>{a(()=>({displayToken1Value:t}))},setAddToken0:t=>{a(()=>({addToken0:t}))},setAddToken1:t=>{a(()=>({addToken1:t}))},setCurrentFeeTier:t=>{const o=us(t);a(()=>({currentFeeTier:t,priceRangePercentage:o,defaultPriceRangePercentage:o}))},setCurrentApiPoolInfo:t=>{a(()=>({currentApiPoolInfo:t}))},setCurrentContractPoolInfo:t=>{a(()=>({currentContractPoolInfo:t}))},setCurrentPrice:t=>{a(()=>({currentPrice:t,inversePrice:v(1).div(t).toString()}))},setBaseCoin:t=>{a(()=>({baseCoin:t}))},setCurrentApiPoolInfoIsLoading:t=>{a(()=>({currentApiPoolInfoIsLoading:t}))},setCurrentContractPoolInfoIsLoading:t=>{a(()=>({currentContractPoolInfoIsLoading:t}))},setPriceRangePercentage:t=>{a(()=>({priceRangePercentage:t}))},saveMinPriceData:t=>{a(()=>({minPriceData:t}))},saveMaxPriceData:t=>{a(()=>({maxPriceData:t}))},setPrecomputationInfo:t=>{a(()=>({precomputationInfo:t}))},currentPoolPositions:[],setCurrentPoolPositions:t=>{a(()=>({currentPoolPositions:t}))},currentPoolPositionsIsLoading:!0,setCurrentPoolPositionsIsLoading:t=>{a(()=>({currentPoolPositionsIsLoading:t}))},isShowMinMaxDist:!1,setIsShowMinMaxDist:t=>{a(()=>({isShowMinMaxDist:t}))},minDistPercentange:"",maxDistPercentange:"",setMinDistPercentange:t=>{a(()=>({minDistPercentange:t}))},setMaxDistPercentange:t=>{a(()=>({maxDistPercentange:t}))},rangeChartType:"Liquidity",setRangeChartType:t=>{a(()=>({rangeChartType:t}))},resetLiquidityState:()=>{a(()=>({displayToken0Value:"",displayToken1Value:"",addToken0:void 0,addToken1:void 0,currentApiPoolInfo:null,currentContractPoolInfo:null,currentPrice:"",inversePrice:"",baseCoin:"",currentApiPoolInfoIsLoading:!0,currentContractPoolInfoIsLoading:!0,minPrice:"",maxPrice:"",lowerTick:"",upperTick:"",priceRangePercentage:0,defaultPriceRangePercentage:0,minPriceData:void 0,maxPriceData:void 0,precomputationInfo:void 0,ratio:{},submitIsLoading:!1,currentPoolPositionsIsLoading:!0,currentPoolPositions:[],isShowMinMaxDist:!1,rangeChartType:"Liquidity"}))}})),se=ra,_s=a=>{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=a.getUTCFullYear(),s=t[a.getUTCMonth()],n=a.getUTCDate();return`${s} ${n}, ${o} (UTC)`};function oa(){const{currentApiPoolInfo:a}=se(),[t,o]=l.useState("Volume"),[s,n]=l.useState("1D"),c=l.useMemo(()=>{if(a)return console.log({radioValue:s,currentTab:t}),{date_type:s=="1D"?"day":s=="7D"?"week":"month",histogram_type:t==="Volume"?"vol":"pure_tvl",limit:s=="1D"?40:s=="7D"?30:20,pool_address:a.address}},[a,s,t]),i=d=>{console.log("handleRadioChange value: ",d),n(d)},h=()=>e.jsx(K,{h:"20px",children:e.jsx(Ke,{options:["1D","7D","30D"],size:"s",value:s,onChange:i})}),{windowWidth:x}=$e();return e.jsxs(q,{w:"100%",align:"flex-start",gap:"0",borderRadius:"12px",children:[e.jsxs(K,{w:"100%",align:"center",justify:"space-between",children:[e.jsx(N,{children:e.jsx(St,{w:"90px",h:"28px",p:"4px",borderRadius:"4px",currentTab:t,textList:["Volume","Liquidity"],onClick:d=>{o(d)}})}),x>810&&h()]}),t==="Volume"&&e.jsx(ca,{requestParams:c,RadioCardGroupNode:h()}),t==="Liquidity"&&e.jsx(la,{requestParams:c,RadioCardGroupNode:h()})]})}function Es(a){const{windowWidth:t}=$e(),{label:o,value:s,time:n,RadioCardGroupNode:c}=a;return e.jsxs(N,{children:[e.jsx(K,{w:"100%",justify:"space-between",mt:"12px",children:e.jsxs(q,{gap:"0",align:"flex-start",children:[e.jsx(w,{fontSize:"xs",children:o}),e.jsx(w,{fontSize:"2xl",color:"text_caption",children:qe(s,2)})]})}),e.jsx(w,{w:"100%",mb:"12px",fontSize:"xs",children:n}),t<=810&&e.jsx(N,{mb:"20px",children:c})]})}function ca(a){const{requestParams:t,RadioCardGroupNode:o}=a,{loading:s,dataList:n,getHistogramData:c}=Rs(),i=l.useMemo(()=>n.slice().reverse(),[n]);l.useEffect(()=>{t&&c(t)},[t]);const[h,x]=l.useState(null),d=y=>{if(y&&y.activePayload&&y.activePayload.length){const k=y.activePayload[0];x(k.payload)}},u=()=>{},r=l.useMemo(()=>h?_s(new Date(h.time)):"",[h]);l.useEffect(()=>{i.length>0?x(i[0]):x(null)},[i]);const j=(i==null?void 0:i.length)>0?Math.floor(Math.min(...i.map(y=>y.pv))):0,m=Math.ceil(Math.max(...i.map(y=>y.pv)));return e.jsxs(N,{width:"100%",children:[e.jsx(Es,{label:"Trading Volume (24H)",value:(h==null?void 0:h.pv)||"0",time:r,RadioCardGroupNode:o}),s?e.jsx(q,{p:"20px 0px 70px",h:"178px",justifyContent:"center",sx:{"@media screen and (max-width: 810px)":{h:"200px"}},children:e.jsx(Ze,{})}):(i==null?void 0:i.length)==0?e.jsx(q,{p:"40px 0px 50px",h:"178px",justifyContent:"center",sx:{"@media screen and (max-width: 810px)":{h:"200px"}},children:e.jsx(Ne,{type:"nodata",noBg:!0,text:"No token data yet"})}):e.jsx(gs,{width:"100%",height:200,children:e.jsxs(si,{data:i,barSize:5,barCategoryGap:120,onMouseEnter:d,onMouseMove:d,onMouseLeave:u,margin:{top:8,right:8,left:8,bottom:0},children:[e.jsx(ys,{cursor:{stroke:"var(--chakra-colors-primary)",strokeWidth:10,strokeDasharray:"3 2"},content:e.jsx(zs,{type:"Volume"})}),e.jsx(ii,{dataKey:"pv",fill:"var(--chakra-colors-primary)",className:"custom-bar"}),e.jsx(js,{domain:[j,m],hide:!0}),e.jsx(ks,{scale:"point",dataKey:"time",reversed:!0,tickLine:!1,tick:Ls,interval:(i==null?void 0:i.length)<10?0:parseInt(String((i==null?void 0:i.length)/6))}),h&&e.jsx(ai,{x:h.time,stroke:"var(--chakra-colors-chart_tooltip_line)",strokeDasharray:"3 3"})]})})]})}function la(a){const{requestParams:t,RadioCardGroupNode:o}=a,{loading:s,dataList:n,getHistogramData:c}=Rs(),i=l.useMemo(()=>n.reverse(),[n]),h=(i==null?void 0:i.length)>0?Math.floor(Math.min(...i.map(y=>y.pv))):0,x=Math.ceil(Math.max(...i.map(y=>y.pv)));l.useEffect(()=>{t&&c(t)},[t]);const[d,u]=l.useState(null),r=y=>{if(y&&y.activePayload&&y.activePayload.length){const k=y.activePayload[0];u(k.payload)}},j=()=>{},m=l.useMemo(()=>d?_s(new Date(d.time)):"",[d]);return l.useEffect(()=>{i.length>0?u(i[0]):u(null)},[i]),e.jsxs(N,{width:"100%",children:[e.jsx(Es,{label:"Liquidity",value:(d==null?void 0:d.pv)||"0",time:m,RadioCardGroupNode:o}),s?e.jsx(q,{p:"20px 0px 70px",h:"178px",justifyContent:"center",sx:{"@media screen and (max-width: 810px)":{h:"200px"}},children:e.jsx(Ze,{})}):(i==null?void 0:i.length)==0?e.jsx(q,{p:"40px 0px 50px",h:"178px",justifyContent:"center",sx:{"@media screen and (max-width: 810px)":{h:"200px"}},children:e.jsx(Ne,{type:"nodata",noBg:!0,text:"No token data yet"})}):e.jsx(gs,{width:"100%",height:200,children:e.jsxs(ni,{data:i,syncId:"Liquidity",onMouseEnter:r,onMouseMove:r,onMouseLeave:j,margin:{top:8,right:8,left:8,bottom:0},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--chakra-colors-primary)",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"var(--chakra-colors-primary)",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorPv",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--chakra-colors-primary)",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"var(--chakra-colors-primary)",stopOpacity:0})]})]}),e.jsx(ks,{dataKey:"time",reversed:!0,tickLine:!1,tick:Ls,interval:(i==null?void 0:i.length)<10?0:parseInt(String((i==null?void 0:i.length)/6))}),e.jsx(js,{domain:[h,x],hide:!0}),e.jsx(ys,{cursor:{stroke:"var(--chakra-colors-primary)",strokeWidth:1,strokeDasharray:"3 2"},content:e.jsx(zs,{type:"Liquidity"})}),e.jsx(ri,{type:"monotone",dataKey:"pv",stroke:"var(--chakra-colors-primary)",fill:"url(#colorUv)"})]})})]})}const Ls=a=>{const{x:t,y:o,payload:s,type:n}=a,c=new Date(s.value);["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][c.getUTCDay()];const h=Number(c.getUTCDate())>=10?`${c.getUTCDate()}`:`0${c.getUTCDate()}`;return e.jsx("g",{transform:`translate(${t},${o})`,children:e.jsx("text",{x:0,y:0,dy:n=="totalValue"?12:18,textAnchor:"middle",fill:"var(--chakra-colors-text_paragraph)",fontSize:12,children:h})})},zs=a=>null;function da(){const{currentApiPoolInfo:a,currentFeeTier:t}=se(),{getExplorerUrl:o}=rt(),{windowWidth:s}=$e();return e.jsxs(q,{w:"100%",align:"flex-start",children:[e.jsx(w,{children:"Pool Info"}),e.jsxs(B,{justify:"space-between",h:"80px",w:"100%",border:"1px solid",borderColor:"border",borderRadius:"8px",p:"12px",sx:{"@media screen and (max-width: 810px)":{display:"flex",flexDirection:"column",h:"unset"}},children:[e.jsxs(K,{w:"100%",align:"center",justify:"space-between",flexDirection:"column",sx:{"@media screen and (max-width: 810px)":{flexDirection:"row"}},children:[e.jsx(w,{fontSize:"xs",children:"Pool Address"}),e.jsxs(K,{alignItems:"center",children:[e.jsx(vt,{variant:"link",fontSize:"12px",children:Ve(a==null?void 0:a.address)}),e.jsx(N,{m:"0 4px",children:e.jsx(jt,{text:a==null?void 0:a.address})}),e.jsx(ce,{xlinkHref:"#icon-icon_lead",cursor:"pointer",transform:"rotate(-45deg)",onClick:()=>{window.open(o(a==null?void 0:a.address),"_blank")}})]})]}),e.jsx(Fe,{text:"Tick Spacing",textFontSize:"12px",valueFontSize:"12px",value:a==null?void 0:a.tickSpacing,isColumn:!(s<=810)}),e.jsx(Fe,{text:"Fee Tier",textFontSize:"12px",valueFontSize:"12px",value:Ct(t),isColumn:!(s<=810)})]})]})}function xa(a,t,o){const{tucanaSpotSDK:s}=Tt(),[n,c]=l.useState(["0","0"]),[i,h]=l.useState(["0","0"]),{getCointAmountValue:x}=bt(),d=l.useMemo(()=>x(n[0],t==null?void 0:t.metadata,2,!0),[n[0]]),u=l.useMemo(()=>x(n[1],o==null?void 0:o.metadata,2,!0),[n[1]]);return l.useEffect(()=>{a&&t&&o?s==null||s.Pool.getPoolTokenAmounts(a).then(r=>{console.log("------------------",r,o,t),c([_e(new Ye(r[0]),t.decimals).toString(),_e(new Ye(r[1]),o.decimals).toString()])}):c(["0","0"])},[a]),l.useEffect(()=>{try{if(a&&t&&o){const r=v(d).add(u);if(r.eq("0"))h(["--","--"]);else{const j=v(d).div(r).mul(100),m=v(100).sub(j);j.lessThanOrEqualTo(.01)?h(["<0.01","99.99"]):m.lessThanOrEqualTo(.01)?h(["99.99","<0.01"]):h([j.toFixed(2,Qt.ROUND_DOWN),m.toFixed(2,Qt.ROUND_UP)])}}else h(["--","--"])}catch{h(["--","--"])}},[d,u]),{tokenAmounts:n,tokenRatios:i,amount0Rate:d,amount1Rate:u}}function ua(){var x,d,u,r,j,m,y,k,p,R,E,L;const{getExplorerUrl:a}=rt(),{currentApiPoolInfo:t}=se(),{tokenAmounts:o,tokenRatios:s,amount0Rate:n,amount1Rate:c}=xa(t==null?void 0:t.address,t==null?void 0:t.token0,t==null?void 0:t.token1),{isImportToken:i}=lt(),h=(t==null?void 0:t.isReverse)||!1;return e.jsxs(q,{w:"100%",align:"flex-start",children:[e.jsx(w,{children:"Pool Composition"}),e.jsxs(B,{justify:"space-between",w:"100%",h:"132px",align:"center",border:"1px solid",borderColor:"border",borderRadius:"8px",p:"12px",sx:{"@media screen and (max-width: 810px)":{display:"flex",flexDirection:"column",h:"unset"}},children:[e.jsxs(q,{w:"50%",sx:{"@media screen and (max-width: 810px)":{w:"100%"}},children:[e.jsxs(B,{w:"100%",align:"center",justify:"space-between",children:[e.jsxs(B,{gap:"4px",children:[e.jsx(N,{children:e.jsx(Ge,{imageUrl:(x=t==null?void 0:t.displayToken0)==null?void 0:x.image,w:"20px",h:"20px",showTag:i((d=t==null?void 0:t.displayToken0)==null?void 0:d.metadata),showTagWidth:"12px",showTagHeight:"12px"})}),e.jsx(re,{fontSize:"xs",children:((u=t==null?void 0:t.displayToken0)==null?void 0:u.symbol)||""})]}),e.jsxs(B,{alignItems:"center",children:[e.jsx(it,{href:a((r=t==null?void 0:t.displayToken0)==null?void 0:r.metadata,"accounts"),fontSize:"xs",target:"_blank",children:Ve((j=t==null?void 0:t.displayToken0)==null?void 0:j.metadata)}),e.jsx(jt,{text:((m=t==null?void 0:t.displayToken0)==null?void 0:m.metadata)||""})]})]}),e.jsx(w,{}),e.jsx(Fe,{text:"Amount",textFontSize:"12px",valueFontSize:"12px",value:Xe(o[h?1:0]).toString()}),e.jsx(w,{w:"100%",align:"right",fontSize:"xs",mt:"-12px",children:`${qe(h?c:n,2)}`}),e.jsx(Fe,{text:"Token Ratio",textFontSize:"12px",valueFontSize:"12px",value:`${s[h?1:0]}%`})]}),e.jsx(N,{w:"1px",h:"92px",bg:"border",m:"0 24px",sx:{"@media screen and (max-width: 810px)":{w:"100%",h:"1px",m:"12px 24px"}}}),e.jsxs(q,{w:"50%",sx:{"@media screen and (max-width: 810px)":{w:"100%"}},children:[e.jsxs(B,{w:"100%",align:"center",justify:"space-between",children:[e.jsxs(B,{gap:"4px",children:[e.jsx(N,{children:e.jsx(Ge,{imageUrl:(y=t==null?void 0:t.displayToken1)==null?void 0:y.image,w:"20px",h:"20px",showTag:i((k=t==null?void 0:t.displayToken1)==null?void 0:k.metadata),showTagWidth:"12px",showTagHeight:"12px"})}),e.jsx(re,{fontSize:"xs",children:(p=t==null?void 0:t.displayToken1)==null?void 0:p.symbol})]}),e.jsxs(B,{alignItems:"center",children:[e.jsx(it,{href:a((R=t==null?void 0:t.displayToken1)==null?void 0:R.metadata,"accounts"),fontSize:"xs",target:"_blank",children:Ve((E=t==null?void 0:t.displayToken1)==null?void 0:E.metadata)}),e.jsx(jt,{text:((L=t==null?void 0:t.displayToken1)==null?void 0:L.metadata)||"0"})]})]}),e.jsx(w,{}),e.jsx(Fe,{text:"Amount",textFontSize:"12px",valueFontSize:"12px",value:Xe(o[h?0:1]).toString()}),e.jsx(w,{w:"100%",align:"right",fontSize:"xs",mt:"-12px",children:`${qe(h?n:c,2)}`}),e.jsx(Fe,{text:"Token Ratio",textFontSize:"12px",valueFontSize:"12px",value:`${s[h?0:1]}%`})]})]})]})}function ha(){const{currentApiPoolInfo:a}=se(),{getCointAmountValue:t}=bt(),o=l.useMemo(()=>{var n;if(a){const c=(n=a==null?void 0:a.rewarderApr)==null?void 0:n.reduce((i,h)=>v(i).add(h.apr).toNumber(),0);return Ue(v(c).mul(100).toNumber(),2)}return 0},[a]),s=l.useMemo(()=>{var c;const n=[];return(c=a==null?void 0:a.rewarderUSD)==null||c.forEach(i=>{if(v(i==null?void 0:i.amountSecond).gt(0)){const h=Ri(i==null?void 0:i.amountSecond),x=t(h,i.metadata);n.push({...i,dayAmount:h,dayAmountRate:x})}}),n},[a]);return e.jsxs(q,{w:"100%",p:"16px",justifyContent:"center",gap:"24px",bg:"card_bg",borderRadius:"16px",backdropFilter:"blur(10px)",children:[e.jsxs(q,{w:"100%",gap:"24px",children:[e.jsx(da,{}),e.jsx(ua,{})]}),e.jsxs(q,{w:"100%",align:"flex-start",children:[e.jsx(oa,{}),(s==null?void 0:s.length)>0&&e.jsxs(N,{w:"100%",mt:"8px",children:[e.jsx(w,{children:"Rewards"}),e.jsxs(B,{p:"20px",m:"12px 0",gap:"36px",align:"center",w:"100%",border:"1px solid",borderColor:"border",borderRadius:"8px",sx:{"@media screen and (max-width: 810px)":{display:"flex",flexDirection:"column",gap:"16px"}},children:[e.jsxs(K,{children:[e.jsx(w,{mr:"8px",fontSize:"md",children:"APR"}),e.jsxs(w,{color:"primary",fontSize:"md",children:[o,"%"]})]}),e.jsx(q,{align:"flex-start",children:s==null?void 0:s.map(n=>e.jsxs(B,{gap:"4px",children:[e.jsx(N,{children:e.jsx(Ge,{imageUrl:n==null?void 0:n.image,w:"20px",h:"20px"})}),e.jsxs(w,{fontSize:"xs",color:"text_caption",display:"inline-block",children:[n==null?void 0:n.dayAmount,e.jsxs(w,{fontSize:"xs",display:"inline-block",children:[" ($",n==null?void 0:n.dayAmountRate,") "]}),e.jsx(re,{fontSize:"xs",display:"inline-block",children:n==null?void 0:n.symbol}),"per day"]})]}))})]})]})]})]})}function ma(a){const{w:t,current:o,feeTierDistribution:s,feeTierDistributionLoading:n,onClick:c}=a,[i,h]=l.useState(!1),x=()=>{h(!0)},d=()=>{h(!1)},u=l.useMemo(()=>[{title:(s==null?void 0:s[Y.LOWEST])!==-1?`${Ae(s==null?void 0:s[Y.LOWEST],2)}% seclect`:"Not created",content:"Best for very stable pairs",percent:"0.01%",canCreate:(s==null?void 0:s[Y.LOWEST])===-1,value:Y.LOWEST},{title:(s==null?void 0:s[Y.LOW])!==-1?`${Ae(s==null?void 0:s[Y.LOW],2)}% seclect`:"Not created",content:"Best for stable pairs",percent:"0.05%",canCreate:(s==null?void 0:s[Y.LOW])===-1,value:Y.LOW},{title:(s==null?void 0:s[Y.MEDIUM])!==-1?`${Ae(s==null?void 0:s[Y.MEDIUM],2)}% seclect`:"Not created",content:"Best for most pairs",percent:"0.25%",canCreate:(s==null?void 0:s[Y.MEDIUM])===-1,value:Y.MEDIUM},{title:(s==null?void 0:s[Y.HIGH])!==-1?`${Ae(s==null?void 0:s[Y.HIGH],2)}% seclect`:"Not created",content:"Best for exotic pairs",percent:"1%",canCreate:(s==null?void 0:s[Y.HIGH])===-1,value:Y.HIGH}],[s]),r=j=>{console.log("SelectFeeTier item: ",j),c(j)};return e.jsx(N,{pb:"8px",onClick:()=>h(!i),onMouseLeave:d,onMouseEnter:x,children:e.jsx(ci,{isOpen:i,onClose:d,children:({isOpen:j})=>e.jsxs(e.Fragment,{children:[e.jsx(li,{w:t||"",p:"8px 12px",isActive:i,as:vt,bg:"bg_secondary",h:"34px",borderRadius:"8px",sx:{_hover:{bg:"card_bg",p:{color:"primary"},svg:{fill:"primary"}},_active:{bg:"card_bg",p:{color:"primary"},svg:{fill:"primary"}}},children:e.jsxs(K,{w:t||"",align:"center",justifyContent:"center",children:[e.jsxs(w,{color:"text_caption",mr:"4px",fontSize:"xs",children:[o&&Ct(o)," fee tier"]}),e.jsx(ce,{xlinkHref:"#icon-icon_open",variant:"gray",transition:"transform 0.5s",transform:i?"rotate(180deg)":"rotate(0deg)"})]})}),e.jsx(di,{p:"4px",opacity:"1",children:u.map(m=>e.jsx(xi,{p:"8px 12px",bg:m.value==o?"primary_10":"",borderRadius:"8px",sx:{_hover:{bg:"primary_10"}},onClick:()=>{h(!1),r(m)},children:e.jsxs(K,{w:"100%",align:"center",justifyContent:"space-between",children:[e.jsxs(q,{gap:"0",align:"flex-start",children:[e.jsx(w,{color:"primary",fontSize:"xs",children:m.title}),e.jsx(w,{fontSize:"xs",children:m.content})]}),e.jsx(w,{color:m.value==o?"primary":"text_caption",ml:"12px",children:m.percent})]})},m.value))})]})})})}function pa(a){const{isOpen:t,onClose:o,onChange:s}=a,[n,c]=l.useState("");return l.useEffect(()=>{t||c("")},[t]),e.jsxs(ui,{isOpen:t,onClose:o,isCentered:!0,children:[e.jsx(hi,{}),e.jsxs(mi,{children:[e.jsx(pi,{children:"Select Pool"}),e.jsx(gi,{}),e.jsxs(yi,{pb:"16px",w:"100%",minH:"400px",maxH:"calc(100vh - 40px)",children:[e.jsx(Ns,{searchText:n,placeholder:"Search by token or pool address",onChange:i=>{c(i)}}),e.jsx(N,{mt:"20px",w:"100%",h:"1px",bg:"border"}),e.jsx(ga,{searchText:n,onChange:i=>{s(i),o()}})]})]})]})}function ga(a){const{onChange:t,searchText:o}=a,[s,n]=l.useState(Oe.OfficialPools),{filterPoolList:c}=Ei(o,s),i=l.useMemo(()=>c.sort((x,d)=>{var u,r;return v(((u=d.volUSD)==null?void 0:u.day)||"0").sub(((r=x.volUSD)==null?void 0:r.day)||"0").toNumber()}),[c]),h=l.useMemo(()=>s===Oe.AllPools,[s]);return e.jsxs(N,{w:"100%",pt:"20px",minHeight:"300px",maxH:"calc(100vh - 180px)",overflowY:"scroll",children:[e.jsxs(B,{justifyContent:"space-between",children:[e.jsx(w,{children:"Pool"}),e.jsxs(K,{alignItems:"center",children:[e.jsx($s,{checked:h,onClick:()=>{s===Oe.AllPools?n(Oe.OfficialPools):n(Oe.AllPools)}}),e.jsx(w,{ml:"14px",color:h?"primary":"text_paragraph",children:"Display All Pools"})]})]}),c.length===0&&e.jsx(N,{mt:"40px",children:e.jsx(Ne,{type:"nodata",background:"transparent",h:"80px",text:"No pool found"})}),i.map((x,d)=>e.jsxs(N,{children:[e.jsx(ya,{pool:x,onChange:t},d),d!==c.length-1&&e.jsx(N,{w:"100%",h:"1px",bg:"border"})]}))]})}function ya(a){var n,c,i,h,x,d;const{onChange:t,pool:o}=a,{isImportToken:s}=lt();return e.jsxs(B,{w:"100%",h:"65px",justifyContent:"space-between",cursor:"pointer",_hover:{opacity:"0.8"},onClick:()=>t(o),children:[e.jsxs(B,{gap:"10px",alignItems:"center",children:[e.jsx(N,{children:e.jsx(wt,{w:"40px",coinAIconUrl:(n=o==null?void 0:o.displayToken0)==null?void 0:n.image,coinBIconUrl:(c=o==null?void 0:o.displayToken1)==null?void 0:c.image,variant:"border",showATag:s((i=o==null?void 0:o.displayToken0)==null?void 0:i.metadata),showBTag:s((h=o==null?void 0:o.displayToken1)==null?void 0:h.metadata)})}),e.jsxs(B,{gap:"2px",children:[e.jsx(re,{color:"text_caption",fontSize:"md",children:(x=o==null?void 0:o.displayToken0)==null?void 0:x.symbol}),e.jsx(w,{color:"text_caption",fontSize:"md",children:"-"}),e.jsx(re,{color:"text_caption",fontSize:"md",children:(d=o==null?void 0:o.displayToken1)==null?void 0:d.symbol})]})]}),e.jsx(w,{mt:"4px",p:"0px 8px",color:"primary",fontSize:"xs",minW:"52px",h:"16px",lineHeight:"16px",borderRadius:"8px",bg:"bg_secondary",textAlign:"center",children:Ct(o==null?void 0:o.feeTier)})]})}function Rt(){Mt();const{setBaseCoin:a,baseCoin:t,addToken0:o,addToken1:s,currentPrice:n,currentContractPoolInfo:c,currentApiPoolInfo:i,currentFeeTier:h,minPriceData:x,maxPriceData:d,saveMinPriceData:u,saveMaxPriceData:r,defaultPriceRangePercentage:j,priceRangePercentage:m,setPriceRangePercentage:y,isShowMinMaxDist:k,setIsShowMinMaxDist:p}=se(),R=l.useMemo(()=>c==null?void 0:c.tick_spacing,[c]),E=l.useMemo(()=>o||(i==null?void 0:i.token0),[o,i]),L=l.useMemo(()=>s||(i==null?void 0:i.token1),[s,i]),z=(b,g,T,f,M)=>{const U=g,A=T;U&&A&&f?b===100?(u(Ee.buildMinTickPriceData(f,U,A)),r(Ee.buildMaxTickPriceData(f,U,A))):(u(Ee.buildTickPriceData(v(M).mul(v(1).minus(v(b).div(100))).toString(),f,U,A)),r(Ee.buildTickPriceData(v(M).mul(v(1).add(v(b).div(100))).toString(),f,U,A))):(u(void 0),r(void 0))},F=b=>{u(b)},$=b=>{r(b)},{isFullRange:D,handleMinPriceClick:S,handleMaxPriceClick:H,onInputPriceChange:V}=zi({minPriceData:x,maxPriceData:d,saveMinPriceData:u,saveMaxPriceData:r,token0:E,token1:L,tickSpacing:R});return{minPriceData:x,maxPriceData:d,handleBaseCoinChange:b=>{var g;try{const T=i==null?void 0:i.token0,f=i==null?void 0:i.token1,M=c==null?void 0:c.tick_spacing;a(b),b!==t&&T&&f&&x&&d&&(F(d.getInverseTickPrice()),$(x.getInverseTickPrice()));const U=b===((g=i==null?void 0:i.token0)==null?void 0:g.symbol)}catch(T){console.log("handleBaseCoinChange error: ",T)}},handleMinPriceClick:S,handleMaxPriceClick:H,isFullRange:D,handleChangeRange:z,handleChangeMinPrice:F,handleChangeMaxPrice:$,handleInputPriceChange:(b,g,T)=>{console.log("🚀 ~ file: useLiquiditySelectRange.ts:96 ~ handleInputPriceChange ~ price:",b),console.log("🚀 ~ file: useLiquiditySelectRange.ts:96 ~ handleInputPriceChange ~ isMin:",g),console.log("🚀 ~ file: useLiquiditySelectRange.ts:96 ~ handleInputPriceChange ~ isInputComplete:",T),V(b,g,T),p(!0)},handleInputBlur:(b,g,T)=>{console.log("🚀 ~ file: useLiquiditySelectRange.ts:96 ~ handleInputBlur ~ price:",b),console.log("🚀 ~ file: useLiquiditySelectRange.ts:96 ~ handleInputBlur ~ isMin:",g),console.log("🚀 ~ file: useLiquiditySelectRange.ts:96 ~ handleInputBlur ~ isInputComplete:",T);let f=b;b===""&&(console.log("🚀 ~ file: useLiquiditySelectRange.ts:96 ~ handleInputBlur ~ price is empty:"),g?f=v(n).mul(v(1).minus(v(j).div(100))).toString():f=v(n).mul(v(1).add(v(j).div(100))).toString()),V(f,g,T),p(!0)}}}function _t(){const{baseCoin:a,currentApiPoolInfo:t,currentPrice:o,inversePrice:s}=se(),n=l.useMemo(()=>{var i,h;return a&&t?(console.log("displayCurrentPrice baseCoin: ",a),console.log("displayCurrentPrice currentApiPoolInfo?.token0?.symbol: ",(i=t==null?void 0:t.token0)==null?void 0:i.symbol),a===((h=t==null?void 0:t.token0)==null?void 0:h.metadata)?st(o):st(s)):""},[a,o,s,t]),c=l.useMemo(()=>{var i;return a&&t?a===((i=t==null?void 0:t.token0)==null?void 0:i.metadata)?`${De(t==null?void 0:t.token1.symbol)} per ${De(t==null?void 0:t.token0.symbol)}`:`${De(t==null?void 0:t.token0.symbol)} per ${De(t==null?void 0:t.token1.symbol)}`:""},[a,o,s,t]);return{displayCurrentPrice:n,displayPerText:c}}function Hs(){const{tucanaSpotSDK:a}=Tt(),{getCointAmountValue:t}=bt(),{setCurrentPoolPositions:o,setCurrentPoolPositionsIsLoading:s}=se();return{getCurrentPoolPositions:async(c,i,h)=>{try{s(!0);const x=[],d=await(a==null?void 0:a.Position.getPositionList(h,i?[i.position_collection]:[]));d==null||d.forEach(u=>{var r,j,m,y;if((u==null?void 0:u.pool_address)===(c==null?void 0:c.id)){const k=u.tick_lower_index===oe.getInitializableTickIndex(xt,i.tick_spacing)?"0":oe.tickIndexToPrice(u.tick_lower_index,(r=c==null?void 0:c.token0)==null?void 0:r.decimals,(j=c==null?void 0:c.token1)==null?void 0:j.decimals).toString(),p=u.tick_upper_index===oe.getInitializableTickIndex(ut,i.tick_spacing)?"∞":oe.tickIndexToPrice(u.tick_upper_index,(m=c==null?void 0:c.token0)==null?void 0:m.decimals,(y=c==null?void 0:c.token1)==null?void 0:y.decimals).toString(),R=c!=null&&c.isReverse?p==="∞"?"0":v(1).div(p).toString():k,E=c!=null&&c.isReverse?k==="0"?"∞":v(1).div(k).toString():p,L=Ds(i==null?void 0:i.current_tick_index,u.tick_lower_index,u.tick_upper_index),z=Fs(u.liquidity,i.current_sqrt_price,u==null?void 0:u.tick_lower_index,u==null?void 0:u.tick_upper_index),F=_e(z==null?void 0:z.coinA,c.token0.decimals),$=_e(z==null?void 0:z.coinB,c.token1.decimals),D=F?t(F,c==null?void 0:c.token0.metadata,6,!0):"0",S=$?t($,c==null?void 0:c.token1.metadata,6,!0):"0",H=D!=="--"&&S!=="--"?v(D).add(S).toString():"--";x.push({posId:u==null?void 0:u.id,displayToken0:c.displayToken0,displayToken1:c==null?void 0:c.displayToken1,token0:c==null?void 0:c.token0,token1:c==null?void 0:c.token1,minPrice:st(R),maxPrice:st(E),status:L,liquidityRate:H,coinAmount0:F,coinAmount1:$,coinAmount0Rate:D,coinAmount1Rate:S,...u})}}),console.log("useGetCurrentPoolPositions getPositions positionList: ",x),o(x),s(!1)}catch(x){s(!1),o([]),console.log("useGetCurrentPoolPositions getPositions Error: ",x)}}}}function Bs(a){var le;dt();const{getAddLiquidityPaylod:t}=hs(),{signAndExecuteTransaction:o}=Us(),{slippage:s}=Os();Xt();const{addToken0:n,addToken1:c,currentApiPoolInfo:i,currentContractPoolInfo:h,baseCoin:x,displayToken0Value:d,displayToken1Value:u,setDisplayToken0Value:r,setDisplayToken1Value:j,minPriceData:m,maxPriceData:y,precomputationInfo:k,setPrecomputationInfo:p,currentFeeTier:R,ratio:E,submitIsLoading:L,setSubmitIsLoading:z}=se();Hs();const{fetchTokenBalances:F}=Xt(),$=l.useMemo(()=>{var he,ne,ge;const O=x===((he=i==null?void 0:i.token0)==null?void 0:he.metadata);console.log("🚀 ~ file: useLiquidityDeposit.ts:52 ~ currentPriceStatusParams ~ direct:",O);const W=O?m:y==null?void 0:y.getInverseTickPrice();console.log("🚀 ~ file: useLiquidityDeposit.ts:54 ~ currentPriceStatusParams ~ minPriceTickData:",W);const P=O?y:m==null?void 0:m.getInverseTickPrice();console.log("🚀 ~ file: useLiquidityDeposit.ts:56 ~ currentPriceStatusParams ~ maxPriceTickData:",P);const de=h==null?void 0:h.current_tick_index;console.log("🚀 ~ file: useLiquidityDeposit.ts:58 ~ currentPriceStatusParams ~ currentTick:",de);const ke=W==null?void 0:W.tick,ue=P==null?void 0:P.tick;return{currentTick:de,lower:ke,upper:ue,metadata0:(ne=i==null?void 0:i.token0)==null?void 0:ne.metadata,metadata1:(ge=i==null?void 0:i.token1)==null?void 0:ge.metadata}},[i,h,m==null?void 0:m.fixsUiPrice,y==null?void 0:y.fixsUiPrice]),D=qi($);l.useEffect(()=>{console.log("useLiquidityDeposit currentPriceStatus: ",D)},[D]);const S=Jt(i==null?void 0:i.displayToken0),H=Jt(i==null?void 0:i.displayToken1),{isDisabled:V,submitBtnText:J}=Ni(L,n,c,D,d,u,S,H),{displayPerText:G,displayCurrentPrice:_}=_t(),[b,g]=l.useState(),T=l.useMemo(()=>{var O;return x===((O=i==null?void 0:i.displayToken0)==null?void 0:O.metadata)?"column":"column-reverse"},[x,(le=i==null?void 0:i.displayToken0)==null?void 0:le.metadata]),M=kt((O,W)=>{var ee,Le,ye,Se,Te,je,Re,ze,Je;const P=x===((ee=i==null?void 0:i.token0)==null?void 0:ee.metadata),de=((Le=i==null?void 0:i.token0)==null?void 0:Le.metadata)===((ye=i==null?void 0:i.displayToken0)==null?void 0:ye.metadata),ke=P?m:y==null?void 0:y.getInverseTickPrice(),ue=P?y:m==null?void 0:m.getInverseTickPrice(),he=ke==null?void 0:ke.tick,ne=ue==null?void 0:ue.tick,ge=h==null?void 0:h.current_sqrt_price,Me=(W==null?void 0:W.metadata)===((Se=i==null?void 0:i.token0)==null?void 0:Se.metadata),we=(W==null?void 0:W.metadata)===((Te=i==null?void 0:i.displayToken0)==null?void 0:Te.metadata),fe=ht(O,W==null?void 0:W.decimals);if(console.log("🚀 ~ file: useLiquidityDeposit.ts:110 ~ preAdd ~ value:",O),console.log("🚀 ~ file: useLiquidityDeposit.ts:110 ~ preAdd ~ amount:",fe.toString()),!fe||v(fe.toString()).equals(0)){we?j(""):r("");return}if(he===void 0||ne===void 0||!ge)return;const me=oe.sqrtPriceX64ToTickIndex(new Ye(ge));if(v(me).gte(he)&&v(me).lt(ne)){const He=_i.estLiquidityAndcoinAmountFromOneAmounts(he,ne,fe,Me,!0,0,new Ye(ge));p(He),we?j(de?_e(He.coinAmountB,(je=i==null?void 0:i.token1)==null?void 0:je.decimals):_e(He.coinAmountA,(Re=i==null?void 0:i.token0)==null?void 0:Re.decimals)):r(de?_e(He.coinAmountA,(ze=i==null?void 0:i.token0)==null?void 0:ze.decimals):_e(He.coinAmountB,(Je=i==null?void 0:i.token1)==null?void 0:Je.decimals))}else p(void 0),v(me).lt(he)?de?j(""):r(""):de?r(""):j("")},500),U=O=>{r(O),g(i==null?void 0:i.displayToken0),M(O,i==null?void 0:i.displayToken0)},A=O=>{j(O),g(i==null?void 0:i.displayToken1),M(O,i==null?void 0:i.displayToken1)};l.useEffect(()=>{var O;b&&(d||u)&&M((b==null?void 0:b.metadata)===((O=i==null?void 0:i.displayToken0)==null?void 0:O.metadata)?d:u,b)},[y==null?void 0:y.fixsUiPrice,m==null?void 0:m.fixsUiPrice,b==null?void 0:b.metadata]);const I=$i(i==null?void 0:i.displayToken0,i==null?void 0:i.displayToken1,d,u);return{handleDisplayToken0ValueChange:U,handleDisplayToken1ValueChange:A,inputBoxDirection:T,currentPriceStatus:D,fixedToken:b,totalRate:I,getSecondaryModalData:()=>{var W,P;return{token0:n,token1:c,amount0:((W=i==null?void 0:i.displayToken0)==null?void 0:W.metadata)===(n==null?void 0:n.metadata)?d:u,amount1:((P=i==null?void 0:i.displayToken0)==null?void 0:P.metadata)===(n==null?void 0:n.metadata)?u:d,fee:v(R).div(Math.pow(10,4)).toString(),ratio:E,totalRate:I,minPrice:m==null?void 0:m.fixsUiPrice,maxPrice:y==null?void 0:y.fixsUiPrice,displayPerText:G,displayCurrentPrice:_,currentPriceStatus:D}},handleSubmitAdd:async()=>{var O,W,P,de,ke,ue,he,ne,ge,Me;z(!0);try{const we=(b==null?void 0:b.metadata)===((O=i==null?void 0:i.token0)==null?void 0:O.metadata),fe=x===((W=i==null?void 0:i.token0)==null?void 0:W.metadata),me=fe?m:y==null?void 0:y.getInverseTickPrice(),ee=fe?y:m==null?void 0:m.getInverseTickPrice(),Le=((P=i==null?void 0:i.displayToken0)==null?void 0:P.metadata)===((de=i==null?void 0:i.token0)==null?void 0:de.metadata);let ye="0",Se="0";if(k)ye=k!=null&&k.fix_amount_a?(ke=k==null?void 0:k.coinAmountA)==null?void 0:ke.toString():v((ue=k==null?void 0:k.coinAmountA)==null?void 0:ue.toString()).mul(v(1).add(s)).toString(),Se=k!=null&&k.fix_amount_a?v((ne=k==null?void 0:k.coinAmountB)==null?void 0:ne.toString()).mul(v(1).add(s)).toString():(he=k==null?void 0:k.coinAmountB)==null?void 0:he.toString();else{const Te=ht(d,(ge=i==null?void 0:i.displayToken0)==null?void 0:ge.decimals).toString(),je=ht(u,(Me=i==null?void 0:i.displayToken1)==null?void 0:Me.decimals).toString(),Re=Le?Te:je,ze=Le?je:Te;ye=Re,Se=ze}if(i!=null&&i.id&&(me==null?void 0:me.tick)!==void 0&&(ee==null?void 0:ee.tick)!==void 0){const Te={pool_id:i==null?void 0:i.id,tick_lower:me==null?void 0:me.tick,tick_upper:ee==null?void 0:ee.tick,fix_amount_a:we,offer_amount_a:String(Ue(ye,0)),offer_amount_b:String(Ue(Se,0))};console.log("handleSubmitAdd slippage: ",s),console.log("handleSubmitAdd params: ",Te);const je=t(Te);if(console.log("handleSubmitAdd payload: ",je),!je)throw Error("payload is undefined");const Re=await o([je],{action:Ws.Add,description:"Add Liquidity",coinA:{...i==null?void 0:i.displayToken0,amount:d},coinB:{...i==null?void 0:i.displayToken1,amount:u}});z(!1),console.log("handleSubmitAdd response: ",Re),r(""),j(""),await Vs(3e3),a&&a(),F()}}catch(we){console.log("handleSubmitAdd error: ",we),z(!1)}},displayToken0Balance:S,displayToken1Balance:H,isDisabled:V,submitBtnText:J}}function ja(){const{currentFeeTier:a,addToken0:t,addToken1:o,currentApiPoolInfo:s,currentContractPoolInfo:n,currentPrice:c,inversePrice:i,setBaseCoin:h,baseCoin:x,priceRangePercentage:d,setPriceRangePercentage:u,isShowMinMaxDist:r,setIsShowMinMaxDist:j,minDistPercentange:m,maxDistPercentange:y}=se(),{minPriceData:k,maxPriceData:p,handleMinPriceClick:R,handleMaxPriceClick:E,isFullRange:L,handleChangeRange:z,handleInputPriceChange:F,handleInputBlur:$,handleBaseCoinChange:D,handleChangeMinPrice:S,handleChangeMaxPrice:H}=Rt(),{currentPriceStatus:V}=Bs(),{displayPerText:J}=_t(),[G,_]=l.useState(""),b=f=>{console.log("handleRadioChange value: ",f),_(f),f==="0.1%"&&u(.1),f==="0.5%"&&u(.5),f==="1%"&&u(1),f==="5%"&&u(5),f==="10%"&&u(10),f==="20%"&&u(20),f==="50%"&&u(50),f==="Full Range"&&u(100),j(!1)},g=l.useMemo(()=>{var f,M,U,A,I,ie;return(f=s==null?void 0:s.displayToken0)!=null&&f.symbol&&((M=s==null?void 0:s.displayToken1)!=null&&M.symbol)?[{key:(U=s==null?void 0:s.displayToken0)==null?void 0:U.metadata,label:De((A=s==null?void 0:s.displayToken0)==null?void 0:A.symbol,8)},{key:(I=s==null?void 0:s.displayToken1)==null?void 0:I.metadata,label:De((ie=s==null?void 0:s.displayToken1)==null?void 0:ie.symbol,8)}]:[]},[s]),T=f=>{u(f),j(!1)};return l.useEffect(()=>{var f;switch(d){case .1:_("0.1%");break;case .5:_("0.5%");break;case 1:_("1%");break;case 5:_("5%");break;case 10:_("10%");break;case 20:_("20%");break;case 50:_("50%");break;case 100:_("Full Range");break;default:_("")}if(s!=null&&s.token0&&(s!=null&&s.token1)&&c&&(n!=null&&n.tick_spacing)){const M=x===((f=s==null?void 0:s.token0)==null?void 0:f.metadata);z(d,M?s==null?void 0:s.token0:s==null?void 0:s.token1,M?s==null?void 0:s.token1:s==null?void 0:s.token0,n==null?void 0:n.tick_spacing,M?c:i)}},[d]),l.useMemo(()=>{var f;if(x&&x===((f=s==null?void 0:s.token0)==null?void 0:f.metadata))return!0},[x,s]),e.jsxs(q,{w:"100%",gap:"16px",p:"16px",bg:"card_bg",borderRadius:"16px",backdropFilter:"blur(10px)",children:[e.jsxs(B,{w:"100%",justify:"space-between",children:[e.jsx(w,{fontSize:"md",color:"text_caption",children:"Select Range"}),e.jsx(N,{minW:"140px",children:e.jsx(St,{w:"85px",h:"28px",p:"4px",borderRadius:"4px",currentTab:x,textList:g,onClick:D})})]}),e.jsx(Hi,{direction:"column",unit:J,min_price:(k==null?void 0:k.uiPrice)||"",max_price:(p==null?void 0:p.uiPrice)||"",handleMinPriceActoin:f=>{R(f),j(!0)},handleMaxPriceActoin:f=>{E(f),j(!0)},onInputPriceChange:F,onInputPriceBlur:$,isFullRange:L}),V==="error"&&e.jsx(N,{w:"100%",zIndex:100,children:e.jsx(w,{color:"error",fontSize:"12px",children:"The max price should be higher than min price."})}),e.jsxs(q,{w:"100%",justifyContent:"flex-start",children:[e.jsxs(B,{w:"100%",align:"center",gap:"4px",children:[e.jsx(w,{children:"Range Size"}),e.jsx(at,{label:"The Range Size measures the percentage difference between the range selected Min and Max bounds and the current price.","aria-label":"Range Size",placement:"right",sx:{"@media screen and (max-width: 810px)":{w:"200px"}},children:e.jsx("button",{children:e.jsx(ce,{xlinkHref:"#icon-icon_tips",variant:"grayprimary"})})})]}),e.jsxs(ji,{"aria-label":"slider-ex-1",value:r?0:d,min:0,max:100,onChange:T,children:[e.jsx(ki,{children:e.jsx(fi,{})}),e.jsx(Ti,{})]})]}),e.jsxs(B,{w:"100%",align:r?"flex-end":"center",justifyContent:"space-between",sx:{"@media screen and (max-width: 1150px)":{display:"flex",flexDirection:"column",alignItems:"flex-start"}},children:[!r&&G==="Full Range"?e.jsx(w,{fontSize:"md",color:"text_caption",lineHeight:"1",sx:{"@media screen and (max-width: 810px)":{fontSize:"sm"}},children:"Full Range"}):r?e.jsxs(B,{align:"center",children:[e.jsxs(q,{gap:"0",children:[e.jsx(w,{fontSize:"xs",children:"Min"}),e.jsxs(w,{fontSize:"md",color:"text_caption",lineHeight:"1",children:[Yt(m),"%"]})]}),e.jsx(w,{color:"text_caption",pt:"8px",fontSize:"md",lineHeight:"1",children:"/"}),e.jsxs(q,{gap:"0",children:[e.jsx(w,{fontSize:"xs",children:"Max"}),e.jsxs(w,{fontSize:"md",color:"text_caption",lineHeight:"1",children:[Yt(y),"%"]})]})]}):e.jsxs(w,{fontSize:"md",color:"text_caption",sx:{"@media screen and (max-width: 810px)":{fontSize:"sm"}},children:["±",d,"%"]}),mt&&mt[a]&&e.jsx(Ke,{h:"32px",options:mt[a]||[],value:r?"-1":G,onChange:b})]})]})}function ka(){const a=ct(Is),[t,o]=l.useState([]),[s,n]=l.useState(!0),[c,i]=l.useState(0);return{loading:s,dataList:t,fetchHistoryData:async x=>{n(!0);try{const d=new Date().getTime(),u=new URLSearchParams;u.append("timestamp",String(d)),u.append("id",String(x.pool_address)),u.append("limit",String(x.limit)),u.append("offset",String(x.offset)),x.event_type&&u.append("event_type",String(x.event_type));const j=await(await fetch(`${a}?${u.toString()}`)).json();if(console.log("fetchHistoryData: ",j),j&&j.data&&j.data.list){const m=j.data.list;m.forEach(y=>{y.eventType==="burn_event"&&(y.eventType="Remove Liquidity"),y.eventType==="mint_event"&&(y.eventType="Add Liquidity"),y.eventType==="swap_event"&&(y.eventType="Swap")}),i(Number(j.data.total)),o(m)}else o([]),i(0);n(!1)}catch(d){console.log(d,"fetchHistoryData"),n(!1)}},total:c}}const pt=10;function fa(a){const{windowWidth:t}=a,{currentApiPoolInfo:o}=se(),{fetchHistoryData:s,loading:n,dataList:c,total:i}=ka(),[h,x]=l.useState(1),{getExplorerUrl:d}=rt();l.useEffect(()=>{o&&u(1)},[o==null?void 0:o.address]);const u=p=>{x(p),s({limit:pt,pool_address:o==null?void 0:o.address,offset:(p-1)*pt})};if(n&&h===1&&i===0)return e.jsx(Ms,{});const r=p=>e.jsx(w,{color:"text_caption",fontSize:"xs",children:p==null?void 0:p.eventType}),j=p=>{let R=[];o!=null&&o.isReverse&&p.eventType!=="Swap"?R=p.items.slice().reverse():R=p==null?void 0:p.items;const E=R[0],L=R[1];return e.jsxs(q,{gap:"0px",align:"flex-end",children:[e.jsxs(B,{children:[e.jsx(Ge,{w:"20px",h:"20px",imageUrl:E==null?void 0:E.image}),e.jsx(w,{fontSize:"xs",color:"text_caption",children:Xe(E==null?void 0:E.amount)}),e.jsx(re,{fontSize:"xs",children:E==null?void 0:E.symbol})]}),(p==null?void 0:p.eventType)==="Swap"&&e.jsx(N,{mt:"-6px",children:e.jsx(ce,{xlinkHref:"#icon-icon_down",variant:"graygray"})}),(p==null?void 0:p.eventType)==="Add Liquidity"&&e.jsx(N,{mt:"-6px",children:e.jsx(ce,{xlinkHref:"#icon-icon_increase",variant:"graygray"})}),(p==null?void 0:p.eventType)==="Remove Liquidity"&&e.jsx(N,{mt:"-6px",children:e.jsx(ce,{xlinkHref:"#icon-icon_reduce4",variant:"graygray"})}),e.jsxs(B,{mt:"-4px",children:[e.jsx(Ge,{w:"20px",h:"20px",imageUrl:L==null?void 0:L.image}),e.jsx(w,{fontSize:"xs",color:"text_caption",children:Xe(L==null?void 0:L.amount)}),e.jsx(re,{fontSize:"xs",children:L==null?void 0:L.symbol})]}),e.jsx(w,{})]})},m=p=>e.jsx(K,{justifyContent:"flex-end",children:e.jsx(it,{href:d(p==null?void 0:p.tx,"tx"),variant:"link",color:"primary",fontSize:"xs",target:"_blank",children:Ve(p==null?void 0:p.tx)})}),y=p=>e.jsx(w,{fontSize:"xs",textAlign:"right",children:Xs(Date.parse(p==null?void 0:p.blockTime))}),k=p=>[{leftText:"Recent event",right:r(p)},{leftText:"Amounts",right:j(p),rowListAlign:"flex-start"},{leftText:"Transactions",right:m(p)},{leftText:"Time",right:y(p)}];return e.jsxs(q,{w:"100%",justifyContent:"center",gap:"0px",bg:"card_bg",backdropFilter:"blur(10px)",p:"8px",borderRadius:"12px",children:[e.jsx(bi,{w:"100%",children:t<=810?e.jsx(q,{w:"100%",children:n?[{},{},{}].map((p,R)=>e.jsx(q,{w:"100%",children:e.jsx(At,{isLoading:n})},R)):c==null?void 0:c.map((p,R)=>e.jsx(q,{w:"100%",children:e.jsx(At,{isLoading:n,rowList:k(p)})},p==null?void 0:p.tx))}):(c==null?void 0:c.length)>0&&e.jsxs(wi,{size:"sm",variant:"striped",children:[e.jsx(Si,{children:e.jsxs(Zt,{children:[e.jsx(Ie,{children:e.jsx(w,{fontWeight:"200",children:"Recent event"})}),e.jsx(Ie,{textAlign:"right",children:e.jsx(w,{fontWeight:"200",children:"Amounts"})}),e.jsx(Ie,{textAlign:"right",children:e.jsx(w,{fontWeight:"200",children:"Transactions"})}),e.jsx(Ie,{textAlign:"right",children:e.jsx(w,{fontWeight:"200",children:"Time"})})]})}),e.jsx(vi,{children:c.map((p,R)=>e.jsxs(Zt,{sx:{td:{background:R%2===0?"button_ghost_bg !important":"transparent",border:"none",_first:{borderRadius:"8px 0 0 8px"},_last:{borderRadius:"0px 8px 8px 0px"}}},children:[e.jsxs(et,{children:[" ",r(p)," "]}),e.jsx(et,{children:j(p)}),e.jsx(et,{children:m(p)}),e.jsx(et,{children:y(p)})]},p==null?void 0:p.tx))})]})}),c.length===0&&e.jsx(Ne,{type:"nodata"}),i<10?null:e.jsx(N,{m:"20px 0",children:e.jsx(Gs,{total:i,size:pt,currentPage:h,onChange:p=>{console.log({current:p}),u(p)}})})]})}function Ta(){const{address:a,onboard:t}=dt(),{currentPoolPositionsIsLoading:o,currentPoolPositions:s}=se();return e.jsxs(e.Fragment,{children:[!a&&e.jsx(Ne,{type:"nowallet",onboard:t}),a&&!o&&(s==null?void 0:s.length)===0&&e.jsx(Ne,{type:"nodata",text:"You have no liquidity positions"}),a&&o&&e.jsx(Ms,{}),a&&!o&&(s==null?void 0:s.length)>0&&e.jsx(q,{w:"100%",justifyContent:"center",gap:"8px",children:s==null?void 0:s.map(n=>e.jsx(ba,{info:n},`current-pool-positions-${n==null?void 0:n.posId}`))})]})}function ba(a){var i,h,x,d,u,r,j,m,y,k,p,R;const t=Mt(),{setCurrentPositionTab:o}=Wi(),{info:s}=a,{isImportToken:n}=lt(),c=(s==null?void 0:s.displayToken0.metadata)!==(s==null?void 0:s.token0.metadata);return e.jsxs(q,{w:"100%",align:"flex-start",bg:"card_bg",backdropFilter:"blur(10px)",borderRadius:"16px",p:"20px",position:"relative",onClick:()=>{o("increase"),t(`/position/${s==null?void 0:s.pool_address}/${s==null?void 0:s.posId}`)},children:[e.jsx(N,{position:"absolute",top:"0",right:"0",children:e.jsx(Qs,{borderRadius:"0px  16px",status:s==null?void 0:s.status,isActive:(s==null?void 0:s.status)==="Active"})}),e.jsxs(B,{children:[e.jsx(wt,{w:"32px",coinAIconUrl:(i=s.displayToken0)==null?void 0:i.image,coinBIconUrl:(h=s.displayToken1)==null?void 0:h.image,variant:"border",p:"4px",showATag:n((x=s.displayToken0)==null?void 0:x.metadata),showBTag:n((d=s.displayToken1)==null?void 0:d.metadata)}),e.jsxs(B,{gap:"0px",children:[e.jsx(re,{color:"Text_caption",children:(u=s==null?void 0:s.displayToken0)==null?void 0:u.symbol}),e.jsx(w,{color:"Text_caption",children:"-"}),e.jsx(re,{color:"Text_caption",children:(r=s==null?void 0:s.displayToken1)==null?void 0:r.symbol}),e.jsxs(w,{ml:"5px",color:"Text_caption",children:["LP (#",s==null?void 0:s.position_index,")"]})]})]}),e.jsxs(B,{w:"100%",justifyContent:"space-between",sx:{"@media screen and (max-width: 810px)":{flexDirection:"column",alignItems:"flex-start"}},children:[e.jsx(Di,{minPrice:s==null?void 0:s.minPrice,maxPrice:s==null?void 0:s.maxPrice,baseSymbol:(j=s==null?void 0:s.token0)==null?void 0:j.symbol,quoteSymbol:(m=s==null?void 0:s.token1)==null?void 0:m.symbol}),e.jsxs(K,{align:"center",gap:"10px",sx:{"@media screen and (max-width: 810px)":{w:"100%",justifyContent:"space-between"}},children:[e.jsx(w,{fontSize:"xs",children:"Liquidtity"}),e.jsx(at,{label:e.jsxs(q,{gap:"12px",p:"4px 0",minW:"280px",flexDirection:c?"column-reverse":"column",children:[e.jsx(Pt,{icon:((y=s==null?void 0:s.token0)==null?void 0:y.image)||"",amount:(s==null?void 0:s.coinAmount0)||"0",amountValue:(s==null?void 0:s.coinAmount0Rate)||"--",symbol:((k=s==null?void 0:s.token0)==null?void 0:k.symbol)||""}),e.jsx(Pt,{icon:((p=s==null?void 0:s.token1)==null?void 0:p.image)||"",amount:(s==null?void 0:s.coinAmount1)||"0",amountValue:(s==null?void 0:s.coinAmount1Rate)||"--",symbol:((R=s==null?void 0:s.token1)==null?void 0:R.symbol)||""})]}),"aria-label":"LiquidityRate",children:e.jsx("button",{children:e.jsx(w,{color:"text_caption",textDecoration:"underline dotted",dangerouslySetInnerHTML:{__html:`${qe(s==null?void 0:s.liquidityRate,2)}`}})})})]})]})]})}function wa(){const{tucanaSpotSDK:a}=Tt();return{getContractPool:async o=>{if(!o)return null;const s=await(a==null?void 0:a.Pool.getPool(o));return console.log("useContractPoolInfo getContractPool poolInfo: ",s),s}}}function Sa({handleClickRefresh:a}){var _,b;const{address:t,onboard:o}=dt(),{currentApiPoolInfo:s,displayToken0Value:n,displayToken1Value:c,submitIsLoading:i,setBaseCoin:h,baseCoin:x,addToken0:d,addToken1:u}=se(),{handleDisplayToken0ValueChange:r,handleDisplayToken1ValueChange:j,inputBoxDirection:m,currentPriceStatus:y,totalRate:k,handleSubmitAdd:p,getSecondaryModalData:R,displayToken0Balance:E,displayToken1Balance:L,isDisabled:z,submitBtnText:F}=Bs(a);Rt();const[$,D]=l.useState(!1),[S,H]=l.useState(!1),[V,J]=l.useState(),G=()=>{const g=R();console.log("handleOpenSecondaryModal data: ",g),J(g),H(!0)};return e.jsxs(q,{w:"100%",p:"16px",bg:"card_bg",borderRadius:"16px",backdropFilter:"blur(10px)",children:[e.jsxs(B,{w:"100%",justify:"space-between",mb:"8px",children:[e.jsx(w,{fontSize:"md",color:"text_caption",children:"Deposit Amounts"}),e.jsx(ce,{xlinkHref:"#icon-icon_slider",onClick:()=>D(!0)})]}),e.jsxs(q,{gap:"0px",w:"100%",flexDirection:m,children:[e.jsxs(N,{position:"relative",w:"100%",children:[y==="error"||y===((_=s==null?void 0:s.displayToken0)==null?void 0:_.metadata)?e.jsx(es,{notHaveText:y==="error"}):null,e.jsx(It,{noArrow:!0,currentCoin:d,amount:n,balance:E,onAmountChange:r})]}),e.jsx(K,{zIndex:"400",gap:"0px",h:"8px",onClick:()=>{var T,f,M;const g=x===((T=s==null?void 0:s.displayToken0)==null?void 0:T.metadata)?(f=s==null?void 0:s.displayToken1)==null?void 0:f.metadata:(M=s==null?void 0:s.displayToken0)==null?void 0:M.metadata;g&&h(g)},children:e.jsx("div",{className:"exchange liquidity-add"})}),e.jsxs(N,{position:"relative",w:"100%",children:[y==="error"||y===((b=s==null?void 0:s.displayToken1)==null?void 0:b.metadata)?e.jsx(es,{notHaveText:y==="error"}):null,e.jsx(It,{noArrow:!0,currentCoin:u,amount:c,balance:L,onAmountChange:j})]})]}),e.jsxs(B,{w:"100%",justify:"space-between",bg:"input_bg",h:"52px",p:"0 16px",borderRadius:"16px",border:"1px solid",borderColor:"border",children:[e.jsx(w,{fontSize:"md",children:"Total"}),e.jsxs(w,{fontSize:"16px",color:"text_caption",children:["$",Xe(k)]})]}),e.jsx(vt,{w:"100%",mt:"4px",size:"lg",onClick:()=>{t?G():o()},isLoading:i,isDisabled:z,children:F}),e.jsx(Vi,{isOpen:$,onClose:()=>D(!1)}),e.jsx(Fi,{data:V,isOpen:S,onClose:()=>{H(!1)},onClick:()=>{p(),H(!1)}})]})}const va=8;function ts(a,t,o,s,n,c){let i={...o},h=[];for(let x=n+(c?1:0);c?x<s.length:x>=0;c?x++:x--){const d=Number(s[x].tick),u={liquidityActive:i.liquidityActive,tick:d,liquidityNet:BigInt(s[x].liquidityNet),price0:oe.tickIndexToPrice(d,a.decimals,t.decimals).toFixed(va)};c?u.liquidityActive=i.liquidityActive+BigInt(s[x].liquidityNet):!c&&i.liquidityNet!==0n&&(u.liquidityActive=i.liquidityActive-i.liquidityNet),h.push(u),i=u}return c||(h=h.reverse()),h}const Ca=8,Ma=(a,t)=>a!==void 0&&t?Math.floor(a/Kt[t])*Kt[t]:void 0;function Ra(a){const t=ct(ei);hs();const o=d=>{if(console.log("getTicks args: ",d),console.log("getTicks args?.url: ",d==null?void 0:d.url),!!a)return ms(d==null?void 0:d.url,{id:d.id})},{data:s,error:n,isLoading:c,mutate:i}=Xi({url:t,id:a},o),h=()=>{i()},x=l.useMemo(()=>{const d=[];if(console.log("ticksData data: ",s),console.log("ticksData id: ",a),s&&(s!=null&&s.ticks))return console.log("ticksData data?.ticks: ",s==null?void 0:s.ticks),s==null||s.ticks.forEach(u=>{d.push({tick:Number(u.index),liquidityNet:u.liquidity_net,liquidityGross:u.liquidity_gross,id:u.id})}),d},[s]);return{isLoading:c,error:n,data:x,handleRefresh:h}}function _a(a){const t=Ra(a);return console.log("subgraphTickData: ",t),{isLoading:t.isLoading,error:t.error,ticks:t.data,handleRefresh:t.handleRefresh}}function Ea(a,t,o,s){const n=l.useMemo(()=>Ma(a==null?void 0:a.current_tick_index,s),[a,s]),c=l.useMemo(()=>{if(a)return oe.getInitializableTickIndex(xt,a.tick_spacing)},[a]),i=l.useMemo(()=>{if(a)return oe.getInitializableTickIndex(ut,a.tick_spacing)},[a]),{isLoading:h,error:x,ticks:d,handleRefresh:u}=_a(a==null?void 0:a.pool_address);return l.useMemo(()=>{if(!t||!o||n===void 0||d===void 0||!d||(d==null?void 0:d.length)===0||h||!c||!i)return{isLoading:h,error:x,activeTick:n,data:void 0,handleRefresh:u};const r=t,j=o;console.log("🚀 ~ file: usePoolTickData.ts:177 ~ returnuseMemo ~ newTicks start:");const m=d;console.log("🚀 ~ file: usePoolTickData.ts:177 ~ returnuseMemo ~ newTicks:",m),console.log("🚀 ~ file: usePoolTickData.ts:177 ~ returnuseMemo ~ activeTick:",n);const y=m.findIndex(({tick:z})=>Number(z)>n)-1;if(y<0)return{isLoading:h,error:x,activeTick:n,data:void 0,handleRefresh:u};const k=(a==null?void 0:a.liquidity)??0,p={liquidityActive:BigInt(k??0),tick:n,liquidityNet:Number(d[y].tick)===n?BigInt(d[y].liquidityNet):0n,price0:oe.tickIndexToPrice(n,r.decimals,j.decimals).toFixed(Ca)},R=ts(r,j,p,m,y,!0),L=ts(r,j,p,m,y,!1).concat(p).concat(R);return console.log("🚀 ~ file: usePoolTickData.ts:215 ~ returnuseMemo ~ ticksProcessed:",L),{isLoading:h,error:x,activeTick:n,data:L,handleRefresh:u}},[t,o,n,a,d,h,x,c,i])}function La({contractPoolInfo:a,currencyA:t,currencyB:o,feeAmount:s}){const{isLoading:n,error:c,data:i,handleRefresh:h}=Ea(a,t,o,s),x=l.useCallback(()=>{if(console.log("🚀 ~ file: useDepthChartData.ts:22 ~ formatData ~ data:",i),!i||!(i!=null&&i.length))return[];const d=[];for(let u=0;u<i.length;u++){const r=i[u],j={depth:parseFloat(r.liquidityActive.toString()),price:parseFloat(r.price0)};j.depth>=0&&d.push(j)}return d},[i]);return l.useMemo(()=>({isLoading:n,error:c,formattedData:n?void 0:x(),handleRefresh:h}),[n,c,x])}var Q=(a=>(a.LOWER="LOWER",a.UPPER="UPPER",a))(Q||{});const nt={[Y.LOWEST]:{initialMin:.99,initialMax:1.01,min:1e-5,max:1.5},[Y.LOW]:{initialMin:.8,initialMax:1.25,min:1e-5,max:1.5},[Y.MEDIUM]:{initialMin:.5,initialMax:1.5,min:1e-5,max:20},[Y.HIGH]:{initialMin:.5,initialMax:1.5,min:1e-5,max:20}};Y.LOWEST+"",Y.LOW+"",Y.MEDIUM+"",nt[Y.MEDIUM],Y.HIGH+"",nt[Y.HIGH];const za=pe.path`
  opacity: ${({opacity:a})=>a||1}};
  stroke: ${({fill:a,theme:t})=>a??t.colors.failure};
  fill: ${({fill:a,theme:t})=>a??t.colors.failure};
`,ss=({series:a,xScale:t,yScale:o,xValue:s,yValue:n,fill:c,opacity:i})=>{const h=l.useMemo(()=>{const x=t.domain(),d=a==null?void 0:a.sort((k,p)=>p.price-k.price),u=[];let r=!1;for(let k=0;k<d.length;k++){const p=d[k];u.push(p),(p==null?void 0:p.price)<(x==null?void 0:x[0])&&!r&&(u.push({price:(x==null?void 0:x[0])+Math.pow(10,-9),depth:p.depth}),r=!0)}const j=u==null?void 0:u.sort((k,p)=>k.price-p.price),m=[];let y=!1;for(let k=0;k<j.length;k++){const p=j[k];m.push(p),(p==null?void 0:p.price)>(x==null?void 0:x[1])&&!y&&(m.push({price:(x==null?void 0:x[1])-Math.pow(10,-9),depth:p.depth}),y=!0)}return ws().curve(Ki).x(k=>t(s(k))).y1(k=>o(n(k))).y0(o(0))(m.filter(k=>{const p=t(s(k));return p>0&&p<=window.innerWidth}))??void 0},[c,i,a,t,s,o,n]);return l.useMemo(()=>e.jsx(za,{opacity:i,fill:c,d:h}),[h])},Ha=pe.g`
  line {
    display: none;
  }
  text {
    transform: translateY(5px);
    font-family: 'NotoSansMono';
  }
`,Ba=({axisGenerator:a,isPosition:t})=>{const{colorMode:o}=fs(),s=n=>{n&&xe(n).call(a).call(c=>c.selectAll(".domain").remove())};return e.jsx("g",{ref:s,style:{color:o=="light"?"#000":"#fff",opacity:(o=="light","0.5")}})},qa=({xScale:a,innerHeight:t,offset:o=0,isPosition:s=!1})=>l.useMemo(()=>e.jsx(Ha,{transform:`translate(0, ${t+o})`,children:e.jsx(Ba,{axisGenerator:vs(a).ticks(6),isPosition:s})}),[t,o,a]),Na=a=>{const t=l.useRef();return l.useEffect(()=>{t.current=a},[a]),t.current},is=a=>["M 0 0",`v ${a}`,"m 1 0","V 0","M 0 1","h 10","q 2 0, 2 2","v 22","q 0 2 -2 2","h -10","z"].join(" "),as=()=>["m 4 8","v 12","M 0 0","m 8 8","v 12","z"].join(" "),ns=({color:a,size:t=10,margin:o=10})=>e.jsx("polygon",{points:`0 0, ${t} ${t}, 0 ${t}`,transform:` translate(${t+o}, ${o}) rotate(45) `,fill:a,stroke:a,strokeWidth:"4",strokeLinejoin:"round"}),Ce={colors:{background:"var(--chakra-colors-card_bg)",secondary:"#30D4B7",leftHandle:"#30D4B7 ",rightHandle:"#6297EA"}},rs=pe.path`
  cursor: ew-resize;
  pointer-events: none;

  stroke-width: 3;
  stroke: ${({color:a})=>a};
  fill: ${({color:a})=>a};
`,os=pe.path`
  cursor: ew-resize;
  pointer-events: none;

  stroke-width: 1.5;
  /* stroke: ${Ce.colors.background}; */
  // stroke: #22211f;
  stroke: #fff;
  opacity: ${Ce.colors.background};
`;pe.g`
  opacity: ${({visible:a})=>a?"1":"0"};
  transition: opacity 300ms;
`;pe.rect`
  fill: ${Ce.colors.secondary};
`;pe.rect`
  fill: ${Ce.colors.secondary};
`;pe.rect`
  fill: ${Ce.colors.secondary};
`;pe.text`
  text-anchor: middle;
  font-size: 13px;
  /*  fill: ${Ce.colors.background}; */
  fill: #22211f;
`;const cs=20,ls=2,ds=(a,t,o)=>{const s=a.map(c=>o(c).toFixed(1)),n=t.map(c=>o(c).toFixed(1));return s.every((c,i)=>c===n[i])},$a=({id:a,xScale:t,interactive:o,brushLabelValue:s,brushExtent:n,setBrushExtent:c,innerWidth:i,innerHeight:h,westHandleColor:x,eastHandleColor:d,hideBrush:u,isSorted:r})=>{const j=l.useRef(null),m=l.useRef(null),[y,k]=l.useState(n),[p,R]=l.useState(!1),[E,L]=l.useState(!1),z=Na(n),F=l.useCallback(G=>{const{type:_,selection:b,mode:g}=G;if(!b){k(null);return}const T=b.map(t.invert);_==="end"&&!ds(n,T,t)&&c(T,g),k(T)},[t,n,c]);l.useEffect(()=>{k(n)},[n]),l.useEffect(()=>{j.current&&(m.current=Pi().extent([[Math.max(0+ls,t(0)),0],[i-ls,h]]).handleSize(30).filter(()=>o).on("brush end",F),m.current(xe(j.current)),z&&ds(n,z,t)&&xe(j.current).transition().call(m.current.move,n.map(t)),xe(j.current).selectAll(".selection").attr("stroke","none").attr("fill","var(--chakra-colors-chart_brush_selection)"))},[n,F,a,h,i,o,z,t]),l.useEffect(()=>{!j.current||!m.current||m.current.move(xe(j.current),n.map(t))},[n,t]),l.useEffect(()=>{R(!0);const G=setTimeout(()=>R(!1),1500);return()=>clearTimeout(G)},[y]);const $=y&&t(y[0])>cs,D=y&&t(y[1])>i-cs,S=y&&(t(y[0])<0||t(y[1])<0),H=y&&(t(y[0])>i||t(y[1])>i),V=y&&t(y[0])>=0&&t(y[0])<=i,J=y&&t(y[1])>=0&&t(y[1])<=i;return l.useEffect(()=>{console.log("🚀 ~ file: Brush.tsx:195 ~ brushExtent:",n)},[n]),l.useMemo(()=>e.jsxs(e.Fragment,{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:`${a}-gradient-selection`,x1:"0%",y1:"100%",x2:"100%",y2:"100%",children:[e.jsx("stop",{stopColor:x}),e.jsx("stop",{stopColor:d,offset:"1"})]}),e.jsx("clipPath",{id:`${a}-brush-clip`,children:e.jsx("rect",{x:"0",y:"0",width:i,height:h})})]}),e.jsx("g",{ref:j,clipPath:`url(#${a}-brush-clip)`,onMouseEnter:()=>L(!0),onMouseLeave:()=>L(!1)}),y&&e.jsxs(e.Fragment,{children:[!u&&V?e.jsx("g",{transform:`translate(${Math.max(0,t(y[0]))}, 0), scale(${$?"-1":"1"}, 1)`,children:e.jsxs("g",{children:[e.jsx(rs,{color:Ce.colors.leftHandle,d:is(h)}),e.jsx(os,{d:as()})]})}):null,!u&&J?e.jsx("g",{transform:`translate(${t(y[1])}, 0), scale(${D?"-1":"1"}, 1)`,children:e.jsxs("g",{children:[e.jsx(rs,{color:Ce.colors.rightHandle,d:is(h)}),e.jsx(os,{d:as()})]})}):null,S&&e.jsx(ns,{color:x}),H&&e.jsx("g",{transform:`translate(${i}, 0) scale(-1, 1)`,children:e.jsx(ns,{color:d})})]})]}),[s,d,J,D,$,E,a,Ce,h,i,y,H,p,S,x,V,t])},Da=pe.line`
  opacity: 0.7;
  stroke-width: 2;
  stroke: var(--chakra-colors-text_caption);
  fill: none;
`,Fa=({value:a,xScale:t,innerHeight:o})=>l.useMemo(()=>e.jsx(Da,{x1:t(a),y1:"0",x2:t(a),y2:o}),[a,t,o]);pe.div`
  display: grid;
  grid-template-columns: repeat(${({count:a})=>a.toString()}, 1fr);
  grid-gap: 6px;

  position: absolute;
  top: -18px;
  right: 0;
`;const Ua=pe.rect`
  fill: transparent;
  cursor: grab;

  &:active {
    cursor: grabbing;
  }
`;function Oa({svg:a,xScale:t,setZoom:o,width:s,height:n,resetBrush:c,showResetButton:i,zoomLevels:h,isPosition:x,handleClickRefresh:d}){const u=l.useRef(),[r,j,m,y]=l.useMemo(()=>[()=>a&&u.current&&xe(a).transition().call(u.current.scaleBy,1.5),()=>a&&u.current&&xe(a).transition().call(u.current.scaleBy,.5),()=>a&&u.current&&xe(a).transition().call(u.current.scaleTo,1),()=>a&&u.current&&xe(a).call(u.current.transform,Ts.translate(0,0).scale(1)).transition().call(u.current.scaleTo,.5)],[a]),p=kt(()=>{console.log("这里测试打印")},500),R=kt(o,300),{isApp:E}=$e();return l.useEffect(()=>{a&&(u.current=bs().scaleExtent([0,1/0]).extent([[0,0],[s,n]]).on("zoom",({transform:L})=>{console.log("这里进来了多次吗 on zoom"),p(),R(L)}),xe(a).call(u.current))},[n,s,o,a,u,h.max,h.min]),l.useEffect(()=>{m()},[m,h]),e.jsx(K,{w:"100%",p:"0px",align:"center",sx:{"@media screen and (max-width: 960px)":{flexDirection:"column",w:"100%",alignItems:x?"flex-start":"flex-end"}},children:e.jsxs(B,{w:"100%",justify:E?"flex-start":"flex-end",flex:"1",position:"absolute",right:"0px",top:E?"-55px":"-80px",children:[e.jsx(ot,{handleClickRefresh:d,noBg:!0,isAutoRefresh:!0}),e.jsx(ce,{svgW:"24px",svgH:"24px",boxW:"24px",boxH:"24px",xlinkHref:"#icon-icon_zoomin",onClick:r}),e.jsx(ce,{svgW:"24px",svgH:"24px",boxW:"24px",boxH:"24px",xlinkHref:"#icon-icon_zoomout",onClick:j})]})})}const tt=a=>a.price,gt=a=>a.depth;function Wa(a,t){return a==null?void 0:a.filter(o=>v(o.price).gte(t[0])&&v(o.price).lte(t[1]))}function Va({id:a="liquidityChartRangeInput",data:{series:t,current:o},ticksAtLimit:s,styles:n,dimensions:{width:c,height:i},margins:h,interactive:x=!0,brushDomain:d,brushLabels:u,onBrushDomainChange:r,handleClickRefresh:j,zoomLevels:m,showZoomButtons:y=!0,isPosition:k=!1,hideBrush:p=!1,isReverse:R=!1,isSorted:E=!0}){const L=l.useRef(null),[z,F]=l.useState(null),[$,D]=l.useMemo(()=>[i-h.top-h.bottom,c-h.left-h.right],[c,i,h]),{xScale:S,yScale:H}=l.useMemo(()=>{const G=[o*m.initialMin,o*m.initialMax];let _=G;console.log("🚀 ~ file: Chart.tsx:56 ~ const{xScale,yScale}=useMemo ~ xInitialRange:",G),console.log("🚀 ~ file: Chart.tsx:56 ~ const{xScale,yScale}=useMemo ~ brushDomain:",d),d&&String(d==null?void 0:d[0])!=="∞"&&String(d==null?void 0:d[1])!=="∞"&&(_=[Math.min(G[0],v(d[0]).mul(.9).toNumber()),Math.max(G[1],v(d[1]).mul(1.1).toNumber())]);const b=Wa(t,_),g={xScale:ft().domain(_).range([0,D]),yScale:ft().domain([0,Cs(b,gt)]).range([$,0])};if(z){const T=z.rescaleX(g.xScale);g.xScale.domain(T.domain())}return g},[o,m.initialMin,m.initialMax,D,t,$,z,d]);l.useEffect(()=>{console.log("Chart.tsx xScale useEffect: ",S)},[S]),l.useEffect(()=>{console.log("Chart.tsx zoom useEffect: ",z)},[z]),l.useEffect(()=>{F(null)},[m]),l.useEffect(()=>{d||r(S.domain(),void 0)},[d,r,S]);const[V,J]=l.useMemo(()=>{var g,T;const G=((g=t[0])==null?void 0:g.price)>((T=t[t.length-1])==null?void 0:T.price);let[_,b]=Yi(t,f=>G?+tt(f)<o:+tt(f)>o);return b.length&&b[b.length-1]&&(b[b.length-1].price!==o&&(b=[...b,{depth:b[b.length-1].depth,price:o}]),_=[{depth:b[b.length-1].depth,price:o},..._]),[_,b]},[o,t]);return e.jsxs(q,{w:"100%",h:"100%",sx:{"@media screen and (max-width: 1000px)":{display:"block"}},children:[y&&e.jsx(Oa,{svg:L.current,xScale:S,setZoom:F,width:D,height:i,resetBrush:()=>{r([o*m.initialMin,o*m.initialMax],"reset")},showResetButton:!!(s[Q.LOWER]||s[Q.UPPER]),zoomLevels:m,isPosition:k,handleClickRefresh:j}),e.jsxs("svg",{width:"100%",height:"100%",style:{overflow:"visible"},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"green-gradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--chakra-colors-range_chart_bg)",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"var(--chakra-colors-range_chart_bg)",stopOpacity:1})]}),e.jsxs("linearGradient",{id:"red-gradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--chakra-colors-range_chart_bg)",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"var(--chakra-colors-range_chart_bg)",stopOpacity:1})]})]}),e.jsxs("defs",{children:[e.jsx("clipPath",{id:`${a}-chart-clip`,children:e.jsx("rect",{x:"0",y:"0",width:D,height:i})}),d&&e.jsx("mask",{id:`${a}-chart-area-mask`,children:e.jsx("rect",{fill:"red",x:S(d[0]),y:"0",width:S(d[1])-S(d[0]),height:$})})]}),e.jsxs("g",{transform:`translate(${h.left},${h.top})`,children:[e.jsxs("g",{clipPath:`url(#${a}-chart-clip)`,children:[e.jsx(ss,{series:V,xScale:S,yScale:H,xValue:tt,yValue:gt,opacity:1,fill:"var(--chakra-colors-range_chart_bg)"}),e.jsx(ss,{series:J,xScale:S,yScale:H,xValue:tt,yValue:gt,opacity:1,fill:"url(#green-gradient)"}),e.jsx(Fa,{value:o,xScale:S,innerHeight:$}),e.jsx(qa,{xScale:S,innerHeight:$,isPosition:k})]}),e.jsx(Ua,{width:D,height:i,ref:L}),e.jsx($a,{id:a,xScale:S,interactive:x,brushLabelValue:u,brushExtent:d??S.domain(),innerWidth:D,innerHeight:$,setBrushExtent:r,westHandleColor:n.brush.handle.west,eastHandleColor:n.brush.handle.east,hideBrush:p,isSorted:E})]})]})]})}const Ga=l.forwardRef(function({isSorted:t,contractPoolInfo:o,currencyA:s,currencyB:n,feeAmount:c,ticksAtLimit:i,price:h,priceLower:x,priceUpper:d,onLeftRangeInput:u,onRightRangeInput:r,onBothRangeInput:j,handleClickRefresh:m,interactive:y,zoomLevel:k,isPosition:p,hideBrush:R,isReverse:E},L){var b;const{isLoading:z,error:F,formattedData:$,handleRefresh:D}=La({contractPoolInfo:o,currencyA:s,currencyB:n,feeAmount:c});l.useEffect(()=>{D()},[]);const S=l.useMemo(()=>{let g;return t?g=$:g=$==null?void 0:$.map(T=>{var f;return{...T,price:(f=v(1).div(T==null?void 0:T.price))==null?void 0:f.toNumber()}}),console.log("seriesData useMemo result: ",g),g},[t,$]),H=l.useCallback((g,T)=>{if(!T)return;let f=Number(g[0]);const M=Number(g[1]);f<=0&&(f=1/10**6);const U=(!i[t?Q.LOWER:Q.UPPER]||T==="handle"||T==="reset")&&f>0,A=(!i[t?Q.UPPER:Q.LOWER]||T==="reset")&&M>0&&M<1e35;if(U&&A){const I=parseFloat(f.toFixed(16)),ie=parseFloat(M.toFixed(16));I>0&&ie>0&&I<ie&&j({leftTypedValue:v(f).toString(),rightTypedValue:v(M).toString()})}else U?u(v(f).toString()):A&&r(v(M).toString())},[t,j,u,r,i]),V=l.useMemo(()=>{const g=x==null?void 0:x.fixsUiPrice,T=d==null?void 0:d.fixsUiPrice;if(T!=="∞")return g&&T?[g,T]:void 0},[t,x==null?void 0:x.fixsUiPrice,d==null?void 0:d.fixsUiPrice]),J=l.useCallback((g,T)=>{if(!h)return"";if(g==="w"&&i[t?Q.LOWER:Q.UPPER])return"0";if(g==="e"&&i[t?Q.UPPER:Q.LOWER])return"∞";const f=(T<h?-1:1)*((Math.max(T,h)-Math.min(T,h))/h)*100;return h?`${aa(Math.abs(f)>1?".2~s":".2~f")(f)}%`:""},[t,h,i]),G=!s||!n||S===void 0&&!z,_=l.useRef(null);return l.useImperativeHandle(L,()=>({depthChartRefreshData:D})),e.jsx(q,{flex:1,gap:"14px",w:"100%",position:"relative",children:G?e.jsx(K,{direction:"column",h:"150px",justify:"flex-end",children:e.jsx(w,{children:"Your position will appear here."})}):z||!S||!h?e.jsx(N,{h:"100%",pt:"100px",children:e.jsx(Ze,{})}):F?e.jsx(K,{direction:"column",h:"150px",justify:"flex-end",children:e.jsx(w,{children:"Liquidity data not available."})}):S.length===0?e.jsxs(K,{direction:"column",h:"210px",justify:"flex-end",children:[e.jsx(B,{position:"absolute",right:"0px",top:"-80px",children:e.jsx(ot,{handleClickRefresh:m,noBg:!0,isAutoRefresh:!0})}),e.jsx(w,{mt:"20px",children:"There is no liquidity data."})]}):e.jsx(K,{w:"100%",h:"100%",position:"relative",justify:"center",align:"center",ref:_,children:e.jsx(Va,{data:{series:S,current:h},dimensions:{width:((b=_==null?void 0:_.current)==null?void 0:b.clientWidth)||660,height:280},margins:{top:10,right:20,bottom:20,left:10},styles:{area:{selection:"var(--chakra-colors-text_caption)"},brush:{handle:{west:"#30D4B7",east:"#6297EA"}}},interactive:y&&!!(S!=null&&S.length),brushLabels:J,brushDomain:V,onBrushDomainChange:H,zoomLevels:k??nt[c??Y.MEDIUM],ticksAtLimit:i,isPosition:p,hideBrush:R,isReverse:E,isSorted:t,handleClickRefresh:m},`${c??Y.MEDIUM}`)})})}),Xa=l.forwardRef(function(t,o){const{handleClickRefresh:s}=t,{currentApiPoolInfo:n,currentContractPoolInfo:c,currentFeeTier:i,setBaseCoin:h,baseCoin:x,addToken0:d,addToken1:u,minPriceData:r,maxPriceData:j,currentPrice:m,inversePrice:y,defaultPriceRangePercentage:k,saveMinPriceData:p,saveMaxPriceData:R,setIsShowMinMaxDist:E}=se(),L=l.useMemo(()=>c==null?void 0:c.tick_spacing,[c]),z=l.useMemo(()=>i&&Number(i)&&(n!=null&&n.tickSpacing)?{[Q.LOWER]:i?oe.getInitializableTickIndex(ut,n==null?void 0:n.tickSpacing):void 0,[Q.UPPER]:i?oe.getInitializableTickIndex(xt,n==null?void 0:n.tickSpacing):void 0}:{[Q.LOWER]:void 0,[Q.UPPER]:void 0},[i]),F=l.useMemo(()=>{var M;const g=x===((M=n==null?void 0:n.token0)==null?void 0:M.metadata),T=g?r:j==null?void 0:j.getInverseTickPrice(),f=g?j:r==null?void 0:r.getInverseTickPrice();return{[Q.LOWER]:i&&(T==null?void 0:T.tick)===z.LOWER,[Q.UPPER]:i&&(f==null?void 0:f.tick)===z.UPPER}},[n,z,r,j,i,x]),$=!0,D=l.useMemo(()=>{if(k){const g=v(1).minus(v(k).div(100)).toNumber(),T=v(1).add(v(k).div(100)).toNumber();return{initialMin:g,initialMax:T,min:1e-5,max:1.5}}},[k]),S=g=>{var T;if(L&&g!=="∞"){const f=x===((T=n==null?void 0:n.token0)==null?void 0:T.metadata),M=f?n==null?void 0:n.token0:n==null?void 0:n.token1,U=f?n==null?void 0:n.token1:n==null?void 0:n.token0;M&&U&&p(Ee.buildTickPriceData(g,L,M,U))}},H=g=>{var T;if(L&&g!=="∞"){const f=x===((T=n==null?void 0:n.token0)==null?void 0:T.metadata),M=f?n==null?void 0:n.token0:n==null?void 0:n.token1,U=f?n==null?void 0:n.token1:n==null?void 0:n.token0;M&&U&&R(Ee.buildTickPriceData(g,L,M,U))}},V=({leftTypedValue:g,rightTypedValue:T})=>{g!==(r==null?void 0:r.fixsUiPrice)&&(E(!0),S(g)),T!==(j==null?void 0:j.fixsUiPrice)&&(E(!0),H(T))},J=g=>{g!==(r==null?void 0:r.fixsUiPrice)&&(E(!0),S(g))},G=g=>{g!==(j==null?void 0:j.fixsUiPrice)&&(E(!0),H(g))},_=l.useMemo(()=>{var g;return x===((g=n==null?void 0:n.token0)==null?void 0:g.metadata)},[x,n]),b=l.useRef(null);return l.useImperativeHandle(o,()=>{var g;return{depthChartRefreshData:(g=b.current)==null?void 0:g.depthChartRefreshData}}),e.jsx(q,{w:"100%",h:"100%",children:e.jsx(Ga,{ref:b,isSorted:_,contractPoolInfo:c,currencyA:n==null?void 0:n.token0,currencyB:n==null?void 0:n.token1,feeAmount:i,ticksAtLimit:F,price:Number(_?m:y),priceLower:r,priceUpper:j,interactive:$,zoomLevel:D,isReverse:n==null?void 0:n.isReverse,onBothRangeInput:V,onLeftRangeInput:J,onRightRangeInput:G,handleClickRefresh:s})})}),Ya=({xScale:a,innerHeight:t,svg:o})=>{const{colorMode:s}=fs();return l.useEffect(()=>{console.log("没走到这里吗AxisBottom svg: ",o);const n=vs(a).ticks(4).tickSizeOuter(0);o.select(".price-historical-x-axis").attr("transform",`translate(0, ${t})`).call(n)},[o,a]),e.jsx("g",{className:"price-historical-x-axis",style:{color:s=="light"?"#000":"#fff",opacity:(s=="light","0.5")}})},Ka=({yScale:a,innerWidth:t,svg:o})=>(l.useEffect(()=>{const s=Ji(a).ticks(5).tickSizeOuter(0);o.select(".price-historical-y-axis").attr("transform",`translate(${t}, 0)`).call(s)},[o,a]),e.jsx("g",{className:"price-historical-y-axis"})),Za=({series:a,xScale:t,yScale:o,svg:s,innerHeight:n})=>(l.useEffect(()=>{const c=ws().x(i=>t(i.time)).y0(n).y1(i=>o(i.price)).curve(Ss.alpha(.5));s.select(".area").datum(a).attr("d",c).attr("fill","url(#historical-gradient)").attr("z-index",-1)},[s,o,a]),e.jsx("path",{className:"area"})),Ja=({series:a,xScale:t,yScale:o,svg:s})=>(l.useEffect(()=>{const n=Zi().x(c=>t(c.time)).y(c=>o(c.price)).curve(Ss.alpha(.5));s.select(".line").datum(a).attr("d",n).attr("fill","none").attr("stroke","var(--chakra-colors-historical_line)").attr("stroke-width",2)},[s,o,a]),e.jsx("path",{className:"line"})),qs=ps(a=>({hoverX:null,hoverY:null,hoverTime:null,hoverPrice:null,tooltipData:null,dateType:"1D",tooltipTextXPos:null,setHoverX:t=>{a(()=>({hoverX:t}))},setHoverY:t=>{a(()=>({hoverY:t}))},setHoverTime:t=>{a(()=>({hoverTime:t}))},setHoverPrice:t=>{a(()=>({hoverPrice:t}))},setTooltipData:t=>{a(()=>({tooltipData:t}))},setDateType:t=>{a(()=>({dateType:t}))},setTooltipTextXPos:t=>{a(()=>({tooltipTextXPos:t}))}})),Qa=({series:a,xScale:t,yScale:o,svg:s,setHoverX:n,setHoverY:c,setTooltipData:i,setTooltipTextXPos:h})=>(l.useEffect(()=>{s.selectAll(".dot").remove(),s.selectAll(".dot").data(a).enter().append("circle").attr("class","dot").attr("cx",x=>t(x.time)).attr("cy",x=>o(x.price)).attr("r",3).attr("fill","rgba(255, 255, 255, 0)").attr("z-index","2")},[s,o,a]),e.jsx("g",{className:"tooptip-text"})),Pa=({series:a,yScale:t,svg:o,innerWidth:s,innerHeight:n,brushExtent:c,setBrushExtent:i,isSorted:h})=>{const[x,d]=l.useState([30,50]);l.useEffect(()=>{console.log("Brush useEffect brushExtent: ",c),console.log("Brush useEffect isSorted: ",h),console.log("Brush useEffect [yScale(brushExtent[0]), yScale(brushExtent[1])]: ",[t(c[0]),t(c[1])]),d([t(c[0]),t(c[1])])},[c]),l.useEffect(()=>{const j=Ai().extent([[0,0],[s+50,n]]).on("end",({selection:m,mode:y})=>{if(!m){d(null);return}const[k,p]=m==null?void 0:m.map(t.invert);console.log("Selected mode: ",y),console.log("Selected y0:",k),console.log("Selected y1:",p),i([k,p],y);const R=m.map(t.invert);console.log("Selected scaled: ",R);const E=a.filter(F=>F.price>=k&&F.price<=p);console.log("Selected data:",E);const L=t(k),z=t(p);console.log("Selected posy0:",L),console.log("Selected posy1:",z),d([L,z])});o.select(".brush").call(j).call(j.move,c.map(t)),o.selectAll(".selection").attr("stroke","none").attr("fill-opacity","0.2").attr("fill","red").attr("width",500).attr("class","selection price-historical-selection")},[o,t,s,n]);const u=l.useMemo(()=>!(!x||x[0]<0),[x]),r=l.useMemo(()=>!(!x||x[1]<0),[x]);return e.jsxs(e.Fragment,{children:[u&&e.jsxs("g",{className:"custom-top-handle",transform:`translate(0, ${x[0]})`,children:[e.jsx("line",{x1:"0",y1:"0",x2:s,y2:"0",stroke:"var(--chakra-colors-chart_handle_left)",strokeWidth:1}),e.jsxs("g",{transform:`translate(${s}, -10)`,children:[e.jsx("polygon",{points:"0,10 6,20 40,20 40,0 6,0",fill:"var(--chakra-colors-chart_handle_left)"}),e.jsxs("text",{x:"22",y:"15",fill:"#0C0B1E",fontSize:"12px",textAnchor:"middle",children:["MIN ",h]})]})]}),r&&e.jsxs("g",{className:"custom-bottom-handle",transform:`translate(0, ${x[1]})`,children:[e.jsx("line",{x1:"0",y1:"0",x2:s,y2:"0",stroke:"var(--chakra-colors-chart_handle_right)",strokeWidth:1}),e.jsxs("g",{transform:`translate(${s}, -10)`,children:[e.jsx("polygon",{points:"0,10 6,20 40,20 40,0 6,0",fill:"var(--chakra-colors-chart_handle_right)"}),e.jsx("text",{x:"22",y:"15",fill:"#0C0B1E",fontSize:"12px",textAnchor:"middle",children:"MAX"})]})]}),x&&e.jsx("rect",{width:s,height:Math.abs((x[0]<0?0:x[0])-(x[1]<0?0:x[1])),transform:`translate(0, ${x[1]<0?0:x[1]})`,fill:"var(--chakra-colors-chart_brush_selection)"}),e.jsx("g",{className:"brush"})]})},Aa=({svg:a,hoverX:t,hoverY:o,innerWidth:s,innerHeight:n,tooltipData:c})=>(l.useState(null),l.useRef(),e.jsx(e.Fragment,{children:e.jsxs("g",{transform:`translate(${t}, 0)`,children:[e.jsx("line",{y1:0,y2:n,stroke:"#fff",strokeDasharray:"5, 5"}),e.jsx("line",{x1:-t,x2:s-t,y1:o,y2:o,stroke:"#fff",strokeDasharray:"5, 5"}),e.jsx("circle",{r:"4",fill:"#fff",cy:o})]})})),Ia=({price:a,yScale:t,svg:o,innerWidth:s})=>e.jsxs("g",{className:"historical-currentprice-line",children:[e.jsx("line",{x1:0,y1:t(a),x2:s+30,y2:t(a),stroke:"#fff",strokeWidth:"1"}),e.jsx("circle",{cx:s-4+30,cy:t(a),r:"4",fill:"#A6DEEB"})]});function en({svg:a,yScale:t,setZoom:o,width:s,height:n,zoomLevels:c,handleClickRefresh:i,dateType:h,setDateType:x,isApp:d}){const u=l.useRef(),[r,j,m,y]=l.useMemo(()=>[()=>a&&u.current&&a.transition().call(u.current.scaleBy,2),()=>a&&u.current&&a.transition().call(u.current.scaleBy,.5),()=>a&&u.current&&a.transition().call(u.current.scaleTo,.5),()=>a&&u.current&&a.call(u.current.transform,Ts.translate(0,0).scale(1)).transition().call(u.current.scaleTo,.5)],[a]);return l.useEffect(()=>{a&&(u.current=bs().scaleExtent([c.min,c.max]).extent([[0,0],[s,n]]).on("zoom",({transform:k})=>o(k)).filter(()=>!(void 0).button&&!(void 0).touches),a.call(u.current))},[n,s,o,a,t,u,c,c.max,c.min]),l.useEffect(()=>{m()},[m,c]),e.jsx(K,{children:e.jsxs(B,{w:"100%",flex:"1",justify:d?"flex-start":"flex-end",position:"absolute",right:"0px",top:d?"-55px":"-80px",children:[e.jsx(Ke,{options:["1H","1D","7D","30D"],size:"s",value:h,onChange:x}),e.jsx(ot,{handleClickRefresh:i,noBg:!0,isAutoRefresh:!0}),e.jsx(ce,{svgW:"24px",svgH:"24px",boxW:"24px",boxH:"24px",xlinkHref:"#icon-icon_zoomin",onClick:r}),e.jsx(ce,{svgW:"24px",svgH:"24px",boxW:"24px",boxH:"24px",xlinkHref:"#icon-icon_zoomout",onClick:j})]})})}ea(a=>new Date(a.time)).center;function tn({id:a="historicalChart",data:{series:t,current:o},dimensions:{width:s,height:n},margins:c,brushDomain:i,onBrushDomainChange:h,interactive:x=!0,zoomLevels:d,isSorted:u,handleClickRefresh:r,isApp:j}){const{hoverX:m,hoverY:y,hoverTime:k,hoverPrice:p,tooltipData:R,dateType:E,tooltipTextXPos:L,setHoverX:z,setHoverY:F,setHoverTime:$,setHoverPrice:D,setTooltipData:S,setDateType:H,setTooltipTextXPos:V}=qs();l.useRef(null);const[J,G]=l.useState(null),[_,b]=l.useMemo(()=>[n-c.top-c.bottom,s-c.left-c.right],[s,n,c]),[g,T]=l.useState(null);l.useEffect(()=>{if(xe){const ae=xe("#price-historical-chart");T(ae)}},[xe]),l.useEffect(()=>{console.log("走到这里了吗svg: ",g)},[g]);const{xScale:f,yScale:M}=l.useMemo(()=>{const ae=[o*.5,o*1.5];let le=ae;console.log("🚀 ~ file: Chart.tsx:56 ~ const{xScale,yScale}=useMemo ~ xInitialRange:",ae),console.log("🚀 ~ file: Chart.tsx:56 ~ const{xScale,yScale}=useMemo ~ brushDomain:",i),i&&String(i==null?void 0:i[0])!=="∞"&&String(i==null?void 0:i[1])!=="∞"&&(le=[o*.5,o*1.5]),console.log("🚀 ~ file: Chart.tsx:56 ~ const{xScale,yScale}=useMemo ~ yRange:",le);const O={xScale:Ii().domain(ta(t,W=>W.time)).range([0,b]),yScale:ft().domain([Math.min(sa(t,W=>W.price)*.94,le[0]),Math.max(Cs(t,W=>W.price)*1.06,le[1])]).nice().range([_,0])};if(J){const W=J.rescaleY(O.yScale);O.yScale.domain(W.domain())}return O},[o,b,_,J,t]),U=l.useMemo(()=>[...t].reverse(),[t]),A=(ae,le)=>{const O=f(ae.time),W=M(ae.price);z(O),F(W);const P=O>580?580:O<100?100:O;V(P),S(ae)},I=ae=>{const le=f.invert(Qi(ae)[0]),O=new Date(le).getTime(),W=ia(U.map(P=>P.time),O);A(U[W])},ie=()=>{S(null),z(null),F(null)};return l.useEffect(()=>{console.log("🚀🚀🚀 ~ file: Chart.tsx:158 ~ tooltipData:",R)},[R]),e.jsxs(q,{w:"100%",h:"100%",sx:{"@media screen and (max-width: 1000px)":{display:"block"}},position:"relative",children:[e.jsx(en,{svg:g,yScale:M,setZoom:G,width:b,height:n,zoomLevels:d,handleClickRefresh:r,dateType:E,setDateType:H,isApp:j}),e.jsxs("svg",{id:"price-historical-chart",width:"100%",height:"100%",style:{overflow:"visible"},onMouseMove:I,onMouseOut:ie,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"historical-gradient",x1:"0",x2:"0",y1:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--chakra-colors-historical_area_start)"}),e.jsx("stop",{offset:"100%",stopColor:"var(--chakra-colors-historical_area_end)"})]})}),g&&e.jsxs(e.Fragment,{children:[e.jsx(Ya,{xScale:f,svg:g,innerHeight:_}),e.jsx(Ka,{yScale:M,svg:g,innerWidth:b}),e.jsx(Ja,{svg:g,series:t,xScale:f,yScale:M}),e.jsx(Za,{svg:g,series:t,xScale:f,yScale:M,innerHeight:_}),R&&e.jsx(Aa,{innerWidth:b,innerHeight:_,hoverX:m,hoverY:y,tooltipData:R,svg:g}),e.jsx(Qa,{svg:g,series:t,xScale:f,yScale:M,setHoverX:z,setHoverY:F,setTooltipData:S,setTooltipTextXPos:V}),e.jsx(Ia,{svg:g,yScale:M,innerWidth:b,price:o}),e.jsx(Pa,{svg:g,series:t,yScale:M,innerWidth:b,innerHeight:_,brushExtent:i??M.domain(),setBrushExtent:h,isSorted:u})]})]}),R&&e.jsxs(q,{pointerEvents:"none",position:"absolute",left:L-100+"px",top:y-65+"px",bg:"bg_secondary",padding:"8px",alignItems:"flex-start",zIndex:"99999",gap:"4px",borderRadius:"8px",children:[e.jsxs(w,{fontSize:"xs",children:["Date: ",Ys(R==null?void 0:R.time)]}),e.jsxs(w,{fontSize:"xs",children:["Price: ",R==null?void 0:R.price]})]})]})}function sn(a,t){console.log("🚀 ~ file: useHistoricalChartData.ts:8 ~ useHistoricalChartData ~ contractPoolInfo:",a);const o=l.useMemo(()=>Ks[t],[t]),{historicalPriceData:s,handleRefresh:n}=an(a==null?void 0:a.pool_address,o);l.useEffect(()=>{console.log("useHistoricalChartData historicalPriceData: ",s)},[s]);const c=l.useMemo(()=>{if(s&&s.length>0)return[s[s.length-1].time,s[0].time]},[s]);return{historicalData:s,xRange:c,isLoading:!1,error:void 0,handleRefresh:n}}function an(a,t="day"){const o=ct(ti),[s,n]=l.useState([]),c=async(h,x)=>{var m,y,k;const d=Ue(v(new Date().getTime()).div(1e3).toString(),0),u={hour:{dateType:"5min",startTime:v(d).minus(60*60).toNumber(),endTime:d},day:{dateType:"hour",startTime:v(d).minus(60*60*24).toNumber(),endTime:d},week:{dateType:"4hour",startTime:v(d).minus(60*60*24*7).toNumber(),endTime:d},month:{dateType:"day",startTime:v(d).minus(60*60*24*30).toNumber(),endTime:d}},r=await ms(o,{id:h,date_type:(m=u==null?void 0:u[x])==null?void 0:m.dateType,start_timestamp:(y=u==null?void 0:u[x])==null?void 0:y.startTime,end_timestamp:(k=u==null?void 0:u[x])==null?void 0:k.endTime});console.log("useHistoricalPrice getHisTorical res: ",r);const j=r==null?void 0:r.list.map(p=>({time:v(p.timestamp).mul(1e3).toNumber(),price:Number(p.price)}));if(console.log("useHistoricalPrice list: ",j),j.length===1){const p={hour:36e5,day:864e5,week:6048e5,month:2592e6};j.push({time:v(j[0].time).minus(p[x]).toNumber(),price:j[0].price})}console.log("useHistoricalPrice list后: ",j),n(j||[])};return l.useEffect(()=>{a&&t&&c(a,t)},[a,t]),{historicalPriceData:s,handleRefresh:()=>{a&&t&&c(a,t)}}}var We=(a=>(a.LOWER="LOWER",a.UPPER="UPPER",a))(We||{});const nn=l.forwardRef(function({isSorted:t,price:o,contractPoolInfo:s,currencyA:n,currencyB:c,feeAmount:i,interactive:h,ticksAtLimit:x,priceLower:d,priceUpper:u,onLeftRangeInput:r,onRightRangeInput:j,onBothRangeInput:m,handleClickRefresh:y,zoomLevel:k},p){var b;const{isApp:R}=$e(),{dateType:E,setDateType:L}=qs(),{historicalData:z,xRange:F,isLoading:$,error:D,handleRefresh:S}=sn(s,E),H=l.useRef(null);l.useState("1D");const V=l.useMemo(()=>t?z:z==null?void 0:z.map(g=>{var T;return{...g,price:(T=v(1).div(g==null?void 0:g.price))==null?void 0:T.toNumber()}}),[t,z]);l.useEffect(()=>{console.log("PriceChart index seriesData: ",V)},[V]);const J=!n||!c||V===void 0&&!$,G=l.useCallback((g,T)=>{if(console.log("onBrushDomainChangeEnded domain: ",g),console.log("onBrushDomainChangeEnded mode: ",T),!T)return;let f=Number(g[1]);const M=Number(g[0]);f<=0&&(f=1/10**6);const U=(!x[t?We.LOWER:We.UPPER]||T==="handle"||T==="reset")&&f>0,A=(!x[t?We.UPPER:We.LOWER]||T==="reset")&&M>0&&M<1e35;if(console.log("onBrushDomainChangeEnded updateBottom: ",U),console.log("onBrushDomainChangeEnded updateTop: ",A),U&&A){const I=parseFloat(f.toFixed(16)),ie=parseFloat(M.toFixed(16));console.log("onBrushDomainChangeEnded parsedLeftRangeValue: ",I),console.log("onBrushDomainChangeEnded parsedRightRangeValue: ",ie),I>0&&ie>0&&I<ie&&m({leftTypedValue:v(f).toString(),rightTypedValue:v(M).toString()})}else U?r(v(f).toString()):A&&j(v(M).toString())},[t,m,r,j,x]),_=l.useMemo(()=>{const g=d==null?void 0:d.fixsUiPrice,T=u==null?void 0:u.fixsUiPrice;if(T!=="∞")return g&&T?[g,T]:void 0},[t,d==null?void 0:d.fixsUiPrice,u==null?void 0:u.fixsUiPrice]);return l.useImperativeHandle(p,()=>({depthChartRefreshData:S})),e.jsx(q,{w:"100%",h:"100%",position:"relative",children:J?e.jsx(K,{direction:"column",h:"150px",justify:"flex-end",children:e.jsx(w,{children:"Your position will appear here."})}):$?e.jsx(N,{h:"100%",pt:"100px",children:e.jsx(Ze,{})}):D?e.jsx(K,{direction:"column",h:"150px",justify:"flex-end",children:e.jsx(w,{children:"Liquidity data not available."})}):!V||V.length===0||!o||!F?e.jsxs(K,{direction:"column",h:"210px",justify:"flex-end",children:[e.jsxs(B,{position:"absolute",top:R?"-55px":"-80px",right:R?"auto":"0px",left:R?"0px":"auto",children:[e.jsx(Ke,{options:["1H","1D","7D","30D"],size:"s",value:E,onChange:L}),e.jsx(ot,{handleClickRefresh:y,noBg:!0,isAutoRefresh:!0})]}),e.jsx(w,{mt:"20px",children:"There is no historical data."})]}):e.jsx(e.Fragment,{children:e.jsx(K,{w:"100%",h:"100%",ref:H,children:e.jsx(tn,{handleClickRefresh:y,data:{series:V,current:o},dimensions:{width:((b=H==null?void 0:H.current)==null?void 0:b.clientWidth)||660,height:320},brushDomain:_,margins:{top:10,right:20,bottom:20,left:10},onBrushDomainChange:G,interactive:h&&!!(V!=null&&V.length),zoomLevels:k??nt[i??Y.MEDIUM],isSorted:t,isApp:R})})})})}),rn=l.forwardRef(function(t,o){const{handleClickRefresh:s}=t,{currentApiPoolInfo:n,currentContractPoolInfo:c,currentFeeTier:i,setBaseCoin:h,baseCoin:x,addToken0:d,addToken1:u,minPriceData:r,maxPriceData:j,currentPrice:m,inversePrice:y,defaultPriceRangePercentage:k,saveMinPriceData:p,saveMaxPriceData:R,setIsShowMinMaxDist:E}=se(),L=l.useMemo(()=>c==null?void 0:c.tick_spacing,[c]),z=l.useMemo(()=>i&&Number(i)&&(n!=null&&n.tickSpacing)?{[Q.LOWER]:i?oe.getInitializableTickIndex(ut,n==null?void 0:n.tickSpacing):void 0,[Q.UPPER]:i?oe.getInitializableTickIndex(xt,n==null?void 0:n.tickSpacing):void 0}:{[Q.LOWER]:void 0,[Q.UPPER]:void 0},[i]),F=l.useMemo(()=>{var M;const g=x===((M=n==null?void 0:n.token0)==null?void 0:M.metadata),T=g?r:j==null?void 0:j.getInverseTickPrice(),f=g?j:r==null?void 0:r.getInverseTickPrice();return{[Q.LOWER]:i&&(T==null?void 0:T.tick)===z.LOWER,[Q.UPPER]:i&&(f==null?void 0:f.tick)===z.UPPER}},[n,z,r,j,i,x]),$=!0,D=l.useMemo(()=>{if(k){const g=v(1).minus(v(k).div(100)).toNumber(),T=v(1).add(v(k).div(100)).toNumber();return{initialMin:g,initialMax:T,min:1e-5,max:1.5}}},[k]),S=g=>{var T;if(L&&g!=="∞"){const f=x===((T=n==null?void 0:n.token0)==null?void 0:T.symbol),M=f?n==null?void 0:n.token0:n==null?void 0:n.token1,U=f?n==null?void 0:n.token1:n==null?void 0:n.token0;M&&U&&p(Ee.buildTickPriceData(g,L,M,U))}},H=g=>{var T;if(L&&g!=="∞"){const f=x===((T=n==null?void 0:n.token0)==null?void 0:T.metadata),M=f?n==null?void 0:n.token0:n==null?void 0:n.token1,U=f?n==null?void 0:n.token1:n==null?void 0:n.token0;M&&U&&R(Ee.buildTickPriceData(g,L,M,U))}},V=({leftTypedValue:g,rightTypedValue:T})=>{console.log("PriceHistoricalChart onBothRangeInput leftTypedValue: ",g),console.log("PriceHistoricalChart onBothRangeInput rightTypedValue: ",T),g!==(r==null?void 0:r.fixsUiPrice)&&(E(!0),S(g)),T!==(j==null?void 0:j.fixsUiPrice)&&(E(!0),H(T))},J=g=>{g!==(r==null?void 0:r.fixsUiPrice)&&(E(!0),S(g))},G=g=>{g!==(j==null?void 0:j.fixsUiPrice)&&(E(!0),H(g))},_=l.useMemo(()=>{var g;return x===((g=n==null?void 0:n.token0)==null?void 0:g.metadata)},[x,n]),b=l.useRef(null);return l.useImperativeHandle(o,()=>{var g;return{priceChartRefreshData:(g=b.current)==null?void 0:g.priceChartRefreshData}}),e.jsx(q,{w:"100%",h:"100%",children:e.jsx(nn,{ref:b,isSorted:_,contractPoolInfo:c,currencyA:d,currencyB:u,feeAmount:i,ticksAtLimit:F,price:Number(_?m:y),priceLower:r,priceUpper:j,interactive:$,zoomLevel:D,onBothRangeInput:V,onLeftRangeInput:J,onRightRangeInput:G,handleClickRefresh:s})})}),on=l.forwardRef(function({handleClickRefresh:t,rangeChartType:o,setRangeChartType:s},n){const{isApp:c}=$e(),i=d=>{s(d)},h=l.useRef(null),x=l.useRef(null);return l.useImperativeHandle(n,()=>{var d,u;return{depthChartMethod:(d=h==null?void 0:h.current)==null?void 0:d.depthChartRefreshData,priceChartMethod:(u=x==null?void 0:x.current)==null?void 0:u.priceChartRefreshData}}),e.jsxs(N,{w:"100%",h:"100%",children:[e.jsxs(Ci,{w:"100%",direction:c?"column":"row",justify:"space-between",mb:"10px",children:[e.jsx(N,{children:e.jsx(Ke,{options:["Liquidity","Price"],size:"s",value:o,onChange:i})}),c&&e.jsx(N,{h:"20px"}),e.jsxs(B,{gap:"24px",children:[e.jsxs(B,{gap:"4px",children:[e.jsx(N,{w:"16px",h:"2px",bg:"chart_handle_left"}),e.jsx(w,{fontSize:"xs",whiteSpace:"nowrap",children:"Min price"})]}),e.jsxs(B,{gap:"4px",children:[e.jsx(N,{w:"16px",h:"2px",bg:"chart_handle_right"}),e.jsx(w,{fontSize:"xs",whiteSpace:"nowrap",children:"Max price"})]}),e.jsxs(B,{gap:"4px",children:[e.jsx(N,{w:"16px",h:"2px",bg:"text_caption_opacity_70"}),e.jsx(w,{fontSize:"xs",whiteSpace:"nowrap",children:"Current price"})]})]})]}),o==="Liquidity"&&e.jsx(Xa,{handleClickRefresh:t,ref:h}),o==="Price"&&e.jsx(rn,{handleClickRefresh:t,ref:x})]})}),cn=on;function ln(a,t,o,s){const{setMinDistPercentange:n,setMaxDistPercentange:c}=se();l.useEffect(()=>{if(a!=null&&a.fixsUiPrice&&o&&(a==null?void 0:a.fixsUiPrice)!=="∞"&&(t==null?void 0:t.fixsUiPrice)!=="∞"){const i=v(a==null?void 0:a.fixsUiPrice).minus(o),h=v(t==null?void 0:t.fixsUiPrice).minus(o),x=i.equals(0)?"0":Ue(i.div(o).mul(100).toString(),1),d=h.equals(0)?"0":Ue(h.div(o).mul(100).toString(),1);n(String(x)),c(String(d))}},[a==null?void 0:a.fixsUiPrice,t==null?void 0:t.fixsUiPrice,o,s])}function wc(){var Lt,zt,Ht,Bt,qt,Nt,$t,Dt,Ft,Ut,Ot,Wt,Vt;const a=Mt(),{windowWidth:t}=$e(),{id:o,token0:s,token1:n,fee:c}=Bi(),{address:i}=dt(),{addToken0:h,addToken1:x,setAddToken0:d,setAddToken1:u,currentApiPoolInfo:r,setCurrentApiPoolInfo:j,currentContractPoolInfo:m,setCurrentContractPoolInfo:y,currentPoolPositions:k,setCurrentPrice:p,setBaseCoin:R,baseCoin:E,setCurrentApiPoolInfoIsLoading:L,setCurrentContractPoolInfoIsLoading:z,resetLiquidityState:F,currentFeeTier:$,setCurrentFeeTier:D,minPriceData:S,maxPriceData:H,saveMaxPriceData:V,saveMinPriceData:J,priceRangePercentage:G,ratio:_,setRatio:b,currentApiPoolInfoIsLoading:g,currentContractPoolInfoIsLoading:T,currentPrice:f,inversePrice:M,rangeChartType:U,setRangeChartType:A}=se(),{generalLoading:I}=na(),{getApiPoolInfo:ie}=Ps(),{getContractPool:ae}=wa(),{feeTierDistribution:le,feeTierDistributionLoading:O}=Li(h,x),{handleChangeRange:W}=Rt();l.useMemo(()=>{var ve,Pe,Gt;const C=E===((ve=r==null?void 0:r.token0)==null?void 0:ve.metadata),X=C?S:H==null?void 0:H.getInverseTickPrice(),Z=C?H:S==null?void 0:S.getInverseTickPrice(),te=m==null?void 0:m.current_tick_index,be=X==null?void 0:X.tick,Be=Z==null?void 0:Z.tick;return{currentTick:te,lower:be,upper:Be,metadata0:(Pe=r==null?void 0:r.token0)==null?void 0:Pe.metadata,metadata1:(Gt=r==null?void 0:r.token1)==null?void 0:Gt.metadata}},[r,m,S,H]);const{isImportToken:P}=lt(),de=l.useMemo(()=>{var C;return E===((C=r==null?void 0:r.token0)==null?void 0:C.metadata)},[E,r]);ln(S,H,de?f:M,de);const[ke,ue]=l.useState(!1),he=l.useMemo(()=>{const C=[];if(r){const{displayToken0:X,displayToken1:Z}=r;X&&P(X.metadata)&&localStorage.getItem(X.metadata)!=="true"&&C.push(X),Z&&P(Z.metadata)&&localStorage.getItem(Z.metadata)!=="true"&&C.push(Z)}return ue(C.length>0),C},[r]),ne=l.useRef();l.useRef(),ne.current=l.useMemo(()=>{if(o)return o;if(r!=null&&r.id)return r==null?void 0:r.id},[o,r]);const ge=C=>{z(!0),ae(C||ne.current).then(X=>{console.log("fetchContractPoolInfo getContractPool res:",X),y(X),z(!1)})},Me=l.useRef();Me.current=l.useCallback(C=>{const X={id:o,token0:s,token1:n,fee:c};(o||s&&n&&c)&&(L(!0),C&&(X.id=ne.current||o||(r==null?void 0:r.id)),ie(X,C).then(Z=>{const te=ne.current||o||(r==null?void 0:r.id);(te===void 0||Z&&Z.id===te)&&(j(Z),ge(Z==null?void 0:Z.id)),L(!1)}))},[o,s,n,c]),l.useEffect(()=>{Me.current()},[o,s,n,c]),l.useEffect(()=>{r&&(d((r==null?void 0:r.displayToken0)||void 0),u((r==null?void 0:r.displayToken1)||void 0))},[r]),l.useEffect(()=>{var C,X,Z,te,be,Be;if((r==null?void 0:r.id)===(m==null?void 0:m.pool_address)&&((C=r==null?void 0:r.token0)==null?void 0:C.decimals)!==void 0&&((X=r==null?void 0:r.token1)==null?void 0:X.decimals)!==void 0&&(m!=null&&m.current_sqrt_price)){console.log("🚀 ~ useEffect ~ currentContractPoolInfo:",m);const ve=oe.sqrtPriceX64ToPrice(new Ye(m==null?void 0:m.current_sqrt_price),(Z=r==null?void 0:r.token0)==null?void 0:Z.decimals,(te=r==null?void 0:r.token1)==null?void 0:te.decimals);console.log("🚀 ~ useEffect ~ price:",ve.toString());const Pe=v(1).div(ve);console.log("🚀 ~ useEffect ~ inversePrice:",Pe.toString()),p(ve.toString()),(be=r==null?void 0:r.displayToken0)!=null&&be.symbol&&!E&&R((Be=r==null?void 0:r.displayToken0)==null?void 0:Be.metadata)}},[r,m==null?void 0:m.pool_address]),l.useEffect(()=>{if(!(S&&H)&&m&&r){const C=us(String(m==null?void 0:m.fee_rate));r!=null&&r.isReverse?W(C,r==null?void 0:r.token1,r==null?void 0:r.token0,Number(m==null?void 0:m.tick_spacing),M.toString()):W(C,r==null?void 0:r.token0,r==null?void 0:r.token1,Number(m==null?void 0:m.tick_spacing),f.toString())}},[f,M]),l.useEffect(()=>{c&&D(c)},[c]);const[we,fe]=l.useState(!1),me=C=>{var X,Z,te,be,Be,ve;s===((X=C.displayToken0)==null?void 0:X.metadata)&&n===((Z=C.displayToken1)==null?void 0:Z.metadata)&&c===(C==null?void 0:C.feeTier)||n===((te=C.displayToken0)==null?void 0:te.metadata)&&s===((be=C.displayToken1)==null?void 0:be.metadata)&&c===(C==null?void 0:C.feeTier)||(F(),a(`/pools/liquidity/${(Be=C==null?void 0:C.displayToken0)==null?void 0:Be.metadata}/${(ve=C==null?void 0:C.displayToken1)==null?void 0:ve.metadata}/${C==null?void 0:C.feeTier}`,{replace:!0}),D(C==null?void 0:C.feeTier))},[ee,Le]=l.useState("Your Positions");l.useState("1D"),l.useEffect(()=>{window.scrollTo(0,0)},[]),l.useEffect(()=>{setTimeout(()=>{window.scrollTo(0,0)},50)},[window.innerHeight]);const ye=l.useRef(null),Se=()=>{var C;console.log("handleClickRefresh Force refresh",{id:o,token0:s,token1:n,fee:c,currentApiPoolInfo:r}),Me.current(!0),(C=ye==null?void 0:ye.current)==null||C.depthChartMethod()},{displayCurrentPrice:Te,displayPerText:je}=_t(),Re=l.useMemo(()=>{var te;const C=E===((te=r==null?void 0:r.token0)==null?void 0:te.metadata),X=C?S:H==null?void 0:H.getInverseTickPrice(),Z=C?H:S==null?void 0:S.getInverseTickPrice();return{token0:r==null?void 0:r.token0,token1:r==null?void 0:r.token1,lowerTick:X==null?void 0:X.tick,upperTick:Z==null?void 0:Z.tick,sqrtPriceX96:m==null?void 0:m.current_sqrt_price,isFullRange:G===100}},[r,S==null?void 0:S.tick,H==null?void 0:H.tick,m==null?void 0:m.current_sqrt_price,G]),ze=Ui(Re);l.useEffect(()=>{b(ze)},[ze]);const Je=Oi(S==null?void 0:S.price,H==null?void 0:H.price),{getCurrentPoolPositions:He}=Hs();l.useEffect(()=>{i&&r&&m&&(r==null?void 0:r.id)===(m==null?void 0:m.pool_address)&&ee=="Your Positions"&&(console.log("Liquidity Page getCurrentPoolPositions start"),ee==="Your Positions"&&He(r,m,i))},[r,m,i,ee]);const Qe=l.useMemo(()=>!r&&!g||!o&&(!s||!n||!c),[r,g,o,s,n,c]);l.useEffect(()=>()=>{F()},[]);const Et=C=>e.jsx(q,{w:"100%",gap:"16px",children:e.jsxs(q,{w:"100%",children:[e.jsx(St,{currentTab:ee,positionsNum:(k==null?void 0:k.length)||0,textList:["Your Positions","Transactions","Info"],onClick:X=>{Le(X)}}),ee=="Your Positions"?e.jsx(Ta,{}):ee=="Transactions"?e.jsx(fa,{windowWidth:C}):e.jsx(ha,{})]})});return I?e.jsx(e.Fragment,{}):e.jsxs(N,{w:"100%",children:[e.jsxs(K,{align:"center",cursor:"pointer",onClick:()=>fe(!we),sx:{"@media screen and (max-width: 810px)":{alignItems:"flex-start",flexDirection:"column"}},children:[e.jsxs(K,{align:"center",children:[e.jsx(wt,{w:"40px",coinAIconUrl:(Lt=r==null?void 0:r.displayToken0)==null?void 0:Lt.image,coinBIconUrl:(zt=r==null?void 0:r.displayToken1)==null?void 0:zt.image,variant:"border",showATag:Qe?!1:P(((Ht=r==null?void 0:r.displayToken0)==null?void 0:Ht.metadata)||""),showBTag:Qe?!1:P(((Bt=r==null?void 0:r.displayToken1)==null?void 0:Bt.metadata)||"")}),e.jsxs(B,{ml:"4px",children:[e.jsx(re,{fontSize:"xl",color:"text_caption",children:(qt=r==null?void 0:r.displayToken0)==null?void 0:qt.symbol}),e.jsx(w,{fontSize:"xl",color:"text_caption",children:"-"}),e.jsx(re,{fontSize:"xl",color:"text_caption",children:(Nt=r==null?void 0:r.displayToken1)==null?void 0:Nt.symbol})]})]}),e.jsxs(K,{w:"160px",h:"28px",border:"1px solid ",borderColor:"border",align:"center",ml:"20px",justify:"center",alignItems:"center",borderRadius:"8px",_hover:{bg:"bg_secondary",svg:{fill:"var(--chakra-colors-primary)"}},sx:{"@media screen and (max-width: 810px)":{w:"100%",ml:"0",mt:"12px"}},children:[e.jsx(w,{color:"primary",mr:"4px",children:"Change Pool"}),e.jsx(ce,{xlinkHref:"#icon-icon_open",variant:"gray"})]})]}),!Qe&&e.jsxs(e.Fragment,{children:[e.jsxs(B,{mt:"12px",align:"flex-start",sx:{"@media screen and (max-width: 810px)":{display:"flex",flexDirection:"column"}},children:[e.jsx(N,{sx:{"@media screen and (max-width: 810px)":{w:"100%"}},children:e.jsx(ma,{w:"100%",feeTierDistribution:le,feeTierDistributionLoading:O,current:$,onClick:C=>{var X,Z,te,be;C&&(C==null?void 0:C.value)===$||(C.title=="Not created"?a(`/pools/create/${(X=r==null?void 0:r.displayToken0)==null?void 0:X.metadata}/${(Z=r==null?void 0:r.displayToken1)==null?void 0:Z.metadata}/${C==null?void 0:C.value}`):(F(),a(`/pools/liquidity/${(te=r==null?void 0:r.displayToken0)==null?void 0:te.metadata}/${(be=r==null?void 0:r.displayToken1)==null?void 0:be.metadata}/${C.value}`)))}})}),e.jsxs(B,{align:"center",sx:{"@media screen and (max-width: 810px)":{w:"100%",mt:"-4px"}},children:[e.jsx(xs,{name:($t=r==null?void 0:r.displayToken0)==null?void 0:$t.symbol,address:(Dt=r==null?void 0:r.displayToken0)==null?void 0:Dt.metadata}),e.jsx(xs,{name:(Ft=r==null?void 0:r.displayToken1)==null?void 0:Ft.symbol,address:(Ut=r==null?void 0:r.displayToken1)==null?void 0:Ut.metadata})]})]}),e.jsxs(B,{gap:"60px",mt:"16px",sx:{"@media screen and (max-width: 810px)":{w:"100%",display:"flex",gap:"8px",mt:"12px",flexDirection:"column"}},children:[e.jsxs(q,{gap:"4px",align:"flex-start",sx:{"@media screen and (max-width: 810px)":{w:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},children:[e.jsx(w,{fontSize:"xs",children:"APR(24h)"}),e.jsx(Gi,{info:r,h5FontSize:"12px",children:e.jsx(w,{fontSize:"md",color:"text_caption",sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:Zs(v(r==null?void 0:r.totalApr).mul(100).toString())})})]}),e.jsx(yt,{text:"TVL(Total Value Locked)",value:qe((Ot=r==null?void 0:r.pureTvlUSD)==null?void 0:Ot.now,2)}),e.jsx(yt,{text:"Volume(24h)",value:qe((Wt=r==null?void 0:r.volUSD)==null?void 0:Wt.day,2)}),e.jsx(yt,{text:"Fees(24h)",value:qe((Vt=r==null?void 0:r.feesUSD)==null?void 0:Vt.day,2)})]}),e.jsxs(B,{w:"100%",gap:"16px",mt:"40px",align:"flex-start",sx:{"@media screen and (max-width: 810px)":{display:"flex",flexDirection:"column"}},children:[e.jsxs(q,{w:"60%",gap:"16px",minW:"580px",sx:{"@media screen and (max-width: 810px)":{minW:"unset",w:"100%"}},children:[e.jsxs(B,{w:"100%",sx:{"@media screen and (max-width: 810px)":{display:"flex",alignItems:"flex-start",flexDirection:"column"}},children:[e.jsxs(q,{w:"100%",align:"flex-start",gap:"4px",children:[e.jsx(w,{fontSize:"xs",children:"Current Price"}),e.jsxs(K,{children:[e.jsx(w,{fontSize:"md",color:"text_caption",children:Te}),e.jsx(w,{fontSize:"md",ml:"8px",children:je})]})]}),e.jsx(B,{sx:{"@media screen and (max-width: 810px)":{w:"100%",justifyContent:"space-between"}}})]}),e.jsx(N,{h:"332px",w:"100%",mt:"0px",userSelect:"none",children:e.jsx(cn,{handleClickRefresh:Se,ref:ye,rangeChartType:U,setRangeChartType:A})}),e.jsxs(q,{w:"100%",m:"12px 0",children:[e.jsxs(B,{w:"100%",justifyContent:"space-between",sx:{"@media screen and (max-width: 810px)":{mt:"60px",display:"flex",alignItems:"flex-start",flexDirection:"column"}},children:[e.jsxs(K,{align:"center",children:[e.jsx(w,{children:"Deposit Ratio"}),e.jsx(at,{label:"The Deposit Ratio indicates the proportion of token1 and token2 required to be deposited for the selected range.","aria-label":"Ratio",placement:t>810?"right":"bottom",children:e.jsx("button",{children:e.jsx(ce,{xlinkHref:"#icon-icon_tips",variant:"grayprimary"})})})]}),e.jsxs(B,{align:"center",gap:"12px",children:[e.jsxs(B,{gap:"6px",children:[e.jsx(re,{color:"text_caption",children:h==null?void 0:h.symbol}),e.jsxs(w,{color:"text_caption",children:[(h==null?void 0:h.metadata)&&(_==null?void 0:_[h==null?void 0:h.metadata]),"%"]})]}),e.jsx(N,{w:"100px",children:e.jsx(Mi,{value:h!=null&&h.metadata&&(_==null?void 0:_[h==null?void 0:h.metadata])!=="--"?Number(_==null?void 0:_[h==null?void 0:h.metadata]):0})}),e.jsxs(B,{gap:"6px",children:[e.jsx(re,{color:"text_caption",children:x==null?void 0:x.symbol}),e.jsxs(w,{color:"text_caption",children:[(x==null?void 0:x.metadata)&&(_==null?void 0:_[x==null?void 0:x.metadata]),"%"]})]})]})]}),e.jsxs(B,{w:"100%",justifyContent:"space-between",sx:{"@media screen and (max-width: 810px)":{mt:"12px",display:"flex",alignItems:"flex-start",flexDirection:"column"}},children:[e.jsxs(K,{align:"center",children:[e.jsx(w,{children:"Concentrated Liquidity Multiplier"}),e.jsx(at,{label:"Provide liquidity within a fixed price range, maximizing the efficiency of the capital locked.The Concentrated Liquidity Multiplier calculates the capital efficiency gains of a concentrated liquidity position relative to allocating capital across the entire price curve.","aria-label":"Multiplier",placement:t>810?"right":"bottom",children:e.jsx("button",{children:e.jsx(ce,{xlinkHref:"#icon-icon_tips",variant:"grayprimary"})})})]}),e.jsx(B,{align:"center",gap:"12px",children:e.jsx(w,{color:"text_caption",children:Je})})]})]}),t>810&&Et(t)]}),e.jsxs(q,{w:"40%",minW:"380px",maxW:"440px",gap:"16px",sx:{"@media screen and (max-width: 810px)":{w:"100%",maxW:"unset",minW:"unset"}},children:[e.jsx(ja,{}),e.jsx(Sa,{handleClickRefresh:Se}),t<=810&&Et(t)]})]}),e.jsx(Js,{isOpen:ke,onClose:()=>{ue(!1),a("/pools/pool")},onContinue:function(){ue(!1)},tokens:he})]}),Qe&&e.jsx(N,{mt:"20px",children:e.jsx(Ne,{type:"nodata",text:"Pool not found",h:"330px"})}),e.jsx(pa,{isOpen:we,onChange:me,onClose:()=>fe(!1)})]})}function xs(a){const{getExplorerUrl:t}=rt(),{name:o,address:s}=a;return e.jsxs(K,{w:"100%",bg:"bg_secondary",align:"center",p:"8px 12px",borderRadius:"8px",justifyContent:"center",children:[e.jsx(re,{fontSize:"xs",color:"text_caption",children:o}),e.jsx(it,{href:t(s),target:"_blank",variant:"link",fontSize:"xs",color:"primary",ml:"8px",children:Ve(s)})]})}function yt(a){const{text:t,value:o}=a;return e.jsxs(q,{gap:"4px",align:"flex-start",sx:{"@media screen and (max-width: 810px)":{w:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},children:[e.jsx(w,{fontSize:"xs",children:t}),e.jsx(w,{fontSize:"md",color:"text_caption",sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:o})]})}export{wc as default};
