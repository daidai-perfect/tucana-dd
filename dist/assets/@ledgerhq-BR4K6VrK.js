import{a as H}from"./@improbable-eng-BU3rlaSz.js";import{B as f}from"./vite-plugin-node-polyfills-2b3IylRN.js";import{E as te}from"./events-BYvclee5.js";import{a as B}from"./semver-DcF-0Uum.js";const ne={},ie={},$=(o,e)=>{ie[o]=e},t=o=>{class e extends Error{constructor(n,r,c){if(super(n||o,c),Object.setPrototypeOf(this,e.prototype),this.name=o,r)for(const s in r)this[s]=r[s];if(c&&oe(c)&&"cause"in c&&!("cause"in this)){const s=c.cause;this.cause=s,"stack"in s&&(this.stack=this.stack+`
CAUSE: `+s.stack)}}}return ne[o]=e,e};function oe(o){return typeof o=="object"}t("AccountNameRequired");t("AccountNotSupported");t("AmountRequired");t("BluetoothRequired");t("BtcUnmatchedApp");t("CantOpenDevice");t("CashAddrNotSupported");t("ClaimRewardsFeesWarning");t("CurrencyNotSupported");t("DeviceAppVerifyNotSupported");t("DeviceGenuineSocketEarlyClose");t("DeviceNotGenuine");t("DeviceOnDashboardExpected");t("DeviceOnDashboardUnexpected");t("DeviceInOSUExpected");t("DeviceHalted");t("DeviceNameInvalid");t("DeviceSocketFail");t("DeviceSocketNoBulkStatus");t("DeviceSocketNoBulkStatus");t("UnresponsiveDeviceError");const K=t("DisconnectedDevice"),W=t("DisconnectedDeviceDuringOperation");t("DeviceExtractOnboardingStateError");t("DeviceOnboardingStatePollingError");t("EnpointConfig");t("EthAppPleaseEnableContractData");t("FeeEstimationFailed");t("FirmwareNotRecognized");t("HardResetFail");t("InvalidXRPTag");t("InvalidAddress");t("InvalidNonce");t("InvalidAddressBecauseDestinationIsAlsoSource");t("LatestMCUInstalledError");t("UnknownMCU");t("LedgerAPIError");t("LedgerAPIErrorWithMessage");t("LedgerAPINotAvailable");t("ManagerAppAlreadyInstalled");t("ManagerAppRelyOnBTC");t("ManagerAppDepInstallRequired");t("ManagerAppDepUninstallRequired");t("ManagerDeviceLocked");t("ManagerFirmwareNotEnoughSpace");t("ManagerNotEnoughSpace");t("ManagerUninstallBTCDep");t("NetworkDown");t("NetworkError");t("NoAddressesFound");t("NotEnoughBalance");t("NotEnoughBalanceToDelegate");t("NotEnoughBalanceInParentAccount");t("NotEnoughSpendableBalance");t("NotEnoughBalanceBecauseDestinationNotCreated");t("NoAccessToCamera");t("NotEnoughGas");t("NotEnoughGasSwap");t("NotSupportedLegacyAddress");t("GasLessThanEstimate");t("PriorityFeeTooLow");t("PriorityFeeTooHigh");t("PriorityFeeHigherThanMaxFee");t("MaxFeeTooLow");t("PasswordsDontMatch");t("PasswordIncorrect");t("RecommendSubAccountsToEmpty");t("RecommendUndelegation");t("TimeoutTagged");t("UnexpectedBootloader");t("MCUNotGenuineToDashboard");t("RecipientRequired");t("UnavailableTezosOriginatedAccountReceive");t("UnavailableTezosOriginatedAccountSend");t("UpdateFetchFileFail");t("UpdateIncorrectHash");t("UpdateIncorrectSig");t("UpdateYourApp");t("UserRefusedDeviceNameChange");t("UserRefusedAddress");t("UserRefusedFirmwareUpdate");t("UserRefusedAllowManager");t("UserRefusedOnDevice");t("ExpertModeRequired");const A=t("TransportOpenUserCancelled"),k=t("TransportInterfaceNotAvailable"),re=t("TransportPendingOperation"),se=t("TransportWebUSBGestureRequired");t("TransactionHasBeenValidatedError");t("TransportExchangeTimeoutError");t("DeviceShouldStayInApp");t("WebsocketConnectionError");t("WebsocketConnectionFailed");t("WrongDeviceForAccount");t("WrongDeviceForAccountPayout");t("WrongDeviceForAccountRefund");t("WrongAppForCurrency");t("ETHAddressNonEIP");t("CantScanQRCode");t("FeeNotLoaded");t("FeeNotLoadedSwap");t("FeeRequired");t("FeeTooHigh");t("PendingOperation");t("SyncError");t("PairingFailed");t("PeerRemovedPairing");t("GenuineCheckFailed");t("LedgerAPI4xx");t("LedgerAPI5xx");t("FirmwareOrAppUpdateRequired");t("ReplacementTransactionUnderpriced");t("OpReturnSizeLimit");t("DustLimit");t("LanguageNotFound");t("NoDBPathGiven");t("DBWrongPassword");t("DBNotReset");t("SequenceNumberError");t("DisabledTransactionBroadcastError");var F;(function(o){o.Unknown="Unknown",o.LocationServicesDisabled="LocationServicesDisabled",o.LocationServicesUnauthorized="LocationServicesUnauthorized",o.BluetoothScanStartFailed="BluetoothScanStartFailed"})(F||(F={}));class v extends Error{constructor(e,i){const n="TransportError";super(e||n),this.name=n,this.message=e,this.stack=new Error(e).stack,this.id=i}}$("TransportError",o=>new v(o.message,o.id));const y={ACCESS_CONDITION_NOT_FULFILLED:38916,ALGORITHM_NOT_SUPPORTED:38020,CLA_NOT_SUPPORTED:28160,CODE_BLOCKED:38976,CODE_NOT_INITIALIZED:38914,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,CONDITIONS_OF_USE_NOT_SATISFIED:27013,CONTRADICTION_INVALIDATION:38928,CONTRADICTION_SECRET_CODE_STATUS:38920,CUSTOM_IMAGE_BOOTLOADER:26159,CUSTOM_IMAGE_EMPTY:26158,FILE_ALREADY_EXISTS:27273,FILE_NOT_FOUND:37892,GP_AUTH_FAILED:25344,HALTED:28586,INCONSISTENT_FILE:37896,INCORRECT_DATA:27264,INCORRECT_LENGTH:26368,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,DEVICE_NOT_ONBOARDED:27911,DEVICE_NOT_ONBOARDED_2:26129,INVALID_KCV:38021,INVALID_OFFSET:37890,LICENSING:28482,LOCKED_DEVICE:21781,MAX_VALUE_REACHED:38992,MEMORY_PROBLEM:37440,MISSING_CRITICAL_PARAMETER:26624,NO_EF_SELECTED:37888,NOT_ENOUGH_MEMORY_SPACE:27268,OK:36864,PIN_REMAINING_ATTEMPTS:25536,REFERENCED_DATA_NOT_FOUND:27272,SECURITY_STATUS_NOT_SATISFIED:27010,TECHNICAL_PROBLEM:28416,UNKNOWN_APDU:27906,USER_REFUSED_ON_DEVICE:21761,NOT_ENOUGH_SPACE:20738};function ce(o){switch(o){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received";case 21781:return"Locked device"}if(28416<=o&&o<=28671)return"Internal error, please report"}class S extends Error{constructor(e,{canBeMappedToChildError:i=!0}={}){const n=Object.keys(y).find(a=>y[a]===e)||"UNKNOWN_ERROR",r=ce(e)||n,c=e.toString(16),s=`Ledger device: ${r} (0x${c})`;if(super(s),this.name="TransportStatusError",this.statusCode=e,this.statusText=n,Object.setPrototypeOf(this,S.prototype),i&&e===y.LOCKED_DEVICE)return new U(s)}}class U extends S{constructor(e){super(y.LOCKED_DEVICE,{canBeMappedToChildError:!1}),e&&(this.message=e),this.name="LockedDeviceError",Object.setPrototypeOf(this,U.prototype)}}$("TransportStatusError",o=>new S(o.statusCode));let X=0;const m=[],T=(o,e,i)=>{const n={type:o,id:String(++X),date:new Date};e&&(n.message=e),Y(n)},ae=({type:o,message:e,data:i,context:n})=>{const r={type:o,id:String(++X),date:new Date};e&&(r.message=e),i&&(r.data=i),n&&(r.context=n),Y(r)};class D{constructor(e,i){this.type=e,this.context=i}trace(e,i){ae({type:this.type,message:e,data:i,context:this.context})}getContext(){return this.context}setContext(e){this.context=e}updateContext(e){this.context=Object.assign(Object.assign({},this.context),e)}getType(){return this.type}setType(e){this.type=e}withType(e){return new D(e,this.context)}withContext(e){return new D(this.type,e)}withUpdatedContext(e){return new D(this.type,Object.assign(Object.assign({},this.context),e))}}const de=o=>(m.push(o),()=>{const e=m.indexOf(o);e!==-1&&(m[e]=m[m.length-1],m.pop())});function Y(o){for(let e=0;e<m.length;e++)try{m[e](o)}catch(i){console.error(i)}}typeof window<"u"&&(window.__ledgerLogsListen=de);var w=function(o,e,i,n){function r(c){return c instanceof i?c:new i(function(s){s(c)})}return new(i||(i=Promise))(function(c,s){function a(d){try{u(n.next(d))}catch(p){s(p)}}function l(d){try{u(n.throw(d))}catch(p){s(p)}}function u(d){d.done?c(d.value):r(d.value).then(a,l)}u((n=n.apply(o,e||[])).next())})};const ue="transport";class _{constructor({context:e,logType:i}={}){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new te,this.send=(n,r,c,s,a=f.alloc(0),l=[y.OK],{abortTimeoutMs:u}={})=>w(this,void 0,void 0,function*(){const d=this.tracer.withUpdatedContext({function:"send"});if(a.length>=256)throw d.trace("data.length exceeded 256 bytes limit",{dataLength:a.length}),new v("data.length exceed 256 bytes limit. Got: "+a.length,"DataLengthTooBig");d.trace("Starting an exchange",{abortTimeoutMs:u});const p=yield this.exchange(f.concat([f.from([n,r,c,s]),f.from([a.length]),a]),{abortTimeoutMs:u});d.trace("Received response from exchange");const M=p.readUInt16BE(p.length-2);if(!l.some(ee=>ee===M))throw new S(M);return p}),this._appAPIlock=null,this.tracer=new D(i??ue,e)}exchange(e,{abortTimeoutMs:i}={}){throw new Error("exchange not implemented")}exchangeBulk(e,i){let n=!1;const r=()=>{n=!0};return w(this,void 0,void 0,function*(){if(!n)for(const s of e){const a=yield this.exchange(s);if(n)return;const l=a.readUInt16BE(a.length-2);if(l!==y.OK)throw new S(l);i.next(a)}}).then(()=>!n&&i.complete(),s=>!n&&i.error(s)),{unsubscribe:r}}setScrambleKey(e){}close(){return Promise.resolve()}on(e,i){this._events.on(e,i)}off(e,i){this._events.removeListener(e,i)}emit(e,...i){this._events.emit(e,...i)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(e){this.exchangeTimeout=e}setExchangeUnresponsiveTimeout(e){this.unresponsiveTimeout=e}static create(e=3e3,i){return new Promise((n,r)=>{let c=!1;const s=this.listen({next:l=>{c=!0,s&&s.unsubscribe(),a&&clearTimeout(a),this.open(l.descriptor,e).then(n,r)},error:l=>{a&&clearTimeout(a),r(l)},complete:()=>{a&&clearTimeout(a),c||r(new v(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),a=i?setTimeout(()=>{s.unsubscribe(),r(new v(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},i):null})}exchangeAtomicImpl(e){return w(this,void 0,void 0,function*(){const i=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw i.trace("Atomic exchange is already busy"),new re("An action was already pending on the Ledger device. Please deny or reconnect.");let n;const r=new Promise(a=>{n=a});this.exchangeBusyPromise=r;let c=!1;const s=setTimeout(()=>{i.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),c=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const a=yield e();return c&&(i.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),a}finally{i.trace("Finalize, clearing busy guard"),clearTimeout(s),n&&n(),this.exchangeBusyPromise=null}})}decorateAppAPIMethods(e,i,n){for(const r of i)e[r]=this.decorateAppAPIMethod(r,e[r],e,n)}decorateAppAPIMethod(e,i,n,r){return(...c)=>w(this,void 0,void 0,function*(){const{_appAPIlock:s}=this;if(s)return Promise.reject(new v("Ledger Device is busy (lock "+s+")","TransportLocked"));try{return this._appAPIlock=e,this.setScrambleKey(r),yield i.apply(n,c)}finally{this._appAPIlock=null}})}setTraceContext(e){this.tracer=this.tracer.withContext(e)}updateTraceContext(e){this.tracer.updateContext(e)}getTraceContext(){return this.tracer.getContext()}}_.ErrorMessage_ListenTimeout="No Ledger device found (timeout)";_.ErrorMessage_NoDeviceFound="No Ledger device found";const z=5;function le(o){const e=f.alloc(2);return e.writeUInt16BE(o,0),e}const he={data:f.alloc(0),dataLength:0,sequence:0},Q=(o,e)=>({makeBlocks(i){let n=f.concat([le(i.length),i]);const r=e-5,c=Math.ceil(n.length/r);n=f.concat([n,f.alloc(c*r-n.length+1).fill(0)]);const s=[];for(let a=0;a<c;a++){const l=f.alloc(5);l.writeUInt16BE(o,0),l.writeUInt8(z,2),l.writeUInt16BE(a,3);const u=n.slice(a*r,(a+1)*r);s.push(f.concat([l,u]))}return s},reduceResponse(i,n){let{data:r,dataLength:c,sequence:s}=i||he;if(n.readUInt16BE(0)!==o)throw new v("Invalid channel","InvalidChannel");if(n.readUInt8(2)!==z)throw new v("Invalid tag","InvalidTag");if(n.readUInt16BE(3)!==s)throw new v("Invalid sequence","InvalidSequence");i||(c=n.readUInt16BE(5)),s++;const a=n.slice(i?5:7);return r=f.concat([r,a]),r.length>c&&(r=r.slice(0,c)),{data:r,dataLength:c,sequence:s}},getReducedResult(i){if(i&&i.dataLength===i.data.length)return i.data}});var h;(function(o){o.blue="blue",o.nanoS="nanoS",o.nanoSP="nanoSP",o.nanoX="nanoX",o.stax="stax",o.europa="europa"})(h||(h={}));const C={[h.blue]:{id:h.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:o=>4*1024},[h.nanoS]:{id:h.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:o=>{var e;return B.lt((e=B.coerce(o))!==null&&e!==void 0?e:"","2.0.0")?4*1024:2*1024}},[h.nanoX]:{id:h.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:o=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[h.nanoSP]:{id:h.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:o=>32},[h.stax]:{id:h.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:o=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[h.europa]:{id:h.europa,productName:"Ledger Europa",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:o=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};h.blue,h.nanoS,h.nanoSP,h.nanoX,h.stax,h.europa;const q=Object.values(C),b=11415,O=o=>{const e=q.find(r=>r.legacyUsbProductId===o);if(e)return e;const i=o>>8;return q.find(r=>r.productIdMM===i)},pe=[],G={};for(const o in C){const e=C[o],{bluetoothSpec:i}=e;if(i)for(let n=0;n<i.length;n++){const r=i[n];pe.push(r.serviceUuid),G[r.serviceUuid]=G[r.serviceUuid.replace(/-/g,"")]=Object.assign({deviceModel:e},r)}}var g=function(o,e,i,n){function r(c){return c instanceof i?c:new i(function(s){s(c)})}return new(i||(i=Promise))(function(c,s){function a(d){try{u(n.next(d))}catch(p){s(p)}}function l(d){try{u(n.throw(d))}catch(p){s(p)}}function u(d){d.done?c(d.value):r(d.value).then(a,l)}u((n=n.apply(o,e||[])).next())})};const fe=[{vendorId:b}],ge=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),N=()=>{const{hid:o}=navigator;if(!o)throw new v("navigator.hid is not supported","HIDNotSupported");return o};function Z(){return g(this,void 0,void 0,function*(){const o=yield N().requestDevice({filters:fe});return Array.isArray(o)?o:[o]})}function L(){return g(this,void 0,void 0,function*(){return(yield N().getDevices()).filter(e=>e.vendorId===b)})}function ve(){return g(this,void 0,void 0,function*(){const o=yield L();return o.length>0?o[0]:(yield Z())[0]})}class x extends _{constructor(e){super(),this.channel=Math.floor(Math.random()*65535),this.packetSize=64,this.inputs=[],this.read=()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(i=>{this.inputCallback=i}),this.onInputReport=i=>{const n=f.from(i.data.buffer);this.inputCallback?(this.inputCallback(n),this.inputCallback=null):this.inputs.push(n)},this._disconnectEmitted=!1,this._emitDisconnect=i=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",i))},this.exchange=i=>g(this,void 0,void 0,function*(){return yield this.exchangeAtomicImpl(()=>g(this,void 0,void 0,function*(){const{channel:r,packetSize:c}=this;T("apdu","=> "+i.toString("hex"));const s=Q(r,c),a=s.makeBlocks(i);for(let d=0;d<a.length;d++)yield this.device.sendReport(0,a[d]);let l,u;for(;!(l=s.getReducedResult(u));){const d=yield this.read();u=s.reduceResponse(u,d)}return T("apdu","<= "+l.toString("hex")),l})).catch(r=>{throw r&&r.message&&r.message.includes("write")?(this._emitDisconnect(r),new W(r.message)):r})}),this.device=e,this.deviceModel=typeof e.productId=="number"?O(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static request(){return g(this,void 0,void 0,function*(){const[e]=yield Z();return x.open(e)})}static openConnected(){return g(this,void 0,void 0,function*(){const e=yield L();return e.length===0?null:x.open(e[0])})}static open(e){return g(this,void 0,void 0,function*(){yield e.open();const i=new x(e),n=r=>{e===r.device&&(N().removeEventListener("disconnect",n),i._emitDisconnect(new K))};return N().addEventListener("disconnect",n),i})}close(){return g(this,void 0,void 0,function*(){yield this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),yield this.device.close()})}setScrambleKey(){}}x.isSupported=ge;x.list=L;x.listen=o=>{let e=!1;ve().then(n=>{if(!n)o.error(new A("Access denied to use Ledger device"));else if(!e){const r=typeof n.productId=="number"?O(n.productId):void 0;o.next({type:"add",descriptor:n,deviceModel:r}),o.complete()}},n=>{o.error(new A(n.message))});function i(){e=!0}return{unsubscribe:i}};const me=Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"})),_e=H(me);var R=function(o,e,i,n){function r(c){return c instanceof i?c:new i(function(s){s(c)})}return new(i||(i=Promise))(function(c,s){function a(d){try{u(n.next(d))}catch(p){s(p)}}function l(d){try{u(n.throw(d))}catch(p){s(p)}}function u(d){d.done?c(d.value):r(d.value).then(a,l)}u((n=n.apply(o,e||[])).next())})};const xe=[{vendorId:b}];function J(){return R(this,void 0,void 0,function*(){return yield navigator.usb.requestDevice({filters:xe})})}function P(){return R(this,void 0,void 0,function*(){return(yield navigator.usb.getDevices()).filter(e=>e.vendorId===b)})}function Ee(){return R(this,void 0,void 0,function*(){const o=yield P();return o.length>0?o[0]:J()})}const Ie=()=>Promise.resolve(!!navigator&&!!navigator.usb&&typeof navigator.usb.getDevices=="function");var I=function(o,e,i,n){function r(c){return c instanceof i?c:new i(function(s){s(c)})}return new(i||(i=Promise))(function(c,s){function a(d){try{u(n.next(d))}catch(p){s(p)}}function l(d){try{u(n.throw(d))}catch(p){s(p)}}function u(d){d.done?c(d.value):r(d.value).then(a,l)}u((n=n.apply(o,e||[])).next())})};const ye=1,V=3;class E extends _{constructor(e,i){super(),this.channel=Math.floor(Math.random()*65535),this.packetSize=64,this._disconnectEmitted=!1,this._emitDisconnect=n=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",n))},this.device=e,this.interfaceNumber=i,this.deviceModel=O(e.productId)}static request(){return I(this,void 0,void 0,function*(){const e=yield J();return E.open(e)})}static openConnected(){return I(this,void 0,void 0,function*(){const e=yield P();return e.length===0?null:E.open(e[0])})}static open(e){return I(this,void 0,void 0,function*(){yield e.open(),e.configuration===null&&(yield e.selectConfiguration(ye)),yield j(e);const i=e.configurations[0].interfaces.find(({alternates:s})=>s.some(a=>a.interfaceClass===255));if(!i)throw new k("No WebUSB interface found for your Ledger device. Please upgrade firmware or contact techsupport.");const n=i.interfaceNumber;try{yield e.claimInterface(n)}catch(s){throw yield e.close(),new k(s.message)}const r=new E(e,n),c=s=>{e===s.device&&(navigator.usb.removeEventListener("disconnect",c),r._emitDisconnect(new K))};return navigator.usb.addEventListener("disconnect",c),r})}close(){return I(this,void 0,void 0,function*(){yield this.exchangeBusyPromise,yield this.device.releaseInterface(this.interfaceNumber),yield j(this.device),yield this.device.close()})}exchange(e){return I(this,void 0,void 0,function*(){return yield this.exchangeAtomicImpl(()=>I(this,void 0,void 0,function*(){const{channel:n,packetSize:r}=this;T("apdu","=> "+e.toString("hex"));const c=Q(n,r),s=c.makeBlocks(e);for(let u=0;u<s.length;u++)yield this.device.transferOut(V,s[u]);let a,l;for(;!(a=c.getReducedResult(l));){const u=yield this.device.transferIn(V,r),d=f.from(u.data.buffer);l=c.reduceResponse(l,d)}return T("apdu","<= "+a.toString("hex")),a})).catch(n=>{throw n&&n.message&&n.message.includes("disconnected")?(this._emitDisconnect(n),new W(n.message)):n})})}setScrambleKey(){}}E.isSupported=Ie;E.list=P;E.listen=o=>{let e=!1;Ee().then(n=>{if(!e){const r=O(n.productId);o.next({type:"add",descriptor:n,deviceModel:r}),o.complete()}},n=>{window.DOMException&&n instanceof window.DOMException&&n.code===18?o.error(new se(n.message)):o.error(new A(n.message))});function i(){e=!0}return{unsubscribe:i}};function j(o){return I(this,void 0,void 0,function*(){try{yield o.reset()}catch(e){console.warn(e)}})}const Se=Object.freeze(Object.defineProperty({__proto__:null,default:E},Symbol.toStringTag,{value:"Module"})),be=H(Se);export{be as a,_e as r};
