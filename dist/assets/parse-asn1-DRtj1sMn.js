import{r as P}from"./asn1.js-BnSaV4mo.js";import{e as q}from"./evp_bytestokey-Dyx8YxuJ.js";import{b as j}from"./browserify-aes-BUcIY7yD.js";import{s as g}from"./safe-buffer-B7h8REzA.js";import{b as S}from"./pbkdf2-C-6u4RPY.js";var s={},a=P(),m=a.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),R=a.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),b=a.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),C=a.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(b),this.key("subjectPublicKey").bitstr())}),T=a.define("RelativeDistinguishedName",function(){this.setof(R)}),x=a.define("RDNSequence",function(){this.seqof(T)}),K=a.define("Name",function(){this.choice({rdnSequence:this.use(x)})}),D=a.define("Validity",function(){this.seq().obj(this.key("notBefore").use(m),this.key("notAfter").use(m))}),w=a.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),B=a.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(b),this.key("issuer").use(K),this.key("validity").use(D),this.key("subject").use(K),this.key("subjectPublicKeyInfo").use(C),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(w).optional())}),N=a.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(B),this.key("signatureAlgorithm").use(b),this.key("signatureValue").bitstr())}),V=N,n=P();s.certificate=V;var Y=n.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});s.RSAPrivateKey=Y;var $=n.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});s.RSAPublicKey=$;var E=n.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),_=n.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(E),this.key("subjectPublicKey").bitstr())});s.PublicKey=_;var U=n.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(E),this.key("subjectPrivateKey").octstr())});s.PrivateKey=U;var F=n.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});s.EncryptedPrivateKey=F;var z=n.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});s.DSAPrivateKey=z;s.DSAparam=n.define("DSAparam",function(){this.int()});var G=n.define("ECParameters",function(){this.choice({namedCurve:this.objid()})}),L=n.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(G),this.key("publicKey").optional().explicit(1).bitstr())});s.ECPrivateKey=L;s.signature=n.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())});const X={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"};var H=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,J=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,M=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,O=q,Q=j,p=g.Buffer,W=function(i,h){var y=i.toString(),o=y.match(H),t;if(o){var e="aes"+o[1],d=p.from(o[2],"hex"),f=p.from(o[3].replace(/[\r\n]/g,""),"base64"),v=O(h,d.slice(0,8),parseInt(o[1],10)).key,u=[],k=Q.createDecipheriv(e,v,d);u.push(k.update(f)),u.push(k.final()),t=p.concat(u)}else{var c=y.match(M);t=p.from(c[2].replace(/[\r\n]/g,""),"base64")}var I=y.match(J)[1];return{tag:I,data:t}},r=s,Z=X,ee=W,te=j,ie=S,l=g.Buffer;function re(i,h){var y=i.algorithm.decrypt.kde.kdeparams.salt,o=parseInt(i.algorithm.decrypt.kde.kdeparams.iters.toString(),10),t=Z[i.algorithm.decrypt.cipher.algo.join(".")],c=i.algorithm.decrypt.cipher.iv,e=i.subjectPrivateKey,d=parseInt(t.split("-")[1],10)/8,f=ie.pbkdf2Sync(h,y,o,d,"sha1"),v=te.createDecipheriv(t,f,c),u=[];return u.push(v.update(e)),u.push(v.final()),l.concat(u)}function A(i){var h;typeof i=="object"&&!l.isBuffer(i)&&(h=i.passphrase,i=i.key),typeof i=="string"&&(i=l.from(i));var y=ee(i,h),o=y.tag,t=y.data,c,e;switch(o){case"CERTIFICATE":e=r.certificate.decode(t,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(e||(e=r.PublicKey.decode(t,"der")),c=e.algorithm.algorithm.join("."),c){case"1.2.840.113549.1.1.1":return r.RSAPublicKey.decode(e.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return e.subjectPrivateKey=e.subjectPublicKey,{type:"ec",data:e};case"1.2.840.10040.4.1":return e.algorithm.params.pub_key=r.DSAparam.decode(e.subjectPublicKey.data,"der"),{type:"dsa",data:e.algorithm.params};default:throw new Error("unknown key id "+c)}case"ENCRYPTED PRIVATE KEY":t=r.EncryptedPrivateKey.decode(t,"der"),t=re(t,h);case"PRIVATE KEY":switch(e=r.PrivateKey.decode(t,"der"),c=e.algorithm.algorithm.join("."),c){case"1.2.840.113549.1.1.1":return r.RSAPrivateKey.decode(e.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:e.algorithm.curve,privateKey:r.ECPrivateKey.decode(e.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return e.algorithm.params.priv_key=r.DSAparam.decode(e.subjectPrivateKey,"der"),{type:"dsa",params:e.algorithm.params};default:throw new Error("unknown key id "+c)}case"RSA PUBLIC KEY":return r.RSAPublicKey.decode(t,"der");case"RSA PRIVATE KEY":return r.RSAPrivateKey.decode(t,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:r.DSAPrivateKey.decode(t,"der")};case"EC PRIVATE KEY":return t=r.ECPrivateKey.decode(t,"der"),{curve:t.parameters.value,privateKey:t.privateKey};default:throw new Error("unknown key type "+o)}}A.signature=r.signature;var ye=A;export{ye as p};
