import{a0 as Ce,Q as Ne,r as x,a8 as Re,o as Le,j as a,F as J,V as ae,bA as Me,q as G,a1 as le,H as f,p as Qe,T as C,I as Te,aF as We,t as u,ak as F,B as pe,S as we,w as te,N as ye,a9 as Ze,aa as Oe,ab as Ie,ac as De,ad as Pe,ae as et,af as tt,ag as Be,bB as at,X as _e,W as fe,Y as st,al as qe,U as Ue,bf as Ve,Z as ie,aR as Ye,K as ge,J as xe,_ as Xe,M as nt,a as rt,b as lt,c as ct,d as ot,e as dt,bb as Se,O as $e,G as ze,i as de,aI as he,aS as it,aT as ut,aU as xt,aV as mt,R as gt,L as ht,be as kt,l as St,bC as Tt,$ as wt,y as pt,v as jt}from"./index-CZ9BtG6K.js";import{B as yt}from"./BackButton-kWb8EKEC.js";import{R as bt}from"./RefreshIcon-DU_SDOKY.js";import{f as vt,P as Ct,b as Rt,a as _t,c as At,g as Pt}from"./PositionIncreaseModal-BcmT38T7.js";import{u as ce,P as Bt,R as Fe}from"./RectangularTab-CB6psDTh.js";import{S as Lt,T as be,u as $t}from"./useDebounce-BVAm3t-5.js";import{g as Mt}from"./apiDataProcessing-BAM4zGSR.js";import{c as Je,d as Ge,b as Ke}from"./useClaim-yFLFlsig.js";import{T as Ee}from"./TableCardH5-n0g93OwG.js";import{L as ve}from"./LockMask-BmIYgER1.js";import{u as Dt}from"./useRate-Dv8umWLB.js";import{C as Vt}from"./CurrentPrice-CLWTQWwc.js";import"./useGetTokenInfo-DtHHTkmp.js";function zt(T){var v,c,$,V,H,R,q,X,K,P,_;const{handleRefreshClick:s}=T;Ce(),Ne();const[t,o]=x.useState(!1),{isImportToken:n}=Re(),{positionInfo:r,liquidityPriceObj:l,positionLoading:m,setPositionLoading:d,setPositionLiquidityPriceLoading:h,setPositionFeeLoading:e,setPositionRewardsLoading:y}=ce(),{getPositionUrl:B}=We(),[S,L]=x.useState(!1),{displayMaxPrice:z,displayMinPrice:g}=vt({minPrice:r==null?void 0:r.minPrice,maxPrice:r==null?void 0:r.maxPrice,changeSide:S}),k=x.useMemo(()=>{var N;return(r==null?void 0:r.posId)&&((N=l==null?void 0:l[r==null?void 0:r.posId])==null?void 0:N.status)==="Active"||!1},[r,l]),w=()=>a.jsxs(C,{p:"6px 12px 6px 12px",borderRadius:"8px",fontSize:"xs",backgroundColor:"bg_secondary",color:"text_caption",children:[Mt(r==null?void 0:r.feeTier)," fee tier"]}),{windowWidth:A}=Le();return a.jsxs(J,{w:"100%",mt:"20px",minW:"1010px",justifyContent:"space-between",sx:{"@media screen and (max-width: 810px)":{minW:"unset"}},children:[a.jsxs(ae,{alignItems:"start",w:"100%",h:"80px",sx:{"@media screen and (max-width: 810px)":{h:"unset",alignItems:"flex-start",justifyContent:"flex-start"}},children:[m?a.jsxs(J,{w:"40%",h:"40px",align:"center",children:[a.jsx(Me,{size:"9",minW:"36px"}),a.jsx(G,{ml:"-20px",mr:"8px",children:a.jsx(Me,{size:"9",minW:"36px"})}),a.jsx(le,{w:"100%"})]}):a.jsxs(f,{gap:"16px",children:[a.jsx(Qe,{coinAIconUrl:(v=r==null?void 0:r.displayToken0)==null?void 0:v.image,coinBIconUrl:(c=r==null?void 0:r.displayToken1)==null?void 0:c.image,variant:"border",w:"40px",showATag:n((($=r==null?void 0:r.displayToken0)==null?void 0:$.metadata)||""),showBTag:n(((V=r==null?void 0:r.displayToken1)==null?void 0:V.metadata)||"")}),a.jsxs(C,{fontSize:"2xl",color:"text_caption",sx:{"@media screen and (max-width: 810px)":{fontSize:"xl"}},children:[(H=r==null?void 0:r.displayToken0)==null?void 0:H.symbol,"-",(R=r==null?void 0:r.displayToken1)==null?void 0:R.symbol," LP（#",r==null?void 0:r.position_index,"）"]})]}),a.jsxs(f,{w:"100%",justifyContent:"space-between",sx:{"@media screen and (max-width: 810px)":{display:"flex",alignItems:"flex-start"}},children:[m?a.jsx(J,{h:"36px",w:"60%",align:"center",children:a.jsx(le,{w:"100%"})}):a.jsxs(f,{gap:"16px",sx:{"@media screen and (max-width: 810px)":{display:"flex",alignItems:"flex-start",justifyContent:"flex-start",flexDirection:"column-reverse"}},children:[A>810&&w(),a.jsx(Ct,{minPrice:g,maxPrice:z,baseSymbol:S?(q=r==null?void 0:r.displayToken1)==null?void 0:q.symbol:(X=r==null?void 0:r.displayToken0)==null?void 0:X.symbol,quoteSymbol:S?(K=r==null?void 0:r.displayToken0)==null?void 0:K.symbol:(P=r==null?void 0:r.displayToken1)==null?void 0:P.symbol,changeSide:S,setChangeSide:L}),a.jsxs(f,{children:[A<=810&&w(),r&&r.owner.length===0&&a.jsx(f,{pl:"12px",pr:"12px",pt:"6px",pb:"6px",ml:"-10px",borderRadius:"6px",backgroundColor:"bg_secondary",children:a.jsx(C,{fontSize:"xs",children:"Closed"})}),r&&r.owner.length>0&&a.jsx(Bt,{status:(r==null?void 0:r.posId)&&((_=l==null?void 0:l[r==null?void 0:r.posId])==null?void 0:_.status),isActive:k}),a.jsx(f,{p:"6px",borderRadius:"8px",backgroundColor:"bg_secondary",_hover:{opacity:.8},onClick:()=>{window.open(B(r==null?void 0:r.collection_id,r==null?void 0:r.id),"_blank")},children:a.jsx(Te,{xlinkHref:"#icon-icon_lead",cursor:"pointer",transform:"rotate(-45deg)"})})]})]}),a.jsxs(f,{gap:"10px",sx:{"@media screen and (max-width: 810px)":{mt:"-90px",ml:"-20px"}},children:[a.jsx(bt,{handleClickRefresh:s,boxH:"32px",boxW:"32px",svgW:"20px",svgH:"20px"}),a.jsx(Te,{boxW:"32px",boxH:"32px",variant:"rectangle",xlinkHref:"#icon-icon_slider",onClick:()=>{o(!0)}})]})]})]}),a.jsx(Lt,{isOpen:t,onClose:()=>o(!1)})]})}function Et(T){var A,v,c,$;const{pid:s}=T,{positionInfo:t,liquidityPriceObj:o,currentPoolInfo:n,positionFeeObj:r,posRewardsObj:l,claimFeeAndRewardsSubmitLoading:m,positionLoading:d,positionFeeLoading:h,positionRewardsLoading:e,positionLiquidityPriceLoading:y}=ce(),{handleSubmitClaim:B,isDisabledClaimBtn:S}=Je();x.useEffect(()=>{console.log("PositionInfo Component positionInfo: ",t,n)},[t]),x.useEffect(()=>{console.log("PositionInfo Component liquidityPriceObj: ",o)},[o]),x.useEffect(()=>{console.log("PositionInfo Component positionFeeObj: ",r)},[r]),x.useEffect(()=>{console.log("PositionInfo Component posRewardsObj: ",l)},[l]);const L=x.useMemo(()=>{var q,X,K;const V=((q=o==null?void 0:o[s])==null?void 0:q.total)||"0",H=((X=r==null?void 0:r[s])==null?void 0:X.total)||"0",R=((K=l==null?void 0:l[s])==null?void 0:K.total)||"0";return V==="--"||H==="--"||R==="--"?"--":u(V).add(H).add(R).toString()},[s,o,r,l]),z=x.useMemo(()=>{var R,q;const V=((R=r==null?void 0:r[s])==null?void 0:R.total)||"0",H=((q=l==null?void 0:l[s])==null?void 0:q.total)||"0";return V==="--"||H==="--"?"--":u(V).add(H).toString()},[s,r,l]),g=x.useMemo(()=>o==null?void 0:o[s],[o]),k=x.useMemo(()=>r==null?void 0:r[s],[r]),w=x.useMemo(()=>(n==null?void 0:n.isReverse)||!1,[n]);return a.jsxs(G,{w:"100%",borderRadius:"16px",backgroundColor:"card_bg",padding:"16px",children:[a.jsx(C,{fontSize:"md",color:"text_caption",children:"Position Info"}),a.jsxs(f,{justifyContent:"space-between",mt:"16px",children:[a.jsxs(G,{children:[a.jsx(C,{fontSize:"xs",children:"Total"}),y||h||e?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsx(C,{fontSize:"md",color:"text_caption",children:F(L,2)})]}),a.jsxs(f,{children:[h||e?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsxs(C,{fontSize:"md",color:"text_caption",children:["~",F(z,2)]}),a.jsx(pe,{fontSize:"xs",h:"32px",lineHeight:"32px",borderRadius:"8px",isLoading:m,isDisabled:S,onClick:B,children:"Claim Yield"})]})]}),a.jsxs(f,{justifyContent:"space-between",mt:"16px",gap:"16px",sx:{"@media screen and (max-width: 810px)":{display:"flex",flexDirection:"column"}},children:[a.jsx(He,{title:"Liquidity",titleIsLoading:y,positionLoading:d,token0:t==null?void 0:t.displayToken0,token1:t==null?void 0:t.displayToken1,amount0:w?g==null?void 0:g.coinAmount1:g==null?void 0:g.coinAmount0,amount1:w?g==null?void 0:g.coinAmount0:g==null?void 0:g.coinAmount1,amount0Value:w?g==null?void 0:g.coinAmount1Rate:g==null?void 0:g.coinAmount0Rate,amount1Value:w?g==null?void 0:g.coinAmount0Rate:g==null?void 0:g.coinAmount1Rate,total:g==null?void 0:g.liquidityRate}),a.jsx(He,{title:"Fees Earnings",titleIsLoading:h,positionLoading:d,token0:t==null?void 0:t.displayToken0,token1:t==null?void 0:t.displayToken1,amount0:w?(k==null?void 0:k.fee1)||0:(k==null?void 0:k.fee0)||0,amount1:w?(k==null?void 0:k.fee0)||0:(k==null?void 0:k.fee1)||0,amount0Value:w?k==null?void 0:k.fee1Rate:k==null?void 0:k.fee0Rate,amount1Value:w?k==null?void 0:k.fee0Rate:k==null?void 0:k.fee1Rate,total:F(k==null?void 0:k.total,2)})]}),((A=l==null?void 0:l[s])==null?void 0:A.rewards)&&((v=l==null?void 0:l[s])==null?void 0:v.rewards.length)>0&&a.jsx(Ht,{total:(c=l==null?void 0:l[s])==null?void 0:c.total,rewards:($=l==null?void 0:l[s])==null?void 0:$.rewards,positionRewardsLoading:e})]})}function Ht(T){const{total:s,rewards:t,positionRewardsLoading:o}=T;return a.jsxs(f,{pl:"16px",pr:"16px",w:"100%",h:"68px",justifyContent:"space-between",borderRadius:"16px",bg:"warning_10",mt:"16px",children:[a.jsxs(G,{children:[a.jsx(C,{fontSize:"xs",children:"Rewards"}),o?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsx(C,{fontSize:"md",color:"warning",children:F(s,2)})]}),o?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsx(f,{gap:"8px",children:t==null?void 0:t.map((n,r)=>{var l,m;return a.jsxs(f,{children:[a.jsx(we,{width:"20px",height:"20px",imageUrl:(l=n==null?void 0:n.token)==null?void 0:l.image}),a.jsxs(C,{fontSize:"xs",color:"text_caption",children:[te((n==null?void 0:n.amount)||"0")," ",(m=n==null?void 0:n.token)==null?void 0:m.symbol]})]},r)})})]})}function He(T){const{title:s,token0:t,token1:o,amount0:n,amount1:r,amount0Value:l,amount1Value:m,total:d,titleIsLoading:h,positionLoading:e}=T,{isImportToken:y}=Re();return a.jsxs(ae,{w:"100%",gap:"0px",children:[a.jsxs(ae,{p:"16px",borderRadius:"16px 16px 0px 0px",bg:"position_info_card_bg",w:"90%",children:[a.jsx(C,{fontSize:"xs",children:s}),h?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsx(C,{fontSize:"md",color:"text_highlight",children:d})]}),a.jsxs(ae,{borderRadius:"16px",bg:"bg_secondary",w:"100%",gap:"0px",children:[a.jsxs(f,{h:"48px",justifyContent:"space-between",w:"100%",pl:"12px",pr:"12px",children:[e?a.jsx(J,{h:"20px",align:"center",children:a.jsx(le,{})}):a.jsxs(f,{gap:"8px",children:[a.jsx(we,{width:"20px",height:"20px",imageUrl:t==null?void 0:t.image,showTag:y(t==null?void 0:t.metadata),showTagWidth:"14px",showTagHeight:"14px"}),a.jsx(C,{fontSize:"xs",color:"text_caption",children:t==null?void 0:t.symbol})]}),e?a.jsx(J,{h:"20px",align:"center",children:a.jsx(le,{})}):a.jsxs(ae,{gap:"0px",alignItems:"end",children:[a.jsx(C,{fontSize:"xs",color:"text_caption",children:te(n||"0")}),a.jsx(C,{fontSize:"xs",children:F(l,2)})]})]}),a.jsx(G,{h:"1px",w:"100%",backgroundColor:"form_item_bg"}),a.jsxs(f,{h:"48px",justifyContent:"space-between",w:"100%",pl:"12px",pr:"12px",children:[e?a.jsx(J,{h:"20px",align:"center",children:a.jsx(le,{})}):a.jsxs(f,{gap:"8px",children:[a.jsx(we,{width:"20px",height:"20px",imageUrl:o==null?void 0:o.image,showTag:y(o==null?void 0:o.metadata),showTagWidth:"14px",showTagHeight:"14px"}),a.jsx(C,{fontSize:"xs",color:"text_caption",children:o==null?void 0:o.symbol})]}),e?a.jsx(J,{h:"20px",align:"center",children:a.jsx(le,{})}):a.jsxs(ae,{gap:"0px",alignItems:"end",children:[a.jsx(C,{fontSize:"xs",color:"text_caption",children:te(r||"0")}),a.jsx(C,{fontSize:"xs",children:F(m,2)})]})]})]})]})}function Nt(T){const{dataList:s,loading:t,windowWidth:o}=T;if(s.length===0)return a.jsx(ye,{type:"nodata"});if(s.length===0)return a.jsx(ye,{type:"nodata"});const n=d=>a.jsx(C,{fontSize:"xs",color:"text_caption",children:d==null?void 0:d.event_type}),r=d=>a.jsx(ft,{coins:d==null?void 0:d.coin_change}),l=d=>a.jsx(Wt,{time:d==null?void 0:d.block_time,tx:d.tx}),m=d=>[{leftText:"Action",right:n(d)},{leftText:"Token transferred",right:r(d)},{leftText:"Time",right:l(d)}];return a.jsx(Ze,{w:"100%",borderRadius:"16px",backgroundColor:"card_bg",p:"16px 16px 0",sx:{"@media screen and (max-width: 810px)":{p:"0"}},children:o<=810?a.jsx(ae,{w:"100%",p:"8px",children:t?[{},{},{}].map((d,h)=>a.jsx(ae,{w:"100%",borderBottom:"1px solid ",borderColor:"border",children:a.jsx(Ee,{isLoading:t})},h)):s==null?void 0:s.map((d,h)=>a.jsx(ae,{w:"100%",children:a.jsx(Ee,{isLoading:t,rowList:m(d)})},d==null?void 0:d.pool))}):a.jsxs(Oe,{variant:"simple",size:"lg",children:[a.jsx(Ie,{children:a.jsxs(De,{children:[a.jsx(Pe,{children:"Action"}),a.jsx(Pe,{textAlign:"end",children:"Token transferred"}),a.jsx(Pe,{textAlign:"end",children:"Time"})]})}),t?a.jsx(et,{tableList:[{},{},{}],tdList:[{},{},{}],minW:"unset"}):a.jsx(tt,{children:s.map((d,h)=>a.jsxs(De,{children:[a.jsx(Be,{children:n(d)}),a.jsx(Be,{children:r(d)}),a.jsx(Be,{children:l(d)})]},h))})]})})}function Wt(T){const{time:s,tx:t}=T,{getExplorerUrl:o}=We();return a.jsxs(f,{gap:"4px",justifyContent:"end",children:[a.jsx(C,{fontSize:"xs",color:"text_caption",children:at(Date.parse(s)-8*60*60*1e3)}),a.jsx(Te,{padding:"2px",xlinkHref:"#icon-icon_lead",cursor:"pointer",transform:"rotate(-45deg)",onClick:()=>{window.open(o(t,"tx"),"_blank")}})]})}function ft(T){const{coins:s}=T;return a.jsx(ae,{alignItems:"end",children:s.map((t,o)=>a.jsxs(f,{gap:"8px",children:[a.jsx(we,{width:"20px",height:"20px",imageUrl:t.image}),a.jsx(C,{fontSize:"xs",color:"text_caption",children:t.amount})]},o))})}function qt(){const T=_e(),{refreshPositionData:s}=Ge(),{slippage:t}=fe(),{toeknBalanceValue:o}=st(),{getAddLiquidityPaylod:n}=qe(),{signAndExecuteTransaction:r}=Ue(),{addToken0Value:l,addToken1Value:m,setAddToken0Value:d,setAddToken1Value:h,positionInfo:e,liquidityPriceObj:y,posStatus:B,precomputationAdd:S,setPrecomputationAdd:L,ratio:z,increaseSubmitLoading:g,setIncreaseSubmitLoading:k}=ce(),[w,A]=x.useState(),v=x.useMemo(()=>{var P,_,N;return o&&((P=e==null?void 0:e.token0)!=null&&P.metadata)?Ve(o((_=e==null?void 0:e.token0)==null?void 0:_.metadata),(N=e==null?void 0:e.token0)==null?void 0:N.decimals).toString():"0"},[o,e==null?void 0:e.token0]),c=x.useMemo(()=>{var P,_,N;return o&&((P=e==null?void 0:e.token1)!=null&&P.metadata)?Ve(o((_=e==null?void 0:e.token1)==null?void 0:_.metadata),(N=e==null?void 0:e.token1)==null?void 0:N.decimals).toString():"0"},[o,e==null?void 0:e.token1]),$=P=>{var _;((_=e==null?void 0:e.owner)==null?void 0:_.length)!==0&&(console.log("handleAddToken0ValueChange value: ",P),console.log("handleAddToken0ValueChange positionInfo?.token0: ",e==null?void 0:e.token0),d(P),A(e==null?void 0:e.token0))},V=P=>{var _;((_=e==null?void 0:e.owner)==null?void 0:_.length)!==0&&(console.log("handleAddToken1ValueChange value: ",P),console.log("handleAddToken1ValueChange positionInfo?.token1: ",e==null?void 0:e.token1),h(P),A(e==null?void 0:e.token1))};x.useEffect(()=>{var p,j,b,M,U,W,E;if(!Number(l)&&!Number(m))return;const P=e==null?void 0:e.tick_lower_index,_=e==null?void 0:e.tick_upper_index,N=(e==null?void 0:e.posId)&&((p=y==null?void 0:y[e==null?void 0:e.posId])==null?void 0:p.currentSqrtPrice),Q=(w==null?void 0:w.metadata)===((j=e==null?void 0:e.token0)==null?void 0:j.metadata),Z=(w==null?void 0:w.metadata)===((b=e==null?void 0:e.token0)==null?void 0:b.metadata);console.log("precomputation fixedToken: ",w,Q),console.log("precomputation isInputDisplayToken0: ",Z);const i=Z?ie(l,(M=e==null?void 0:e.token0)==null?void 0:M.decimals):ie(m,(U=e==null?void 0:e.token1)==null?void 0:U.decimals);if(console.log("precomputation amount: ",i.toString()),!i||u(i.toString()).equals(0)){h(""),d("");return}if(console.log("precomputation sqrtPriceX98: ",N),console.log("precomputation posStatus: ",B),!(P===void 0||_===void 0||!N))if(B==="active"){const D=Ye.estLiquidityAndcoinAmountFromOneAmounts(P,_,i,Q,!0,t,new ge(N));if(Q?D.coinAmountA=i:D.coinAmountB=i,L(D),console.log("precomputation preInfo coinAmountA: ",D.coinAmountA.toString()),console.log("precomputation preInfo coinAmountB: ",D.coinAmountB.toString()),Z){const Y=xe(D.coinAmountB,(W=e==null?void 0:e.token1)==null?void 0:W.decimals);u(Y).eq(0)?h(""):h(Y)}else{const Y=xe(D.coinAmountA,(E=e==null?void 0:e.token0)==null?void 0:E.decimals);u(Y).eq(0)?d(""):d(Y)}}else L(void 0)},[l,m,w,y,e,t,B]);const H=Rt(e==null?void 0:e.token0,e==null?void 0:e.token1,l,m),R=()=>{var N,Q,Z;const P=(e==null?void 0:e.token0.metadata)!==(e==null?void 0:e.displayToken0.metadata),_={token0:e==null?void 0:e.displayToken0,token1:e==null?void 0:e.displayToken1,amount0:P?m:l,amount1:P?l:m,fee:u(e==null?void 0:e.feeTier).div(Math.pow(10,4)).toString(),ratio:z,totalRate:H,minPrice:e==null?void 0:e.minPrice,maxPrice:e==null?void 0:e.maxPrice,displayPerText:`${(N=e==null?void 0:e.token1)==null?void 0:N.symbol} per ${(Q=e==null?void 0:e.token0)==null?void 0:Q.symbol}`,displayCurrentPrice:(e==null?void 0:e.posId)&&((Z=y==null?void 0:y[e==null?void 0:e.posId])==null?void 0:Z.currentPrice),currentPriceStatus:B};return console.log("handleOpenSecondaryModal data: ",_),_},q=async()=>{var P,_,N,Q,Z,i,p;k(!0);try{if((e==null?void 0:e.owner)!==T){console.log("POSITION ERROR"),k(!1);return}const j=(w==null?void 0:w.metadata)===((P=e==null?void 0:e.token0)==null?void 0:P.metadata);if(e!=null&&e.posId&&(e==null?void 0:e.tick_lower_index)!==void 0&&(e==null?void 0:e.tick_upper_index)!==void 0){const b=B==="active"?t:"0";let M="0",U="0";if(S)M=S!=null&&S.fix_amount_a?(_=S==null?void 0:S.coinAmountA)==null?void 0:_.toString():u((N=S==null?void 0:S.coinAmountA)==null?void 0:N.toString()).mul(u(1).add(b)).toFixed(0),U=S!=null&&S.fix_amount_a?u((Z=S==null?void 0:S.coinAmountB)==null?void 0:Z.toString()).mul(u(1).add(b)).toFixed(0):(Q=S==null?void 0:S.coinAmountB)==null?void 0:Q.toString();else{const I=ie(l,(i=e==null?void 0:e.token0)==null?void 0:i.decimals).toString(),ee=ie(m,(p=e==null?void 0:e.token1)==null?void 0:p.decimals).toString();M=u(I).gt(0)?u(I).mul(u(1).add(b)).toString():I,U=u(ee).gt(0)?u(ee).mul(u(1).add(b)).toString():ee}const W={pid:e==null?void 0:e.posId,fix_amount_a:j,offer_amount_a:M,offer_amount_b:U};console.log("handleSubmitAdd params: ",W);const E=n(W);console.log("handleSubmitAdd payload: ",E);const D=(e==null?void 0:e.token0.metadata)!==(e==null?void 0:e.displayToken0.metadata),Y=await r([E],{action:Xe.Add,description:"Add Liquidity",coinA:{...e==null?void 0:e.displayToken0,amount:D?m:l},coinB:{...e==null?void 0:e.displayToken1,amount:D?l:m}});k(!1),s(),console.log("handleSubmitAdd response: ",Y),h(""),d("")}}catch(j){console.log("handleSubmitAdd error: ",j),k(!1)}},{isDisabled:X,submitBtnText:K}=_t(g,e==null?void 0:e.token0,e==null?void 0:e.token1,B,l,m,v,c,!0);return{handleAddToken0ValueChange:$,handleAddToken1ValueChange:V,fixedToken:w,totalRate:H,getSecondaryModalData:R,handleSubmitAdd:q,addToken0Balance:v,addToken1Balance:c,isDisabled:X,submitBtnText:K}}function Ut(){var V,H;const T=_e(),{onboard:s}=Ce(),{positionInfo:t,addToken0Value:o,addToken1Value:n,increaseSubmitLoading:r,posStatus:l}=ce(),{handleAddToken0ValueChange:m,handleAddToken1ValueChange:d,fixedToken:h,totalRate:e,getSecondaryModalData:y,handleSubmitAdd:B,addToken0Balance:S,addToken1Balance:L,isDisabled:z,submitBtnText:g}=qt(),[k,w]=x.useState(!1),[A,v]=x.useState(),c=()=>{if(!T){s();return}const R=y();console.log("handleOpenSecondaryModal data: ",R),v(R),w(!0)},$=x.useMemo(()=>{var R,q;return t?((R=t==null?void 0:t.token0)==null?void 0:R.metadata)===((q=t==null?void 0:t.displayToken0)==null?void 0:q.metadata):!0},[t]);return a.jsxs(G,{children:[a.jsxs(ae,{gap:"0px",w:"100%",mt:"16px",flexDirection:$?"column":"column-reverse",children:[a.jsxs(G,{position:"relative",w:"100%",children:[l&&l===((V=t==null?void 0:t.token0)==null?void 0:V.metadata)?a.jsx(ve,{}):null,a.jsx(be,{currentCoin:t==null?void 0:t.token0,noArrow:!0,amount:o,balance:S,onAmountChange:m})]}),a.jsx(J,{gap:"0px",h:"8px",zIndex:"98",children:a.jsx("div",{className:"exchange liquidity-add position-img"})}),a.jsxs(G,{position:"relative",w:"100%",children:[l&&l===((H=t==null?void 0:t.token1)==null?void 0:H.metadata)?a.jsx(ve,{}):null,a.jsx(be,{currentCoin:t==null?void 0:t.token1,noArrow:!0,amount:n,balance:L,onAmountChange:d})]})]}),a.jsx(pe,{mt:"16px",w:"100%",size:"lg",onClick:c,isLoading:r,isDisabled:z,children:g}),a.jsx(At,{data:A,isOpen:k,onClose:()=>{w(!1)},onClick:()=>{B(),w(!1)}})]})}function Yt(T){var z,g,k,w,A,v,c,$,V,H,R,q,X,K,P,_,N,Q,Z;const{isOpen:s,onClose:t,onClick:o,data:n}=T;console.log({data:n});const r=((z=n==null?void 0:n.token0)==null?void 0:z.metadata)!==((g=n==null?void 0:n.fees)==null?void 0:g.token0.metadata),l=r?((k=n==null?void 0:n.fees)==null?void 0:k.fee1)||0:((w=n==null?void 0:n.fees)==null?void 0:w.fee0)||0,m=r?((A=n==null?void 0:n.fees)==null?void 0:A.fee0)||0:((v=n==null?void 0:n.fees)==null?void 0:v.fee1)||0,d=u(l).gt(0),h=u(m||0).gt(0),e=d||h,y=(c=n==null?void 0:n.rewards)==null?void 0:c.filter(i=>u(i.amount||0).greaterThan(0)),B=y&&y.length>0;let S;e&&B?S="You will alse collect fees and rewards earned from this position":e?S="You will alse collect fees earned from this position":B&&(S="You will alse collect rewards earned from this position");const{isImportToken:L}=Re();return a.jsxs(nt,{isOpen:s,onClose:t,isCentered:!0,children:[a.jsx(rt,{}),a.jsxs(lt,{children:[a.jsx(ct,{children:"Remove Liquidity"}),a.jsx(ot,{}),a.jsx(dt,{pb:"16px",children:a.jsxs(ae,{w:"100%",alignItems:"start",children:[a.jsxs(Se,{w:"100%",gap:"20px",children:[a.jsx(ke,{leftText:`${n==null?void 0:n.amount0} ${($=n==null?void 0:n.token0)==null?void 0:$.symbol}`,icon:(V=n==null?void 0:n.token0)==null?void 0:V.image,isImportToken:L((H=n==null?void 0:n.token0)==null?void 0:H.metadata)}),a.jsx(ke,{leftText:`${n==null?void 0:n.amount1} ${(R=n==null?void 0:n.token1)==null?void 0:R.symbol}`,icon:(q=n==null?void 0:n.token1)==null?void 0:q.image,isImportToken:L((X=n==null?void 0:n.token1)==null?void 0:X.metadata)})]}),S&&a.jsx(C,{mt:"30px",fontSize:"xs",children:S}),e&&B&&a.jsx(C,{mt:"6px",fontSize:"xs",children:"Fees"}),e&&a.jsxs(Se,{w:"100%",gap:"20px",mt:"4px",children:[d&&a.jsx(ke,{leftText:`${l} ${(K=n==null?void 0:n.token0)==null?void 0:K.symbol}`,icon:(P=n==null?void 0:n.token0)==null?void 0:P.image,isImportToken:L((_=n==null?void 0:n.token0)==null?void 0:_.metadata)}),h&&a.jsx(ke,{leftText:`${m} ${(N=n==null?void 0:n.token1)==null?void 0:N.symbol}`,icon:(Q=n==null?void 0:n.token1)==null?void 0:Q.image,isImportToken:L((Z=n==null?void 0:n.token1)==null?void 0:Z.metadata)})]}),e&&B&&a.jsx(C,{mt:"6px",fontSize:"xs",children:"Rewards"}),y&&a.jsx(Se,{w:"100%",gap:"20px",children:y.map(i=>{var p,j,b;return a.jsx(ke,{leftText:`${i==null?void 0:i.amount} ${(p=i==null?void 0:i.token)==null?void 0:p.symbol}`,icon:(j=i==null?void 0:i.token)==null?void 0:j.image},(b=i==null?void 0:i.token)==null?void 0:b.symbol)})}),a.jsx(pe,{w:"100%",mt:"20px",size:"lg",onClick:o,children:"Remove"})]})})]})]})}function ke(T){const{leftText:s,icon:t,isImportToken:o}=T;return a.jsxs(f,{justifyContent:"space-between",children:[a.jsx(C,{fontSize:"xl",color:"text_caption",children:s}),a.jsx(we,{width:"32px",height:"32px",imageUrl:t,showTag:o})]})}function Xt(){const T=_e(),s=$e(),{refreshPositionData:t}=Ge(),{slippage:o}=fe(),{getRemoveLiquidityPaylaod:n}=qe(),{signAndExecuteTransaction:r}=Ue(),{removeToken0Value:l,removeToken1Value:m,setRemoveToken0Value:d,setRemoveToken1Value:h,positionInfo:e,liquidityPriceObj:y,setPrecomputationAdd:B,removeSubmitLoading:S,setRemoveSubmitLoading:L,setRemovePercentage:z,removePercentage:g,positionFeeObj:k,posRewardsObj:w,removePercentageNoFormat:A,positionLoading:v}=ce(),c=x.useMemo(()=>{var U,W,E;if(!(e!=null&&e.posId))return;const i=new ge(e==null?void 0:e.liquidity),p=new ge((e==null?void 0:e.posId)&&((U=y==null?void 0:y[e==null?void 0:e.posId])==null?void 0:U.currentSqrtPrice)),j=ze.tickIndexToSqrtPriceX64(e==null?void 0:e.tick_lower_index),b=ze.tickIndexToSqrtPriceX64(e==null?void 0:e.tick_upper_index);console.log("coinAmount liquidity: ",i),console.log("coinAmount sqrtPriceX98: ",p),console.log("coinAmount lowerSqrtPrice: ",j),console.log("coinAmount upperSqrtPrice: ",b);const M=Ye.getCoinAmountFromLiquidity(i,p,j,b,!1);return console.log("coinAmount amount: ",M),{coinA:xe(M.coinA,(W=e==null?void 0:e.token0)==null?void 0:W.decimals),coinB:xe(M.coinB,(E=e==null?void 0:e.token1)==null?void 0:E.decimals)}},[e,y]);x.useState();const $=x.useMemo(()=>c==null?void 0:c.coinA,[c]),V=x.useMemo(()=>c==null?void 0:c.coinB,[c]),R=$t((i,p)=>{var j,b,M,U,W,E,D,Y,I,ee,se,ne;if(p){if(c!=null&&c.coinA)if(u((j=c==null?void 0:c.coinA)==null?void 0:j.toString()).eq(0))u(i).eq(0)&&(h(de((b=c==null?void 0:c.coinB)==null?void 0:b.toString(),(M=e==null?void 0:e.token1)==null?void 0:M.decimals,!0).toString()),z(100,100));else{const O=u(i).div((U=c==null?void 0:c.coinA)==null?void 0:U.toString()),re=u((W=c==null?void 0:c.coinB)==null?void 0:W.toString()).mul(O).toString();h(de(re,(E=e==null?void 0:e.token1)==null?void 0:E.decimals,!0).toString()),z(Number(u(de(O.toString(),4)).mul(100).toString()),u(O).mul(100).toNumber())}}else if(c!=null&&c.coinB)if(u((D=c==null?void 0:c.coinB)==null?void 0:D.toString()).eq(0))u(i).eq(0)&&(h(de((Y=c==null?void 0:c.coinA)==null?void 0:Y.toString(),(I=e==null?void 0:e.token0)==null?void 0:I.decimals,!0).toString()),z(100,100));else{const O=u(i).div((ee=c==null?void 0:c.coinB)==null?void 0:ee.toString()),re=u((se=c==null?void 0:c.coinA)==null?void 0:se.toString()).mul(O).toString();d(de(re,(ne=e==null?void 0:e.token0)==null?void 0:ne.decimals,!0).toString()),z(Number(u(de(O.toString(),4)).mul(100).toString()),u(O).mul(100).toNumber())}},100),q=i=>{var p;((p=e==null?void 0:e.owner)==null?void 0:p.length)!==0&&(console.log("handleRemoveToken0ValueChange value: ",i),console.log("handleRemoveToken0ValueChange positionInfo?.token0: ",e==null?void 0:e.token0),d(i),R(i,!0))},X=i=>{var p;((p=e==null?void 0:e.owner)==null?void 0:p.length)!==0&&(console.log("handleAddToken1ValueChange value: ",i),console.log("handleAddToken1ValueChange positionInfo?.token1: ",e==null?void 0:e.token1),h(i),R(i,!1))},K=i=>{var b,M,U,W,E,D,Y;if(((b=e==null?void 0:e.owner)==null?void 0:b.length)===0)return;const p=u((M=c==null?void 0:c.coinA)==null?void 0:M.toString()).mul((U=u(i))==null?void 0:U.div(100)).toString(),j=u((W=c==null?void 0:c.coinB)==null?void 0:W.toString()).mul((E=u(i))==null?void 0:E.div(100)).toString();console.log("useRemove 设置默认值 amoutnA: ",p),console.log("useRemove 设置默认值 amoutnB: ",j),d(de(p,(D=e==null?void 0:e.token0)==null?void 0:D.decimals,!0).toString()),h(de(j,(Y=e==null?void 0:e.token1)==null?void 0:Y.decimals,!0).toString())};x.useEffect(()=>{var i,p;console.log("useRemove coinAmount: ",(i=c==null?void 0:c.coinA)==null?void 0:i.toString(),"--",(p=c==null?void 0:c.coinB)==null?void 0:p.toString()),c&&K(A)},[c]);const P=i=>{let p;typeof i=="string"?i==="MAX"?p=100:p=Number(i.split("%")[0]):p=i,z(p,p),K(p),console.log("handlePercentChange value: ",i)},_=()=>{var j;const i=(e==null?void 0:e.token0.metadata)!==(e==null?void 0:e.displayToken0.metadata),p={token0:e==null?void 0:e.displayToken0,token1:e==null?void 0:e.displayToken1,amount0:i?m:l,amount1:i?l:m,fees:e!=null&&e.posId&&g===100?k[e==null?void 0:e.posId]:void 0,rewards:e!=null&&e.posId&&g===100?(j=w[e==null?void 0:e.posId])==null?void 0:j.rewards:void 0};return console.log("handleOpenSecondaryModal data: ",p),p},N=async()=>{var i,p,j,b;L(!0),console.log("handleSubmitRemove positionInfo: ",e),console.log("handleSubmitRemove removePercentage: ",g),console.log("handleSubmitRemove coinAmount: ",c);try{if(e!=null&&e.posId&&(e!=null&&e.liquidity)){const M=g===100,U=M?e==null?void 0:e.liquidity:he(u(A).div(100).mul(e==null?void 0:e.liquidity).toString(),0);console.log("handleSubmitRemove slippage: ",o);let W,E,D;if(M&&c){E=c.coinA,D=c.coinB;const se=u(ie(E,(i=e==null?void 0:e.token0)==null?void 0:i.decimals).toString()).mul(u(1).minus(o)).toString(),ne=u(ie(D,(p=e==null?void 0:e.token1)==null?void 0:p.decimals).toString()).mul(u(1).minus(o)).toString();W={pid:e==null?void 0:e.posId,min_amount_a:String(he(se,0)),min_amount_b:String(he(ne,0)),delta_liquidity:U,is_collect_fee:!!M,is_collect_reward:!!M}}else{E=l,D=m;const se=u(ie(E,(j=e==null?void 0:e.token0)==null?void 0:j.decimals).toString()).mul(u(1).minus(o)).toString(),ne=u(ie(D,(b=e==null?void 0:e.token1)==null?void 0:b.decimals).toString()).mul(u(1).minus(o)).toString();W={pid:e==null?void 0:e.posId,min_amount_a:String(he(se,0)),min_amount_b:String(he(ne,0)),delta_liquidity:U}}console.log("handleSubmitRemove params: ",W);const Y=n(W);console.log("handleSubmitRemove payload: ",Y);const I=(e==null?void 0:e.token0.metadata)!==(e==null?void 0:e.displayToken0.metadata),ee=await r([Y],{action:Xe.Remove,description:"Remove Liquidity",coinA:{...e==null?void 0:e.displayToken0,amount:I?D:E},coinB:{...e==null?void 0:e.displayToken1,amount:I?E:D}});L(!1),console.log("handleSubmitRemove response: ",ee),M&&ee.isSuccess?s("/pools/position"):t()}}catch(M){console.log("handleSubmitRemove error: ",M),L(!1)}},Q=x.useMemo(()=>S?!0:T?!!(u($).lt(l||0)||u(V).lt(m||0)||!Number(l)&&!Number(m)):!1,[S,l,m,$,V,T]),Z=x.useMemo(()=>T?"Remove":"Connect Wallet",[S,l,m,$,V,T]);return{handleRemoveToken0ValueChange:q,handleRemoveToken1ValueChange:X,handlePercentChange:P,getSecondaryModalData:_,handleSubmitRemove:N,removeToken0Balance:$,removeToken1Balance:V,isDisabled:Q,submitBtnText:Z}}function Ft(){var R,q;const T=_e(),{onboard:s}=Ce(),{positionInfo:t,removeToken0Value:o,removeToken1Value:n,removePercentage:r,removePercentageNoFormat:l,removeSubmitLoading:m,posStatus:d}=ce(),{handleRemoveToken0ValueChange:h,handleRemoveToken1ValueChange:e,handlePercentChange:y,getSecondaryModalData:B,handleSubmitRemove:S,removeToken0Balance:L,removeToken1Balance:z,isDisabled:g,submitBtnText:k}=Xt(),[w,A]=x.useState(!1),[v,c]=x.useState(),$=()=>{if(!T){s();return}const X=B();console.log("handleOpenSecondaryModal data: ",X),c(X),A(!0)},V=x.useMemo(()=>l<.1&&l>0?"<0.1":l<=100?r:"--",[l]),H=x.useMemo(()=>{var X,K;return t?((X=t==null?void 0:t.token0)==null?void 0:X.metadata)===((K=t==null?void 0:t.displayToken0)==null?void 0:K.metadata):!0},[t]);return a.jsxs(G,{children:[a.jsx(C,{mt:"30px",sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:"Amount of liquidity to remove"}),a.jsx(Jt,{percentage:V,onChange:y}),a.jsxs(ae,{gap:"0px",w:"100%",mt:"16px",flexDirection:H?"column":"column-reverse",children:[a.jsxs(G,{position:"relative",w:"100%",children:[d&&d===((R=t==null?void 0:t.token0)==null?void 0:R.metadata)?a.jsx(ve,{isRemove:!0}):null,a.jsx(be,{textIsAvailable:!0,currentCoin:t==null?void 0:t.token0,noArrow:!0,amount:o,balance:L,onAmountChange:h})]}),a.jsx(J,{gap:"0px",h:"8px",zIndex:98,children:a.jsx("div",{className:"exchange liquidity-add position-img"})}),a.jsxs(G,{position:"relative",w:"100%",children:[d&&d===((q=t==null?void 0:t.token1)==null?void 0:q.metadata)?a.jsx(ve,{isRemove:!0}):null,a.jsx(be,{textIsAvailable:!0,currentCoin:t==null?void 0:t.token1,noArrow:!0,amount:n,balance:z,onAmountChange:e})]})]}),a.jsx(pe,{mt:"16px",w:"100%",size:"lg",onClick:$,isLoading:m,isDisabled:g,children:k}),w&&a.jsx(Yt,{data:v,isOpen:w,onClose:()=>{A(!1)},onClick:()=>{S(),A(!1)}})]})}function Jt(T){const{percentage:s,onChange:t}=T,{windowWidth:o}=Le(),n=x.useMemo(()=>s!==100?`${s}%`:"MAX",[s]);return a.jsxs(G,{mt:"20px",children:[a.jsxs(it,{"aria-label":"slider-ex-1",min:0,max:100,focusThumbOnChange:!1,value:Number(s),onChange:t,children:[a.jsx(ut,{children:a.jsx(xt,{})}),a.jsx(mt,{})]}),a.jsxs(f,{justifyContent:"space-between",mt:"12px",children:[a.jsxs(C,{fontSize:"md",color:"text_caption",children:[s,"%"]}),a.jsx(gt,{w:o>810?"80px":"60px",h:"32px",options:["25%","50%","75%","MAX"],value:n,onChange:t})]})]})}function Gt(T){const{tab:s,onClickTab:t}=T;return console.log(s,"tabq313"),a.jsxs(G,{w:"100%",borderRadius:"16px",backgroundColor:"card_bg",padding:"16px",children:[a.jsx(Fe,{w:"50%",h:"56px",p:"8px",borderRadius:"12px",currentTab:s=="increase"||!s?"Increase":"Remove",textList:["Increase","Remove"],onClick:o=>t(o)}),!s||s==="increase"?a.jsx(Ut,{}):a.jsx(Ft,{})]})}function Kt(T){var Q,Z,i,p;const{tab:s}=T,{positionInfo:t,liquidityPriceObj:o,addToken0Value:n,addToken1Value:r,removeToken0Value:l,removeToken1Value:m,removePercentageNoFormat:d}=ce(),{getRate:h}=Dt(),{hasFee:e,hasRewards:y}=Je(),[B,S]=x.useState(""),[L,z]=x.useState(""),g=(t==null?void 0:t.displayToken0.metadata)!==(t==null?void 0:t.token0.metadata);x.useEffect(()=>{var j,b;t!=null&&t.posId&&(o!=null&&o[t==null?void 0:t.posId])&&(S((j=o==null?void 0:o[t==null?void 0:t.posId])==null?void 0:j.coinAmount0),z((b=o==null?void 0:o[t==null?void 0:t.posId])==null?void 0:b.coinAmount1))},[t,o]);const[k,w]=x.useState(""),[A,v]=x.useState(""),[c,$]=x.useState(""),V=x.useMemo(()=>s==="increase"?n.length>0||r.length>0:d<=100&&d>0,[s,n,r,d]);x.useEffect(()=>{var U,W,E,D,Y,I,ee,se,ne,O,re,oe;let j="",b="";s==="increase"?((U=t==null?void 0:t.token0)!=null&&U.metadata&&n?(console.log("position action result positionInfo: ",t),console.log("position action result addToken0Value: ",n),console.log("position action result addToken1Value: ",r),j=String(h(n,(W=t==null?void 0:t.token0)==null?void 0:W.metadata,4,!0))||"",w(`${te(n)} ${(E=t==null?void 0:t.token0)==null?void 0:E.symbol} / ${F(j,2)}`),console.log("position action result rateA: ",j)):w("$--"),(D=t==null?void 0:t.token1)!=null&&D.metadata&&r?(b=String(h(r,(Y=t==null?void 0:t.token1)==null?void 0:Y.metadata,4,!0))||"",v(`${te(r)} ${(I=t==null?void 0:t.token1)==null?void 0:I.symbol} / ${F(b,2)}`),console.log("position action result rateB: ",b)):v("$--")):((ee=t==null?void 0:t.token0)!=null&&ee.metadata&&l?(j=String(h(l,(se=t==null?void 0:t.token0)==null?void 0:se.metadata,4,!0))||"",w(`${te(l)} ${(ne=t==null?void 0:t.token0)==null?void 0:ne.symbol} / ${F(j,2)}`)):w("$--"),(O=t==null?void 0:t.token1)!=null&&O.metadata&&m?(b=String(h(m,(re=t==null?void 0:t.token1)==null?void 0:re.metadata,4,!0))||"",v(`${te(m)} ${(oe=t==null?void 0:t.token1)==null?void 0:oe.symbol} / ${F(b,2)}`)):v("$--"));const M=j==="--"||b==="--"?"--":F(u(j).add(b||0).toString(),2);$(M)},[t,n,r,l,m,s]);const[H,R]=x.useState(""),[q,X]=x.useState(""),[K,P]=x.useState(""),_=x.useMemo(()=>d===100,[d]);if(x.useEffect(()=>{var j,b,M,U,W,E,D,Y,I,ee,se,ne;if(s==="increase"){if((j=t==null?void 0:t.token0)!=null&&j.decimals&&((b=t==null?void 0:t.token1)!=null&&b.decimals)){const O=u(B).add(n||0).toString(),re=u(L).add(r||0).toString(),oe=h(O,(M=t==null?void 0:t.token0)==null?void 0:M.metadata,4,!0),ue=h(re,(U=t==null?void 0:t.token1)==null?void 0:U.metadata,4,!0),Ae=oe==="--"||ue==="--"?"--":u(oe).add(ue).toString();P(F(Ae,2)),R(`${te(O)} ${(W=t==null?void 0:t.token0)==null?void 0:W.symbol} / ${F(oe,2)}`),X(`${te(re)} ${(E=t==null?void 0:t.token1)==null?void 0:E.symbol} / ${F(ue,2)}`)}}else if((D=t==null?void 0:t.token0)!=null&&D.decimals&&((Y=t==null?void 0:t.token1)!=null&&Y.decimals)){const O=_?"0":u(B).minus(l||0).toString(),re=_?"0":u(L).minus(m||0).toString(),oe=h(O,(I=t==null?void 0:t.token0)==null?void 0:I.metadata,4,!0),ue=h(re,(ee=t==null?void 0:t.token1)==null?void 0:ee.metadata,4,!0),Ae=oe==="--"||ue==="--"?"--":u(oe).add(ue).toString();P(F(Ae,2)),R(`${te(O)} ${(se=t==null?void 0:t.token0)==null?void 0:se.symbol} / ${F(oe,2)}`),X(`${te(re)} ${(ne=t==null?void 0:t.token1)==null?void 0:ne.symbol} / ${F(ue,2)}`)}},[t,B,L,n,r,l,m,_,s]),!V)return null;const N=()=>e&&y?"You will also claim fees and rewards earned from this position.":e?"You will also claim fees  earned from this position.":y?"You will also claim  rewards earned from this position.":"";return a.jsxs(J,{w:"100%",direction:"column",position:"relative",borderRadius:"16px",backgroundColor:"card_bg",padding:"16px",children:[a.jsx(C,{fontSize:"md",color:"text_caption",children:"Your Actions"}),a.jsxs(Se,{gap:"10px",mt:"16px",children:[a.jsx(me,{label:s==="increase"?"Your Deposit":"Your Withdraw",value:`${c}`,isResultItem:!1}),a.jsx(me,{label:(Q=t==null?void 0:t.displayToken0)==null?void 0:Q.symbol,value:g?A:k,isResultItem:!1}),a.jsx(me,{label:(Z=t==null?void 0:t.displayToken1)==null?void 0:Z.symbol,value:g?k:A,isResultItem:!1})]}),a.jsx(Te,{position:"absolute",left:"50%",mt:"120px",xlinkHref:"#icon-icon_lead",cursor:"pointer",transform:"rotate(90deg)"}),a.jsxs(Se,{gap:"10px",mt:"16px",borderRadius:"16px",bg:"button_ghost_bg",pl:"8px",pr:"8px",pt:"20px",pb:"20px",children:[a.jsx(me,{label:"New Liquidity Amount",value:`${K}`}),a.jsx(me,{label:(i=t==null?void 0:t.displayToken0)==null?void 0:i.symbol,value:g?q:H}),a.jsx(me,{label:(p=t==null?void 0:t.displayToken1)==null?void 0:p.symbol,value:g?H:q})]}),s!=="increase"&&_&&(e||y)&&a.jsxs(f,{borderRadius:"8px",bg:"bg_secondary",mt:"20px",pt:"10px",pb:"10px",pl:"16px",pr:"16px",children:[a.jsx(Te,{xlinkHref:"#icon-icon_tips",variant:"grayprimary"}),a.jsx(C,{fontSize:"xs",children:N()})]})]})}function me(T){const{label:s,value:t,isResultItem:o=!0}=T;return a.jsxs(f,{justifyContent:"space-between",children:[a.jsx(C,{fontSize:"xs",children:s}),a.jsx(C,{fontSize:"xs",color:o?"text_highlight":"text_caption",children:t})]})}function Qt(T){var r,l,m;const{poolInfo:s}=T,{positionInfo:t,liquidityPriceObj:o}=ce(),n=x.useMemo(()=>{var d;if(o&&(t!=null&&t.posId)&&(o!=null&&o[t==null?void 0:t.posId]))return(d=o==null?void 0:o[t==null?void 0:t.posId])==null?void 0:d.currentPrice},[t,o]);return s===void 0?a.jsx(ye,{type:"nodata"}):a.jsxs(ae,{w:"100%",borderRadius:"16px",backgroundColor:"card_bg",padding:"16px",gap:4,alignItems:"space-between",children:[a.jsxs(f,{w:"100%",justifyContent:"space-between",sx:{"@media screen and (max-width: 810px)":{display:"flex",flexDirection:"column",alignItems:"flex-start"}},children:[a.jsx(C,{sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:"Current Price"}),a.jsx(G,{children:a.jsx(Vt,{fromToken:s==null?void 0:s.displayToken0,toToken:s==null?void 0:s.displayToken1,fromValue:"1",toValue:n,isLoading:!n,fontSize:"xs"})})]}),a.jsx(je,{label:"APR(24h)",value:ht(s!=null&&s.totalApr?u(s.totalApr).mul(100).toString():void 0)}),a.jsx(je,{label:"TVL(Total Value Locked)",value:F((r=s==null?void 0:s.pureTvlUSD)==null?void 0:r.now,2)}),a.jsx(je,{label:"Volume(24h)",value:F((l=s==null?void 0:s.volUSD)==null?void 0:l.day,2)}),a.jsx(je,{label:"Fees(24h)",value:F((m=s==null?void 0:s.feesUSD)==null?void 0:m.day,2)})]})}function je(T){const{label:s,value:t}=T;return a.jsxs(f,{justifyContent:"space-between",children:[a.jsx(C,{sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:s}),a.jsx(C,{color:"text_caption",sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:t})]})}function Zt(){const{tokensObj:T}=kt(),{positionInfo:s}=ce(),t=St(Tt),[o,n]=x.useState([]),[r,l]=x.useState(!1),{isImportToken:m}=Re();x.useEffect(()=>{s!=null&&s.posId&&d(s==null?void 0:s.posId)},[s==null?void 0:s.posId]);const d=async h=>{l(!0);try{const e=new URLSearchParams;e.append("position_addr",h);const y=(s==null?void 0:s.displayToken0.metadata)!==(s==null?void 0:s.token0.metadata),S=await(await fetch(`${t}?${e.toString()}`)).json();if(console.log("fetchHistoryData: ",S),S&&S.data&&S.data.list){const L=[],{package_id:z}=wt.clmmPool,g=`${z.toLocaleLowerCase()}::pool::RemoveLiquidityEvent`,k=`${z.toLocaleLowerCase()}::pool::CollectFeeEvent`,w=`${z.toLocaleLowerCase()}::pool::AddLiquidityEvent`;S.data.list.forEach(A=>{const v=JSON.parse(A.event_data),c={event_type:"Remove Liquidity",block_time:v.block_time,tx:v.tx,sender:v.sender,position_addr:v.PositionAddr,pool_addr:v.PoolAddr,coin_change:[]};switch(A.event_type){case g:case k:case w:let $="";A.event_type===g?(c.event_type="Remove Liquidity",$=""):A.event_type===k?(c.event_type="Claim Fees",$=""):A.event_type===w&&(c.event_type="Add Liquidity",$=""),u(v.AmountA).gt(0)&&c.coin_change.push({amount:`${$}${te(xe(new ge(v.AmountA),s==null?void 0:s.token0.decimals))} ${s==null?void 0:s.token0.symbol}`,image:(s==null?void 0:s.token0.image)||"",isImportToken:m(s==null?void 0:s.token0.metadata)}),u(v.AmountB).gt(0)&&c.coin_change.push({amount:`${$}${te(xe(new ge(v.AmountB),s==null?void 0:s.token1.decimals))} ${s==null?void 0:s.token1.symbol}`,image:(s==null?void 0:s.token1.image)||"",isImportToken:m(s==null?void 0:s.token1.metadata)}),c.coin_change.length>0&&(y&&(c.coin_change=c.coin_change.reverse()),L.push(c));break;case`${z.toLocaleLowerCase()}::pool::CollectRewardEvent`:c.event_type="Claim Rewards",JSON.parse(v.RewardAmounts).forEach(V=>{const H=V.value;if(u(H).greaterThan(0)){const R=T[V.key];R&&c.coin_change.push({amount:`${te(xe(new ge(H),R.decimals))} ${R.symbol}`,image:R.image||""})}}),c.coin_change.length>0&&L.push(c);break;default:break}}),n(L)}else n([]);l(!1)}catch(e){console.log(e,"fetchHistoryData"),l(!1)}};return{loading:r,dataList:o,fetchHistoryData:d}}function Ot(T){const{id:s,pid:t,tab:o}=T;$e();const{windowWidth:n}=Le(),{address:r}=Ce(),[l,m]=x.useState("History"),{positionInfo:d,positionLoading:h,currentPoolInfo:e,setCurrentPoolInfo:y,setCurrentPositionTab:B,setRemovePercentage:S}=ce(),{loading:L,dataList:z,fetchHistoryData:g}=Zt(),{getPositionInfoData:k,getCurrentPoolInfo:w}=Ke();x.useEffect(()=>{w(!1)},[d==null?void 0:d.pool_address]),x.useEffect(()=>{S(50,50)},[]);const A=()=>{r&&s&&t&&(k(s,t),l==="Pools Stats"?w(!0):g(t))},v=c=>a.jsxs(G,{children:[a.jsx(Fe,{w:"50%",h:"56px",p:"8px",borderRadius:"16px",currentTab:l,textList:["History","Pools Stats"],onClick:$=>{m($)}}),a.jsx(G,{h:"10px"}),l==="History"&&a.jsx(Nt,{loading:L,dataList:z,windowWidth:c}),l==="Pools Stats"&&a.jsx(Qt,{poolInfo:e})]});return a.jsxs(J,{w:"100%",h:"100%",direction:"column",position:"relative",children:[a.jsx(yt,{}),a.jsx(zt,{handleRefreshClick:A}),a.jsxs(J,{gap:"16px",mt:"24px",sx:{"@media screen and (max-width: 810px)":{flexDirection:"column"}},children:[a.jsxs(J,{gap:"16px",w:"60%",minW:"580px",flexDirection:"column",sx:{"@media screen and (max-width: 810px)":{w:"100%",minW:"unset"}},children:[a.jsx(Et,{pid:t}),a.jsx(Pt,{}),n>810&&v(n)]}),a.jsxs(J,{w:"40%",gap:"16px",minW:"420px",flexDirection:"column",sx:{"@media screen and (max-width: 810px)":{w:"100%",minW:"unset"}},children:[a.jsx(Gt,{tab:o,onClickTab:c=>{B(c=="Increase"?"increase":"remove")}}),a.jsx(Kt,{tab:o})]})]}),n<=810&&a.jsx(G,{mt:"16px",children:v(n)}),h&&a.jsx(pt,{w:"100%",h:"100%",position:"absolute",left:"0px",top:"0px",bg:"background",opacity:"0.4",children:a.jsx(jt,{w:"80px",h:"80px",color:"primary",thickness:"4px"})})]})}function xa(){const T=$e(),{positionObj:s,positionInfo:t,setPositionInfo:o,setPositionLoading:n,positionLoading:r,currentPositionTab:l,clearAllData:m}=ce(),{getPositionInfoData:d}=Ke();x.useEffect(()=>{window.scrollTo(0,0)},[]);const{id:h,pid:e}=Ne();x.useEffect(()=>{e&&(s!=null&&s[e])&&(o(s==null?void 0:s[e]),n(!1))},[e,s]),x.useEffect(()=>{h&&e&&d(h,e)},[h,e]),x.useEffect(()=>()=>{m()},[]);const y=()=>{if(h&&e&&l)return a.jsx(Ot,{tab:l,id:h,pid:e});T("/pools/position")},B=x.useMemo(()=>e&&h?!r&&e&&h&&!t:!1,[r,e,h,t]);return a.jsxs(G,{w:"100%",maxW:"100%",p:"10px 0px 0px",boxSizing:"content-box",children:[B&&a.jsx(G,{children:a.jsx(ye,{text:"Position unavailable",type:"nodata",h:"330px",child:a.jsx(pe,{borderRadius:"8px",mt:"10px",w:"120px",h:"28px",fontSize:"xs",onClick:()=>{T("/pools/pool")},children:"Back to Pool"})})}),!B&&y()]})}export{xa as default};
