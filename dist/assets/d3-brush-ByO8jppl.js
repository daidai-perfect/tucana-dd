import{i as ft}from"./d3-transition-M3J8yfEs.js";import{d as At}from"./d3-dispatch-kxCwF96_.js";import{s as W,p as ht}from"./d3-selection-DSeOx27A.js";import{i as zt}from"./d3-interpolate-m1gjL8b6.js";import{d as Dt,y as Mt}from"./d3-drag-_qOI58SM.js";const et=e=>()=>e;function Tt(e,{sourceEvent:A,target:I,selection:R,mode:X,dispatch:S}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:A,enumerable:!0,configurable:!0},target:{value:I,enumerable:!0,configurable:!0},selection:{value:R,enumerable:!0,configurable:!0},mode:{value:X,enumerable:!0,configurable:!0},_:{value:S}})}function Xt(e){e.stopImmediatePropagation()}function nt(e){e.preventDefault(),e.stopImmediatePropagation()}var pt={name:"drag"},rt={name:"space"},B={name:"handle"},G={name:"center"};const{abs:mt,max:k,min:_}=Math;function dt(e){return[+e[0],+e[1]]}function bt(e){return[dt(e[0]),dt(e[1])]}var U={name:"x",handles:["w","e"].map($),input:function(e,A){return e==null?null:[[+e[0],A[0][1]],[+e[1],A[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},Z={name:"y",handles:["n","s"].map($),input:function(e,A){return e==null?null:[[A[0][0],+e[0]],[A[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},T={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},yt={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},gt={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Yt={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Kt={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function $(e){return{type:e}}function Ot(e){return!e.ctrlKey&&!e.button}function Pt(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function St(){return navigator.maxTouchPoints||"ontouchstart"in this}function it(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function Ct(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function Rt(){return wt(U)}function jt(){return wt(Z)}function wt(e){var A=Pt,I=Ot,R=St,X=!0,S=At("start","brush","end"),D=6,j;function p(t){var n=t.property("__brush",_t).selectAll(".overlay").data([$("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",T.overlay).merge(n).each(function(){var r=it(this).extent;W(this).attr("x",r[0][0]).attr("y",r[0][1]).attr("width",r[1][0]-r[0][0]).attr("height",r[1][1]-r[0][1])}),t.selectAll(".selection").data([$("selection")]).enter().append("rect").attr("class","selection").attr("cursor",T.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var s=t.selectAll(".handle").data(e.handles,function(r){return r.type});s.exit().remove(),s.enter().append("rect").attr("class",function(r){return"handle handle--"+r.type}).attr("cursor",function(r){return T[r.type]}),t.each(V).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",at).filter(R).on("touchstart.brush",at).on("touchmove.brush",vt).on("touchend.brush touchcancel.brush",kt).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}p.move=function(t,n,s){t.tween?t.on("start.brush",function(r){C(this,arguments).beforestart().start(r)}).on("interrupt.brush end.brush",function(r){C(this,arguments).end(r)}).tween("brush",function(){var r=this,a=r.__brush,u=C(r,arguments),E=a.selection,M=e.input(typeof n=="function"?n.apply(this,arguments):n,a.extent),l=zt(E,M);function z(o){a.selection=o===1&&M===null?null:l(o),V.call(r),u.brush()}return E!==null&&M!==null?z:z(1)}):t.each(function(){var r=this,a=arguments,u=r.__brush,E=e.input(typeof n=="function"?n.apply(r,a):n,u.extent),M=C(r,a).beforestart();ft(r),u.selection=E===null?null:E,V.call(r),M.start(s).brush(s).end(s)})},p.clear=function(t,n){p.move(t,null,n)};function V(){var t=W(this),n=it(this).selection;n?(t.selectAll(".selection").style("display",null).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1]),t.selectAll(".handle").style("display",null).attr("x",function(s){return s.type[s.type.length-1]==="e"?n[1][0]-D/2:n[0][0]-D/2}).attr("y",function(s){return s.type[0]==="s"?n[1][1]-D/2:n[0][1]-D/2}).attr("width",function(s){return s.type==="n"||s.type==="s"?n[1][0]-n[0][0]+D:D}).attr("height",function(s){return s.type==="e"||s.type==="w"?n[1][1]-n[0][1]+D:D})):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function C(t,n,s){var r=t.__brush.emitter;return r&&(!s||!r.clean)?r:new st(t,n,s)}function st(t,n,s){this.that=t,this.args=n,this.state=t.__brush,this.active=0,this.clean=s}st.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(t,n){return this.starting?(this.starting=!1,this.emit("start",t,n)):this.emit("brush",t),this},brush:function(t,n){return this.emit("brush",t,n),this},end:function(t,n){return--this.active===0&&(delete this.state.emitter,this.emit("end",t,n)),this},emit:function(t,n,s){var r=W(this.that).datum();S.call(t,this.that,new Tt(t,{sourceEvent:n,target:p,selection:e.output(this.state.selection),mode:s,dispatch:S}),r)}};function at(t){if(j&&!t.touches||!I.apply(this,arguments))return;var n=this,s=t.target.__data__.type,r=(X&&t.metaKey?s="overlay":s)==="selection"?pt:X&&t.altKey?G:B,a=e===Z?null:Yt[s],u=e===U?null:Kt[s],E=it(n),M=E.extent,l=E.selection,z=M[0][0],o,m,Y=M[0][1],d,b,K=M[1][0],y,g,O=M[1][1],w,v,c=0,f=0,tt,q=a&&u&&X&&t.shiftKey,J,Q,x=Array.from(t.touches||[t],i=>{const h=i.identifier;return i=ht(i,n),i.point0=i.slice(),i.identifier=h,i});ft(n);var F=C(n,arguments,!0).beforestart();if(s==="overlay"){l&&(tt=!0);const i=[x[0],x[1]||x[0]];E.selection=l=[[o=e===Z?z:_(i[0][0],i[1][0]),d=e===U?Y:_(i[0][1],i[1][1])],[y=e===Z?K:k(i[0][0],i[1][0]),w=e===U?O:k(i[0][1],i[1][1])]],x.length>1&&N(t)}else o=l[0][0],d=l[0][1],y=l[1][0],w=l[1][1];m=o,b=d,g=y,v=w;var ut=W(n).attr("pointer-events","none"),H=ut.selectAll(".overlay").attr("cursor",T[s]);if(t.touches)F.moved=lt,F.ended=ct;else{var ot=W(t.view).on("mousemove.brush",lt,!0).on("mouseup.brush",ct,!0);X&&ot.on("keydown.brush",Et,!0).on("keyup.brush",xt,!0),Dt(t.view)}V.call(n),F.start(t,r.name);function lt(i){for(const h of i.changedTouches||[i])for(const L of x)L.identifier===h.identifier&&(L.cur=ht(h,n));if(q&&!J&&!Q&&x.length===1){const h=x[0];mt(h.cur[0]-h[0])>mt(h.cur[1]-h[1])?Q=!0:J=!0}for(const h of x)h.cur&&(h[0]=h.cur[0],h[1]=h.cur[1]);tt=!0,nt(i),N(i)}function N(i){const h=x[0],L=h.point0;var P;switch(c=h[0]-L[0],f=h[1]-L[1],r){case rt:case pt:{a&&(c=k(z-o,_(K-y,c)),m=o+c,g=y+c),u&&(f=k(Y-d,_(O-w,f)),b=d+f,v=w+f);break}case B:{x[1]?(a&&(m=k(z,_(K,x[0][0])),g=k(z,_(K,x[1][0])),a=1),u&&(b=k(Y,_(O,x[0][1])),v=k(Y,_(O,x[1][1])),u=1)):(a<0?(c=k(z-o,_(K-o,c)),m=o+c,g=y):a>0&&(c=k(z-y,_(K-y,c)),m=o,g=y+c),u<0?(f=k(Y-d,_(O-d,f)),b=d+f,v=w):u>0&&(f=k(Y-w,_(O-w,f)),b=d,v=w+f));break}case G:{a&&(m=k(z,_(K,o-c*a)),g=k(z,_(K,y+c*a))),u&&(b=k(Y,_(O,d-f*u)),v=k(Y,_(O,w+f*u)));break}}g<m&&(a*=-1,P=o,o=y,y=P,P=m,m=g,g=P,s in yt&&H.attr("cursor",T[s=yt[s]])),v<b&&(u*=-1,P=d,d=w,w=P,P=b,b=v,v=P,s in gt&&H.attr("cursor",T[s=gt[s]])),E.selection&&(l=E.selection),J&&(m=l[0][0],g=l[1][0]),Q&&(b=l[0][1],v=l[1][1]),(l[0][0]!==m||l[0][1]!==b||l[1][0]!==g||l[1][1]!==v)&&(E.selection=[[m,b],[g,v]],V.call(n),F.brush(i,r.name))}function ct(i){if(Xt(i),i.touches){if(i.touches.length)return;j&&clearTimeout(j),j=setTimeout(function(){j=null},500)}else Mt(i.view,tt),ot.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);ut.attr("pointer-events","all"),H.attr("cursor",T.overlay),E.selection&&(l=E.selection),Ct(l)&&(E.selection=null,V.call(n)),F.end(i,r.name)}function Et(i){switch(i.keyCode){case 16:{q=a&&u;break}case 18:{r===B&&(a&&(y=g-c*a,o=m+c*a),u&&(w=v-f*u,d=b+f*u),r=G,N(i));break}case 32:{(r===B||r===G)&&(a<0?y=g-c:a>0&&(o=m-c),u<0?w=v-f:u>0&&(d=b-f),r=rt,H.attr("cursor",T.selection),N(i));break}default:return}nt(i)}function xt(i){switch(i.keyCode){case 16:{q&&(J=Q=q=!1,N(i));break}case 18:{r===G&&(a<0?y=g:a>0&&(o=m),u<0?w=v:u>0&&(d=b),r=B,N(i));break}case 32:{r===rt&&(i.altKey?(a&&(y=g-c*a,o=m+c*a),u&&(w=v-f*u,d=b+f*u),r=G):(a<0?y=g:a>0&&(o=m),u<0?w=v:u>0&&(d=b),r=B),H.attr("cursor",T[s]),N(i));break}default:return}nt(i)}}function vt(t){C(this,arguments).moved(t)}function kt(t){C(this,arguments).ended(t)}function _t(){var t=this.__brush||{selection:null};return t.extent=bt(A.apply(this,arguments)),t.dim=e,t}return p.extent=function(t){return arguments.length?(A=typeof t=="function"?t:et(bt(t)),p):A},p.filter=function(t){return arguments.length?(I=typeof t=="function"?t:et(!!t),p):I},p.touchable=function(t){return arguments.length?(R=typeof t=="function"?t:et(!!t),p):R},p.handleSize=function(t){return arguments.length?(D=+t,p):D},p.keyModifiers=function(t){return arguments.length?(X=!!t,p):X},p.on=function(){var t=S.on.apply(S,arguments);return t===S?p:t},p}export{jt as a,Rt as b};
