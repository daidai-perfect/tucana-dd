import{r as D}from"./react-CxzTU07i.js";import{b as T,a as U,u as M}from"./useApiUrl-BWcjgV84.js";import{o as N,i as J,q as V,G as Y,aq as A,f as x,h as G,ar as K,d as b}from"./App-Cb960mne.js";import"./bn.js-CjHYPH1W.js";import{o as q}from"./@tucana-network-DgPNddlX.js";import{c as H}from"./zustand--BHpADek.js";function $(o){return Object.keys(o).length===0}const z={devnet:[]},Q=H(o=>({analyticsDate:null,tokensList:[],poolsList:[],tokensListLength:0,poolsListLength:0,setAnalyticsData:a=>{o(()=>({analyticsDate:a}))},setTokensList:a=>{o(()=>({tokensList:a}))},setPoolsList:a=>{o(()=>({poolsList:a}))},setTokensListLength:a=>{o(()=>({tokensListLength:a}))},setPoolsListLength:a=>{o(()=>({poolsListLength:a}))}})),W=Q,X=(o,a,c)=>{const p=c[o],L=c[a];if(!p&&!L)return!0;if(p){if(!L)return!1}else return!0;return o>a};var Z=(o=>(o.TVL="pure_tvl",o.VOL="vol",o.APR="apr",o.Yield="Yield",o.TVL_DESC="-pure_tvl",o.VOL_DESC="-vol",o.APR_DESC="-apr",o.Yield_DESC="-Yield",o))(Z||{});function ro(){const{chain:o}=N(),a=T(U),{tokensObj:c}=J(),{setPoolsObj:p,setPoolList:L,setPoolListIsLoading:f}=V(),{setPoolsListLength:_}=W(),{getPoolListFromContract:E}=B(c);D.useEffect(()=>{console.log("usePoolList useEffect tokensObj: ",c)},[c]);const i=async(P,r)=>{var h,s,w,S,k,l;try{const e=await Y(r||a,P);if(console.log("getPoolList res: ",e),!(e!=null&&e.pairs))throw Error("api return no paris");const t=(e==null?void 0:e.pairs)||[];console.log("getPoolList data: ",t),_(e==null?void 0:e.total);const n=[];return t.forEach(y=>{n.push({...I(y),chainId:o.id})}),n}catch(e){console.log("ðŸš€ ~ file: usePoolList.ts:95 ~ fetchPoolList ~ error:",e);const t=localStorage.getItem(A);console.log("ðŸš€ ~ file: usePoolList.ts:95 ~ fetchPoolList ~ localJSON:",t);const n=t?JSON.parse(t):null;if(console.log("ðŸš€ ~ file: usePoolList.ts:95 ~ fetchPoolList ~ localData:",n),(h=n==null?void 0:n.state)!=null&&h.poolList&&((w=(s=n==null?void 0:n.state)==null?void 0:s.poolList)==null?void 0:w.length)>0&&((k=(S=n==null?void 0:n.state)==null?void 0:S.poolList[0])==null?void 0:k.chainId)===(o==null?void 0:o.id))return(l=n==null?void 0:n.state)==null?void 0:l.poolList;{const y=await E();return console.log("ðŸš€ ~ file: usePoolList.ts:108 ~ fetchPoolList ~ contractPoolList:",y),y}}},O=async(P,r)=>{var h,s,w,S,k;f(!0);try{const l=await i(P,r);console.log("usePoolList getPoolList result: ",l),L(l);const e=Object.fromEntries(l==null?void 0:l.map(t=>[t==null?void 0:t.id,t]));p(e),console.log("usePoolList getPoolList objs: ",e),f(!1)}catch(l){console.log("ðŸš€ ~ file: usePoolList.ts:127 ~ getPoolList ~ error:",l),console.log("usePoolList getPoolList error: ",l),f(!1);const e=localStorage.getItem(A);console.log("ðŸš€ ~ file: usePoolList.ts:131 ~ getPoolList ~ localJSON:",e);const t=e?JSON.parse(e):null;if(console.log("ðŸš€ ~ file: usePoolList.ts:133 ~ getPoolList ~ localData:",t),!((h=t==null?void 0:t.state)!=null&&h.poolList)||((w=(s=t==null?void 0:t.state)==null?void 0:s.poolList)==null?void 0:w.length)<1||((k=(S=t==null?void 0:t.state)==null?void 0:S.poolList[0])==null?void 0:k.chainId)!==(o==null?void 0:o.id)){const n=z[K];L(n||[]);const y=Object.fromEntries(n==null?void 0:n.map(g=>[g==null?void 0:g.id,g]));p(y)}}};return{fetchPoolList:i,getPoolList:O,refreshPoolList:()=>{O({})}}}function B(o){const{chain:a}=N(),{tucanaSpotSDK:c}=x(),{getTokenList:p,getToken:L}=M(),f=G(),_=(f==null?void 0:f.tokenPriority)||{};return{getPoolListFromContract:async()=>{var i,O;try{console.log("getPoolListFromContract tokensObj: ",o);let d;if(o&&!$(o))d=o;else{const r=await p();d=Object.fromEntries(r==null?void 0:r.map(s=>(s.isImport=!1,[s.metadata,s])))}console.log("getPoolListFromContract tokens: ",d);const P=[];if(c){const r=(await c.Pool.getPoolList()).data;if(console.log("getPoolListFromContract res: ",r),!r)return[];for(let h=0;h<(r==null?void 0:r.length);h++){const s=r[h];console.log("tokens[item?.coin_type_a]: ",d[s==null?void 0:s.coin_type_a]);const w=d[s==null?void 0:s.coin_type_a]||await L(s==null?void 0:s.coin_type_a),S=d[s==null?void 0:s.coin_type_b]||await L(s==null?void 0:s.coin_type_b),k=X(s==null?void 0:s.coin_type_a,s==null?void 0:s.coin_type_b,_),l=(i=s==null?void 0:s.rewarder_manager)==null?void 0:i.rewarders;let e=[];const t=[],n=[];(l==null?void 0:l.length)>0&&(e=l==null?void 0:l.filter(g=>b(new Date().getTime()).div(1e3).greaterThan(g.end_time)).map(g=>{var C,v,F,j;const R=!!b(g==null?void 0:g.emissions_per_second).gt(0);if(R){const u=(C=g.reward_metadata)!=null&&C.inner?d[(v=g.reward_metadata)==null?void 0:v.inner]:null;t.push({amountSecond:b(g.emissions_per_second).div(Math.pow(2,64)).div(Math.pow(10,(u==null?void 0:u.decimals)||0)).toString(),amountUsd:"",decimals:(u==null?void 0:u.decimals)||0,image:(u==null?void 0:u.image)||"",metadata:(F=g.reward_metadata)==null?void 0:F.inner,name:u==null?void 0:u.name,symbol:u==null?void 0:u.symbol}),n.push({apr:"0",metadata:(j=g.reward_metadata)==null?void 0:j.inner})}return{...s,isDisplay:R}}));const y=e.length>0;console.log("getPoolListFromContract showRewarder: ",e,t),P.push({id:s.pool_address,address:s.pool_address,token0:w,token1:S,feeTier:String(s.fee_rate),fee:b(s.fee_rate).div(Math.pow(10,6)).mul(100).toString(),tick:String(s.current_tick_index),tickManagerId:(O=s==null?void 0:s.tick_manager)==null?void 0:O.id,showRewarder:e,tickSpacing:s==null?void 0:s.tick_spacing,displayToken0:k?S:w,displayToken1:k?w:S,isReverse:k,rewarderUSD:t,showFarming:y,rewarderApr:n,chainId:a.id})}return console.log("getPoolListFromContract poolList: ",P),P}else throw Error("tucanaSpotSDK is undefined")}catch(d){return console.log("getPoolListFromContract error: ",d),[]}}}}function I(o){var p,L,f;const a=(o==null?void 0:o.isForward)===!1;let c=!1;if(!(o!=null&&o.showRewarder)||((p=o==null?void 0:o.showRewarder)==null?void 0:p.length)<1)c=!1;else{const _=(L=o==null?void 0:o.rewarderUSD)==null?void 0:L.filter(i=>Number(i==null?void 0:i.amountSecond)>0);(_==null?void 0:_.length)>0?c=!0:c=!1,((f=o==null?void 0:o.showRewarder)==null?void 0:f.filter(i=>i==null?void 0:i.isDisplay)).length>0&&_.length>0?(c=!0,o.rewarderUSD=_.filter(i=>{var P;const O=i.metadata;return((P=o==null?void 0:o.showRewarder)==null?void 0:P.filter(r=>!!((r==null?void 0:r.metadata)===O&&(r!=null&&r.isDisplay)))).length>0})):c=!1}return{...o,tick:q(BigInt(o.tick)),address:o==null?void 0:o.id,isReverse:a,displayToken0:a?o==null?void 0:o.token1:o==null?void 0:o.token0,displayToken1:a?o==null?void 0:o.token0:o==null?void 0:o.token1,showFarming:c}}export{Z as S,W as a,ro as u};
