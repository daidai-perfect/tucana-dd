import{r as x,j as a}from"./react-CxzTU07i.js";import{B as Ke}from"./BackButton-CQFe92gG.js";import{B as ue}from"./bn.js-CjHYPH1W.js";import{e as He,H as Qe,m as ge,I as Se,U as Oe,d as m,$ as F,S as Te,K as ne,J as ye,Z as Ie,al as et,o as Ne,b as tt,a0 as We,k as qe,Q as de,L as ie,F as ae,T as Ue,O as at,E as ce,a5 as he,R as rt,p as nt,A as st,M as lt,h as ot,i as ct}from"./App-Cb960mne.js";import"./numbro-DbF9-lIv.js";import{T as Ce,O as Re}from"./@initia-CP5FTFDk.js";import{f as dt,P as it,b as mt,a as xt,c as ut,g as gt}from"./PositionIncreaseModal-BhpANlAO.js";import{P as ht,R as Ye}from"./RectangularTab-scmnr4k8.js";import{S as pt,T as be}from"./SlippageSetting-ChXQQLFq.js";import{u as oe}from"./position-DDE7YBux.js";import{g as kt}from"./apiDataProcessing-DjMQcQv4.js";import{u as _e,b as St,f as Tt}from"./useApiUrl-BWcjgV84.js";import{u as Be}from"./useWindowWidth-DaYijioX.js";import{f as Xe,c as Le}from"./react-router-COZMEyo_.js";import{F as J,V as se,ao as ze,f as G,l as le,H as N,T as R,B as we,a9 as wt,aa as jt,ab as yt,j as Me,ac as Ae,i as bt,k as Pe,z as vt,A as Ct,D as Rt,E as _t,G as At,J as Pt,ap as ke,X as Bt,Y as Lt,Z as $t,_ as zt,a as Mt,S as Dt}from"./@chakra-ui-F3U2dpjw.js";import{c as Fe,d as Je,b as Ge}from"./useClaim-DXOTPVg0.js";import{T as De}from"./TableCardH5-CxOqm6xI.js";import{f as Ve,C as Ze,b as fe}from"./@tucana-network-DgPNddlX.js";import{L as ve}from"./LockMask-CVvwyGE1.js";import"./@improbable-eng-BU3rlaSz.js";import"./vite-plugin-node-polyfills-2b3IylRN.js";import"./react-router-dom-DspqRS0x.js";import"./react-dom-D0CDEAqu.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-CA71pd9M.js";import"./index-oyaI18XQ.js";import"./lodash.mergewith-0oSak3fd.js";import"./framesync-BLa_7oTh.js";import"./@emotion-Ci8Bc0jK.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./@babel-Ds7TnLC8.js";import"./stylis-YPZU7XtI.js";import"./color2k-BSHHkqKj.js";import"./framer-motion-DN1fNAS_.js";import"./react-focus-lock-CdsTnkdS.js";import"./focus-lock-C3lLyJ0E.js";import"./use-sidecar-Mnt-C9DP.js";import"./use-callback-ref-BUZizod5.js";import"./react-clientside-effect-C1WRooe2.js";import"./react-remove-scroll-XbdGFyuF.js";import"./react-remove-scroll-bar-B8WFODEn.js";import"./react-style-singleton-BMjn4bnO.js";import"./get-nonce-C-Z93AgS.js";import"./aria-hidden-DQ5UC2Eg.js";import"./@zag-js-BxxExxl0.js";import"./@popperjs-BQBsAJpH.js";import"./react-fast-compare-ZNZLWkFJ.js";import"./decimal.js-g2JQ_dxE.js";import"./dayjs-ChilDtai.js";import"./copy-to-clipboard-BEgmPfpW.js";import"./toggle-selection-BHUZwh74.js";import"./zustand--BHpADek.js";import"./cosmjs-types-HHI3LIsf.js";import"./recharts-BEhUgXe7.js";import"./clsx-B-dksMZM.js";import"./lodash-CF7ZZEzc.js";import"./react-smooth-CJ-TEnHD.js";import"./prop-types-DJYhzm_d.js";import"./fast-equals-C7I1S-bJ.js";import"./tiny-invariant-BaFNuDhB.js";import"./d3-shape-C66BBtZo.js";import"./d3-path-CimkQT29.js";import"./victory-vendor-CWG3-CEL.js";import"./d3-scale-CaKF3Vy_.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-EePf7Sik.js";import"./d3-time-format-CKRkqwF6.js";import"./d3-time-nQs4M9wC.js";import"./d3-interpolate-m1gjL8b6.js";import"./d3-color-9lF95FHy.js";import"./d3-format-CzD4bSOQ.js";import"./recharts-scale-DiOBu8nk.js";import"./decimal.js-light-B5-9uEc-.js";import"./axios-BGrCQLb0.js";import"./browser-headers-DaTTBGKg.js";import"./long-Bd8Jk2Sf.js";import"./@protobufjs-BFfFlHHM.js";import"./bignumber.js-CTO8iJYk.js";import"./jscrypto-DOxZ2vL9.js";import"./crypto-browserify-K7vti8ry.js";import"./randombytes-cxG1aiJq.js";import"./safe-buffer-B7h8REzA.js";import"./create-hash-B2etqZ4B.js";import"./inherits-BlmhoU4v.js";import"./md5.js-FaoCCiYs.js";import"./hash-base-Bol-vuw1.js";import"./events-BYvclee5.js";import"./util-mxsps8Rg.js";import"./is-arguments-CSFfgC6i.js";import"./has-tostringtag-BVm4gedm.js";import"./has-symbols-jRi3KFcs.js";import"./call-bind-B07GZeJl.js";import"./get-intrinsic-kTO65dkt.js";import"./es-errors-DzOT6E3C.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-BbkWVFrm.js";import"./hasown-DYqjtFKE.js";import"./set-function-length-DW3CJlDV.js";import"./define-data-property-BYhozZ9n.js";import"./es-define-property-BlMEMvNH.js";import"./gopd-rUakIY3f.js";import"./has-property-descriptors-B3Yvk56Z.js";import"./is-generator-function-DtmjroQB.js";import"./which-typed-array-DjIYTpty.js";import"./for-each-HDM-_-W4.js";import"./is-callable-ajMm-eR9.js";import"./available-typed-arrays-lJejVQbB.js";import"./possible-typed-array-names-ZWAIzZ1Z.js";import"./is-typed-array-BI6k7hxc.js";import"./util-deprecate-DPVjTvyT.js";import"./string_decoder-0MzJkBYb.js";import"./ripemd160-C1CpqImb.js";import"./sha.js-BDwlQsPx.js";import"./cipher-base-7AdYGBPO.js";import"./stream-browserify-BfQl1BUK.js";import"./create-hmac--QaKJlMo.js";import"./browserify-sign-GWTZlE0Z.js";import"./process-nextick-args-qzFE9GA4.js";import"./core-util-is-BRatBjl-.js";import"./browserify-rsa-CryRCbDk.js";import"./elliptic-CmlQxMT_.js";import"./minimalistic-assert-DDtZfRm3.js";import"./minimalistic-crypto-utils-BXubSNmL.js";import"./brorand-BrlY5gS_.js";import"./hash.js-itZKbfbK.js";import"./hmac-drbg-oB7aodci.js";import"./parse-asn1-DRtj1sMn.js";import"./asn1.js-BnSaV4mo.js";import"./vm-browserify-B6h6MQBh.js";import"./evp_bytestokey-Dyx8YxuJ.js";import"./browserify-aes-BUcIY7yD.js";import"./buffer-xor-De43xBeM.js";import"./pbkdf2-C-6u4RPY.js";import"./browserify-cipher-DYIcwHfU.js";import"./browserify-des-SXPfahZ7.js";import"./des.js-CDfWU-Dy.js";import"./diffie-hellman-Cjh9VIAB.js";import"./miller-rabin-D0hA1ZTO.js";import"./create-ecdh-BozzoSuA.js";import"./public-encrypt-Dmci0MFY.js";import"./randomfill-Cz20fUZ8.js";import"./keccak256-BDyJSpAN.js";import"./keccak-C1V6dJ9R.js";import"./bech32-MFBNfINK.js";import"./bs58-B7XvzY3E.js";import"./base-x-DaHpqjnx.js";import"./bip32-rT_4MDJf.js";import"./bs58check-DBgRgCjV.js";import"./tiny-secp256k1-DFomSNDX.js";import"./typeforce-Dson3yfq.js";import"./wif-Bj2Vat9l.js";import"./bip39-D04lJivS.js";import"./@noble-niMs0PSV.js";import"./secp256k1-BRtDzKq7.js";import"./ws-DLAd0t_s.js";import"./semver-DcF-0Uum.js";import"./@ledgerhq-BR4K6VrK.js";import"./usePoolList-D7LBbYQN.js";import"./useGetTokenInfo-Cwtmo1XH.js";function Vt(k){var $,o,b,P,H,B,z,X,Z,L,C;const{handleRefreshClick:s}=k;Ce(),Xe();const[t,c]=x.useState(!1),{isImportToken:r}=_e(),{positionInfo:n,liquidityPriceObj:l,positionLoading:u,setPositionLoading:d,setPositionLiquidityPriceLoading:p,setPositionFeeLoading:e,setPositionRewardsLoading:j}=oe(),{getPositionUrl:_}=He(),[T,A]=x.useState(!1),{displayMaxPrice:E,displayMinPrice:g}=dt({minPrice:n==null?void 0:n.minPrice,maxPrice:n==null?void 0:n.maxPrice,changeSide:T}),h=x.useMemo(()=>{var W;return(n==null?void 0:n.posId)&&((W=l==null?void 0:l[n==null?void 0:n.posId])==null?void 0:W.status)==="Active"||!1},[n,l]),S=()=>a.jsxs(R,{p:"6px 12px 6px 12px",borderRadius:"8px",fontSize:"xs",backgroundColor:"bg_secondary",color:"text_caption",children:[kt(n==null?void 0:n.feeTier)," fee tier"]}),{windowWidth:V}=Be();return a.jsxs(J,{w:"100%",mt:"20px",minW:"1010px",justifyContent:"space-between",sx:{"@media screen and (max-width: 810px)":{minW:"unset"}},children:[a.jsxs(se,{alignItems:"start",w:"100%",h:"80px",sx:{"@media screen and (max-width: 810px)":{h:"unset",alignItems:"flex-start",justifyContent:"flex-start"}},children:[u?a.jsxs(J,{w:"40%",h:"40px",align:"center",children:[a.jsx(ze,{size:"9",minW:"36px"}),a.jsx(G,{ml:"-20px",mr:"8px",children:a.jsx(ze,{size:"9",minW:"36px"})}),a.jsx(le,{w:"100%"})]}):a.jsxs(N,{gap:"16px",children:[a.jsx(Qe,{coinAIconUrl:($=n==null?void 0:n.displayToken0)==null?void 0:$.image,coinBIconUrl:(o=n==null?void 0:n.displayToken1)==null?void 0:o.image,variant:"border",w:"40px",showATag:r(((b=n==null?void 0:n.displayToken0)==null?void 0:b.metadata)||""),showBTag:r(((P=n==null?void 0:n.displayToken1)==null?void 0:P.metadata)||"")}),a.jsxs(N,{gap:"0px",children:[a.jsx(ge,{fontSize:"2xl",color:"text_caption",sx:{"@media screen and (max-width: 810px)":{fontSize:"xl"}},children:(H=n==null?void 0:n.displayToken0)==null?void 0:H.symbol}),a.jsx(R,{fontSize:"2xl",color:"text_caption",sx:{"@media screen and (max-width: 810px)":{fontSize:"xl"}},children:"-"}),a.jsx(ge,{fontSize:"2xl",color:"text_caption",sx:{"@media screen and (max-width: 810px)":{fontSize:"xl"}},children:(B=n==null?void 0:n.displayToken1)==null?void 0:B.symbol}),a.jsxs(R,{fontSize:"2xl",color:"text_caption",mr:"2px",ml:"8px",sx:{"@media screen and (max-width: 810px)":{fontSize:"xl"}},children:["LP（#",n==null?void 0:n.position_index,"）"]})]})]}),a.jsxs(N,{w:"100%",justifyContent:"space-between",sx:{"@media screen and (max-width: 810px)":{display:"flex",alignItems:"flex-start"}},children:[u?a.jsx(J,{h:"36px",w:"60%",align:"center",children:a.jsx(le,{w:"100%"})}):a.jsxs(N,{gap:"16px",sx:{"@media screen and (max-width: 810px)":{display:"flex",alignItems:"flex-start",justifyContent:"flex-start",flexDirection:"column-reverse"}},children:[V>810&&S(),a.jsx(it,{minPrice:g,maxPrice:E,baseSymbol:T?(z=n==null?void 0:n.displayToken1)==null?void 0:z.symbol:(X=n==null?void 0:n.displayToken0)==null?void 0:X.symbol,quoteSymbol:T?(Z=n==null?void 0:n.displayToken0)==null?void 0:Z.symbol:(L=n==null?void 0:n.displayToken1)==null?void 0:L.symbol,changeSide:T,setChangeSide:A}),a.jsxs(N,{children:[V<=810&&S(),n&&n.owner.length===0&&a.jsx(N,{pl:"12px",pr:"12px",pt:"6px",pb:"6px",ml:"-10px",borderRadius:"6px",backgroundColor:"bg_secondary",children:a.jsx(R,{fontSize:"xs",children:"Closed"})}),n&&n.owner.length>0&&a.jsx(ht,{status:(n==null?void 0:n.posId)&&((C=l==null?void 0:l[n==null?void 0:n.posId])==null?void 0:C.status),isActive:h}),a.jsx(N,{p:"6px",borderRadius:"8px",backgroundColor:"bg_secondary",_hover:{opacity:.8},onClick:()=>{window.open(_(n==null?void 0:n.collection_id,n==null?void 0:n.id),"_blank")},children:a.jsx(Se,{xlinkHref:"#icon-icon_lead",cursor:"pointer",transform:"rotate(-45deg)"})})]})]}),a.jsxs(N,{gap:"10px",sx:{"@media screen and (max-width: 810px)":{mt:"-90px",ml:"-20px"}},children:[a.jsx(Oe,{handleClickRefresh:s,boxH:"32px",boxW:"32px",svgW:"20px",svgH:"20px"}),a.jsx(Se,{boxW:"32px",boxH:"32px",variant:"rectangle",xlinkHref:"#icon-icon_slider",onClick:()=>{c(!0)}})]})]})]}),a.jsx(pt,{isOpen:t,onClose:()=>c(!1)})]})}function ft(k){var V,$,o,b;const{pid:s}=k,{positionInfo:t,liquidityPriceObj:c,currentPoolInfo:r,positionFeeObj:n,posRewardsObj:l,claimFeeAndRewardsSubmitLoading:u,positionLoading:d,positionFeeLoading:p,positionRewardsLoading:e,positionLiquidityPriceLoading:j}=oe(),{handleSubmitClaim:_,isDisabledClaimBtn:T}=Fe();x.useEffect(()=>{console.log("PositionInfo Component positionInfo: ",t,r)},[t]),x.useEffect(()=>{console.log("PositionInfo Component liquidityPriceObj: ",c)},[c]),x.useEffect(()=>{console.log("PositionInfo Component positionFeeObj: ",n)},[n]),x.useEffect(()=>{console.log("PositionInfo Component posRewardsObj: ",l)},[l]);const A=x.useMemo(()=>{var z,X,Z;const P=((z=c==null?void 0:c[s])==null?void 0:z.total)||"0",H=((X=n==null?void 0:n[s])==null?void 0:X.total)||"0",B=((Z=l==null?void 0:l[s])==null?void 0:Z.total)||"0";return P==="--"||H==="--"||B==="--"?"--":m(P).add(H).add(B).toString()},[s,c,n,l]),E=x.useMemo(()=>{var B,z;const P=((B=n==null?void 0:n[s])==null?void 0:B.total)||"0",H=((z=l==null?void 0:l[s])==null?void 0:z.total)||"0";return P==="--"||H==="--"?"--":m(P).add(H).toString()},[s,n,l]),g=x.useMemo(()=>c==null?void 0:c[s],[c]),h=x.useMemo(()=>n==null?void 0:n[s],[n]),S=x.useMemo(()=>(r==null?void 0:r.isReverse)||!1,[r]);return a.jsxs(G,{w:"100%",borderRadius:"16px",backgroundColor:"card_bg",padding:"16px",children:[a.jsx(R,{fontSize:"md",color:"text_caption",children:"Position Info"}),a.jsxs(N,{justifyContent:"space-between",mt:"16px",children:[a.jsxs(G,{children:[a.jsx(R,{fontSize:"xs",children:"Total"}),j||p||e?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsx(R,{fontSize:"md",color:"text_caption",children:F(A,2)})]}),a.jsxs(N,{children:[p||e?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsxs(R,{fontSize:"md",color:"text_caption",children:["~",F(E,2)]}),a.jsx(we,{fontSize:"xs",h:"32px",lineHeight:"32px",borderRadius:"8px",isLoading:u,isDisabled:T,onClick:_,children:"Claim Yield"})]})]}),a.jsxs(N,{justifyContent:"space-between",mt:"16px",gap:"16px",sx:{"@media screen and (max-width: 810px)":{display:"flex",flexDirection:"column"}},children:[a.jsx(Ee,{title:"Liquidity",titleIsLoading:j,positionLoading:d,token0:t==null?void 0:t.displayToken0,token1:t==null?void 0:t.displayToken1,amount0:S?g==null?void 0:g.coinAmount1:g==null?void 0:g.coinAmount0,amount1:S?g==null?void 0:g.coinAmount0:g==null?void 0:g.coinAmount1,amount0Value:S?g==null?void 0:g.coinAmount1Rate:g==null?void 0:g.coinAmount0Rate,amount1Value:S?g==null?void 0:g.coinAmount0Rate:g==null?void 0:g.coinAmount1Rate,total:g==null?void 0:g.liquidityRate}),a.jsx(Ee,{title:"Fees Earnings",titleIsLoading:p,positionLoading:d,token0:t==null?void 0:t.displayToken0,token1:t==null?void 0:t.displayToken1,amount0:S?(h==null?void 0:h.fee1)||0:(h==null?void 0:h.fee0)||0,amount1:S?(h==null?void 0:h.fee0)||0:(h==null?void 0:h.fee1)||0,amount0Value:S?h==null?void 0:h.fee1Rate:h==null?void 0:h.fee0Rate,amount1Value:S?h==null?void 0:h.fee0Rate:h==null?void 0:h.fee1Rate,total:F(h==null?void 0:h.total,2)})]}),((V=l==null?void 0:l[s])==null?void 0:V.rewards)&&(($=l==null?void 0:l[s])==null?void 0:$.rewards.length)>0&&a.jsx(Et,{total:(o=l==null?void 0:l[s])==null?void 0:o.total,rewards:(b=l==null?void 0:l[s])==null?void 0:b.rewards,positionRewardsLoading:e})]})}function Et(k){const{total:s,rewards:t,positionRewardsLoading:c}=k;return a.jsxs(N,{pl:"16px",pr:"16px",w:"100%",h:"68px",justifyContent:"space-between",borderRadius:"16px",bg:"warning_10",mt:"16px",children:[a.jsxs(G,{children:[a.jsx(R,{fontSize:"xs",children:"Rewards"}),c?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsx(R,{fontSize:"md",color:"warning",children:F(s,2)})]}),c?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsx(N,{gap:"8px",children:t==null?void 0:t.map((r,n)=>{var l,u;return a.jsxs(N,{children:[a.jsx(Te,{width:"20px",height:"20px",imageUrl:(l=r==null?void 0:r.token)==null?void 0:l.image}),a.jsx(R,{fontSize:"xs",color:"text_caption",children:ne((r==null?void 0:r.amount)||"0")}),a.jsx(ge,{fontSize:"xs",color:"text_caption",children:(u=r==null?void 0:r.token)==null?void 0:u.symbol})]},n)})})]})}function Ee(k){const{title:s,token0:t,token1:c,amount0:r,amount1:n,amount0Value:l,amount1Value:u,total:d,titleIsLoading:p,positionLoading:e}=k,{isImportToken:j}=_e();return a.jsxs(se,{w:"100%",gap:"0px",children:[a.jsxs(se,{p:"16px",borderRadius:"16px 16px 0px 0px",bg:"position_info_card_bg",w:"90%",children:[a.jsx(R,{fontSize:"xs",children:s}),p?a.jsx(J,{h:"24px",align:"center",children:a.jsx(le,{})}):a.jsx(R,{fontSize:"md",color:"text_highlight",children:d})]}),a.jsxs(se,{borderRadius:"16px",bg:"bg_secondary",w:"100%",gap:"0px",children:[a.jsxs(N,{h:"48px",justifyContent:"space-between",w:"100%",pl:"12px",pr:"12px",children:[e?a.jsx(J,{h:"20px",align:"center",children:a.jsx(le,{})}):a.jsxs(N,{gap:"8px",children:[a.jsx(Te,{width:"20px",height:"20px",imageUrl:t==null?void 0:t.image,showTag:j(t==null?void 0:t.metadata),showTagWidth:"14px",showTagHeight:"14px"}),a.jsx(ge,{fontSize:"xs",color:"text_caption",children:t==null?void 0:t.symbol})]}),e?a.jsx(J,{h:"20px",align:"center",children:a.jsx(le,{})}):a.jsxs(se,{gap:"0px",alignItems:"end",children:[a.jsx(R,{fontSize:"xs",color:"text_caption",children:ne(r||"0")}),a.jsx(R,{fontSize:"xs",children:F(l,2)})]})]}),a.jsx(G,{h:"1px",w:"100%",backgroundColor:"form_item_bg"}),a.jsxs(N,{h:"48px",justifyContent:"space-between",w:"100%",pl:"12px",pr:"12px",children:[e?a.jsx(J,{h:"20px",align:"center",children:a.jsx(le,{})}):a.jsxs(N,{gap:"8px",children:[a.jsx(Te,{width:"20px",height:"20px",imageUrl:c==null?void 0:c.image,showTag:j(c==null?void 0:c.metadata),showTagWidth:"14px",showTagHeight:"14px"}),a.jsx(ge,{fontSize:"xs",color:"text_caption",children:c==null?void 0:c.symbol})]}),e?a.jsx(J,{h:"20px",align:"center",children:a.jsx(le,{})}):a.jsxs(se,{gap:"0px",alignItems:"end",children:[a.jsx(R,{fontSize:"xs",color:"text_caption",children:ne(n||"0")}),a.jsx(R,{fontSize:"xs",children:F(u,2)})]})]})]})]})}function Ht(k){const{dataList:s,loading:t,windowWidth:c}=k;if(s.length===0)return a.jsx(ye,{type:"nodata"});if(s.length===0)return a.jsx(ye,{type:"nodata"});const r=d=>a.jsx(R,{fontSize:"xs",color:"text_caption",children:d==null?void 0:d.event_type}),n=d=>a.jsx(Wt,{coins:d==null?void 0:d.coin_change}),l=d=>a.jsx(Nt,{time:d==null?void 0:d.block_time,tx:d.tx}),u=d=>[{leftText:"Action",right:r(d)},{leftText:"Token transferred",right:n(d)},{leftText:"Time",right:l(d)}];return a.jsx(wt,{w:"100%",borderRadius:"16px",backgroundColor:"card_bg",p:"16px 16px 0",sx:{"@media screen and (max-width: 810px)":{p:"0"}},children:c<=810?a.jsx(se,{w:"100%",p:"8px",children:t?[{},{},{}].map((d,p)=>a.jsx(se,{w:"100%",borderBottom:"1px solid ",borderColor:"border",children:a.jsx(De,{isLoading:t})},p)):s==null?void 0:s.map((d,p)=>a.jsx(se,{w:"100%",children:a.jsx(De,{isLoading:t,rowList:u(d)})},d==null?void 0:d.pool))}):a.jsxs(jt,{variant:"simple",size:"lg",children:[a.jsx(yt,{children:a.jsxs(Me,{children:[a.jsx(Ae,{children:"Action"}),a.jsx(Ae,{textAlign:"end",children:"Token transferred"}),a.jsx(Ae,{textAlign:"end",children:"Time"})]})}),t?a.jsx(Ie,{tableList:[{},{},{}],tdList:[{},{},{}],minW:"unset"}):a.jsx(bt,{children:s.map((d,p)=>a.jsxs(Me,{children:[a.jsx(Pe,{children:r(d)}),a.jsx(Pe,{children:n(d)}),a.jsx(Pe,{children:l(d)})]},p))})]})})}function Nt(k){const{time:s,tx:t}=k,{getExplorerUrl:c}=He();return a.jsxs(N,{gap:"4px",justifyContent:"end",children:[a.jsx(R,{fontSize:"xs",color:"text_caption",children:et(Date.parse(s)-8*60*60*1e3)}),a.jsx(Se,{padding:"2px",xlinkHref:"#icon-icon_lead",cursor:"pointer",transform:"rotate(-45deg)",onClick:()=>{window.open(c(t,"tx"),"_blank")}})]})}function Wt(k){const{coins:s}=k;return a.jsx(se,{alignItems:"end",children:s.map((t,c)=>a.jsxs(N,{gap:"8px",children:[a.jsx(Te,{width:"20px",height:"20px",imageUrl:t.image}),a.jsx(R,{fontSize:"xs",color:"text_caption",children:t.amount})]},c))})}function qt(){const k=Re(),{refreshPositionData:s}=Je(),{slippage:t}=Ne(),{tokenBalanceValue:c}=tt(),{getAddLiquidityPaylod:r}=We(),{signAndExecuteTransaction:n}=qe(),{addToken0Value:l,addToken1Value:u,setAddToken0Value:d,setAddToken1Value:p,positionInfo:e,liquidityPriceObj:j,posStatus:_,precomputationAdd:T,setPrecomputationAdd:A,ratio:E,increaseSubmitLoading:g,setIncreaseSubmitLoading:h}=oe(),[S,V]=x.useState(),$=x.useMemo(()=>{var L,C,W;return c&&((L=e==null?void 0:e.token0)!=null&&L.metadata)?Ve(c((C=e==null?void 0:e.token0)==null?void 0:C.metadata),(W=e==null?void 0:e.token0)==null?void 0:W.decimals).toString():"0"},[c,e==null?void 0:e.token0]),o=x.useMemo(()=>{var L,C,W;return c&&((L=e==null?void 0:e.token1)!=null&&L.metadata)?Ve(c((C=e==null?void 0:e.token1)==null?void 0:C.metadata),(W=e==null?void 0:e.token1)==null?void 0:W.decimals).toString():"0"},[c,e==null?void 0:e.token1]),b=L=>{var C;((C=e==null?void 0:e.owner)==null?void 0:C.length)!==0&&(console.log("handleAddToken0ValueChange value: ",L),console.log("handleAddToken0ValueChange positionInfo?.token0: ",e==null?void 0:e.token0),d(L),V(e==null?void 0:e.token0))},P=L=>{var C;((C=e==null?void 0:e.owner)==null?void 0:C.length)!==0&&(console.log("handleAddToken1ValueChange value: ",L),console.log("handleAddToken1ValueChange positionInfo?.token1: ",e==null?void 0:e.token1),p(L),V(e==null?void 0:e.token1))};x.useEffect(()=>{var w,y,v,M,U,q,f;if(!Number(l)&&!Number(u))return;const L=e==null?void 0:e.tick_lower_index,C=e==null?void 0:e.tick_upper_index,W=(e==null?void 0:e.posId)&&((w=j==null?void 0:j[e==null?void 0:e.posId])==null?void 0:w.currentSqrtPrice),O=(S==null?void 0:S.metadata)===((y=e==null?void 0:e.token0)==null?void 0:y.metadata),I=(S==null?void 0:S.metadata)===((v=e==null?void 0:e.token0)==null?void 0:v.metadata);console.log("precomputation fixedToken: ",S,O),console.log("precomputation isInputDisplayToken0: ",I);const i=I?de(l,(M=e==null?void 0:e.token0)==null?void 0:M.decimals):de(u,(U=e==null?void 0:e.token1)==null?void 0:U.decimals);if(console.log("precomputation amount: ",i.toString()),!i||m(i.toString()).equals(0)){p(""),d("");return}if(console.log("precomputation sqrtPriceX98: ",W),console.log("precomputation posStatus: ",_),!(L===void 0||C===void 0||!W))if(_==="active"){const D=Ze.estLiquidityAndcoinAmountFromOneAmounts(L,C,i,O,!0,t,new ue(W));if(O?D.coinAmountA=i:D.coinAmountB=i,A(D),console.log("precomputation preInfo coinAmountA: ",D.coinAmountA.toString()),console.log("precomputation preInfo coinAmountB: ",D.coinAmountB.toString()),I){const Y=ie(D.coinAmountB,(q=e==null?void 0:e.token1)==null?void 0:q.decimals);m(Y).eq(0)?p(""):p(Y)}else{const Y=ie(D.coinAmountA,(f=e==null?void 0:e.token0)==null?void 0:f.decimals);m(Y).eq(0)?d(""):d(Y)}}else A(void 0)},[l,u,S,j,e,t,_]);const H=mt(e==null?void 0:e.token0,e==null?void 0:e.token1,l,u),B=()=>{var W,O,I;const L=(e==null?void 0:e.token0.metadata)!==(e==null?void 0:e.displayToken0.metadata),C={token0:e==null?void 0:e.displayToken0,token1:e==null?void 0:e.displayToken1,amount0:L?u:l,amount1:L?l:u,fee:m(e==null?void 0:e.feeTier).div(Math.pow(10,4)).toString(),ratio:E,totalRate:H,minPrice:e==null?void 0:e.minPrice,maxPrice:e==null?void 0:e.maxPrice,displayPerText:`${ae((W=e==null?void 0:e.token1)==null?void 0:W.symbol)} per ${ae((O=e==null?void 0:e.token0)==null?void 0:O.symbol)}`,displayCurrentPrice:(e==null?void 0:e.posId)&&((I=j==null?void 0:j[e==null?void 0:e.posId])==null?void 0:I.currentPrice),currentPriceStatus:_};return console.log("handleOpenSecondaryModal data: ",C),C},z=async()=>{var L,C,W,O,I,i,w;h(!0);try{if((e==null?void 0:e.owner)!==k){console.log("POSITION ERROR"),h(!1);return}const y=(S==null?void 0:S.metadata)===((L=e==null?void 0:e.token0)==null?void 0:L.metadata);if(e!=null&&e.posId&&(e==null?void 0:e.tick_lower_index)!==void 0&&(e==null?void 0:e.tick_upper_index)!==void 0){const v=_==="active"?t:"0";let M="0",U="0";if(T)M=T!=null&&T.fix_amount_a?(C=T==null?void 0:T.coinAmountA)==null?void 0:C.toString():m((W=T==null?void 0:T.coinAmountA)==null?void 0:W.toString()).mul(m(1).add(v)).toFixed(0),U=T!=null&&T.fix_amount_a?m((I=T==null?void 0:T.coinAmountB)==null?void 0:I.toString()).mul(m(1).add(v)).toFixed(0):(O=T==null?void 0:T.coinAmountB)==null?void 0:O.toString();else{const K=de(l,(i=e==null?void 0:e.token0)==null?void 0:i.decimals).toString(),Q=de(u,(w=e==null?void 0:e.token1)==null?void 0:w.decimals).toString();M=m(K).gt(0)?m(K).mul(m(1).add(v)).toString():K,U=m(Q).gt(0)?m(Q).mul(m(1).add(v)).toString():Q}const q={pid:e==null?void 0:e.posId,fix_amount_a:y,offer_amount_a:M,offer_amount_b:U};console.log("handleSubmitAdd params: ",q);const f=r(q);console.log("handleSubmitAdd payload: ",f);const D=(e==null?void 0:e.token0.metadata)!==(e==null?void 0:e.displayToken0.metadata);if(!f)throw Error("payload is undefined");const Y=await n([f],{action:Ue.Add,description:"Add Liquidity",coinA:{...e==null?void 0:e.displayToken0,amount:D?u:l},coinB:{...e==null?void 0:e.displayToken1,amount:D?l:u}});h(!1),s(),console.log("handleSubmitAdd response: ",Y),p(""),d("")}}catch(y){console.log("handleSubmitAdd error: ",y),h(!1)}},{isDisabled:X,submitBtnText:Z}=xt(g,e==null?void 0:e.token0,e==null?void 0:e.token1,_,l,u,$,o,!0);return{handleAddToken0ValueChange:b,handleAddToken1ValueChange:P,fixedToken:S,totalRate:H,getSecondaryModalData:B,handleSubmitAdd:z,addToken0Balance:$,addToken1Balance:o,isDisabled:X,submitBtnText:Z}}function Ut(){var P,H;const k=Re(),{onboard:s}=Ce(),{positionInfo:t,addToken0Value:c,addToken1Value:r,increaseSubmitLoading:n,posStatus:l}=oe(),{handleAddToken0ValueChange:u,handleAddToken1ValueChange:d,fixedToken:p,totalRate:e,getSecondaryModalData:j,handleSubmitAdd:_,addToken0Balance:T,addToken1Balance:A,isDisabled:E,submitBtnText:g}=qt(),[h,S]=x.useState(!1),[V,$]=x.useState(),o=()=>{if(!k){s();return}const B=j();console.log("handleOpenSecondaryModal data: ",B),$(B),S(!0)},b=x.useMemo(()=>{var B,z;return t?((B=t==null?void 0:t.token0)==null?void 0:B.metadata)===((z=t==null?void 0:t.displayToken0)==null?void 0:z.metadata):!0},[t]);return a.jsxs(G,{children:[a.jsxs(se,{gap:"0px",w:"100%",mt:"16px",flexDirection:b?"column":"column-reverse",children:[a.jsxs(G,{position:"relative",w:"100%",children:[l&&l===((P=t==null?void 0:t.token0)==null?void 0:P.metadata)?a.jsx(ve,{}):null,a.jsx(be,{currentCoin:t==null?void 0:t.token0,noArrow:!0,amount:c,balance:T,onAmountChange:u})]}),a.jsx(J,{gap:"0px",h:"8px",zIndex:"98",children:a.jsx("div",{className:"exchange liquidity-add position-img"})}),a.jsxs(G,{position:"relative",w:"100%",children:[l&&l===((H=t==null?void 0:t.token1)==null?void 0:H.metadata)?a.jsx(ve,{}):null,a.jsx(be,{currentCoin:t==null?void 0:t.token1,noArrow:!0,amount:r,balance:A,onAmountChange:d})]})]}),a.jsx(we,{mt:"16px",w:"100%",size:"lg",onClick:o,isLoading:n,isDisabled:E,children:g}),a.jsx(ut,{data:V,isOpen:h,onClose:()=>{S(!1)},onClick:()=>{_(),S(!1)}})]})}function Yt(k){var E,g,h,S,V,$,o,b,P,H,B,z,X,Z,L,C,W,O,I;const{isOpen:s,onClose:t,onClick:c,data:r}=k;console.log({data:r});const n=((E=r==null?void 0:r.token0)==null?void 0:E.metadata)!==((g=r==null?void 0:r.fees)==null?void 0:g.token0.metadata),l=n?((h=r==null?void 0:r.fees)==null?void 0:h.fee1)||0:((S=r==null?void 0:r.fees)==null?void 0:S.fee0)||0,u=n?((V=r==null?void 0:r.fees)==null?void 0:V.fee0)||0:(($=r==null?void 0:r.fees)==null?void 0:$.fee1)||0,d=m(l).gt(0),p=m(u||0).gt(0),e=d||p,j=(o=r==null?void 0:r.rewards)==null?void 0:o.filter(i=>m(i.amount||0).greaterThan(0)),_=j&&j.length>0;let T;e&&_?T="You will alse collect fees and rewards earned from this position":e?T="You will alse collect fees earned from this position":_&&(T="You will alse collect rewards earned from this position");const{isImportToken:A}=_e();return a.jsxs(vt,{isOpen:s,onClose:t,isCentered:!0,children:[a.jsx(Ct,{}),a.jsxs(Rt,{children:[a.jsx(_t,{children:"Remove Liquidity"}),a.jsx(At,{}),a.jsx(Pt,{pb:"16px",children:a.jsxs(se,{w:"100%",alignItems:"start",children:[a.jsxs(ke,{w:"100%",gap:"20px",children:[a.jsx(pe,{leftText:`${r==null?void 0:r.amount0} ${ae((b=r==null?void 0:r.token0)==null?void 0:b.symbol)}`,icon:(P=r==null?void 0:r.token0)==null?void 0:P.image,isImportToken:A((H=r==null?void 0:r.token0)==null?void 0:H.metadata)}),a.jsx(pe,{leftText:`${r==null?void 0:r.amount1} ${ae((B=r==null?void 0:r.token1)==null?void 0:B.symbol)}`,icon:(z=r==null?void 0:r.token1)==null?void 0:z.image,isImportToken:A((X=r==null?void 0:r.token1)==null?void 0:X.metadata)})]}),T&&a.jsx(R,{mt:"30px",fontSize:"xs",children:T}),e&&_&&a.jsx(R,{mt:"6px",fontSize:"xs",children:"Fees"}),e&&a.jsxs(ke,{w:"100%",gap:"20px",mt:"4px",children:[d&&a.jsx(pe,{leftText:`${l} ${ae((Z=r==null?void 0:r.token0)==null?void 0:Z.symbol)}`,icon:(L=r==null?void 0:r.token0)==null?void 0:L.image,isImportToken:A((C=r==null?void 0:r.token0)==null?void 0:C.metadata)}),p&&a.jsx(pe,{leftText:`${u} ${ae((W=r==null?void 0:r.token1)==null?void 0:W.symbol)}`,icon:(O=r==null?void 0:r.token1)==null?void 0:O.image,isImportToken:A((I=r==null?void 0:r.token1)==null?void 0:I.metadata)})]}),e&&_&&a.jsx(R,{mt:"6px",fontSize:"xs",children:"Rewards"}),j&&a.jsx(ke,{w:"100%",gap:"20px",children:j.map(i=>{var w,y,v;return a.jsx(pe,{leftText:`${i==null?void 0:i.amount} ${ae((w=i==null?void 0:i.token)==null?void 0:w.symbol)}`,icon:(y=i==null?void 0:i.token)==null?void 0:y.image},(v=i==null?void 0:i.token)==null?void 0:v.symbol)})}),a.jsx(we,{w:"100%",mt:"20px",size:"lg",onClick:c,children:"Remove"})]})})]})]})}function pe(k){const{leftText:s,icon:t,isImportToken:c}=k;return a.jsxs(N,{justifyContent:"space-between",children:[a.jsx(R,{fontSize:"xl",color:"text_caption",children:s}),a.jsx(Te,{width:"32px",height:"32px",imageUrl:t,showTag:c})]})}function Xt(){const k=Re(),s=Le(),{refreshPositionData:t}=Je(),{slippage:c}=Ne(),{getRemoveLiquidityPaylaod:r}=We(),{signAndExecuteTransaction:n}=qe(),{removeToken0Value:l,removeToken1Value:u,setRemoveToken0Value:d,setRemoveToken1Value:p,positionInfo:e,liquidityPriceObj:j,setPrecomputationAdd:_,removeSubmitLoading:T,setRemoveSubmitLoading:A,setRemovePercentage:E,removePercentage:g,positionFeeObj:h,posRewardsObj:S,removePercentageNoFormat:V,positionLoading:$}=oe(),o=x.useMemo(()=>{var U,q,f;if(!(e!=null&&e.posId))return;const i=new ue(e==null?void 0:e.liquidity),w=new ue((e==null?void 0:e.posId)&&((U=j==null?void 0:j[e==null?void 0:e.posId])==null?void 0:U.currentSqrtPrice)),y=fe.tickIndexToSqrtPriceX64(e==null?void 0:e.tick_lower_index),v=fe.tickIndexToSqrtPriceX64(e==null?void 0:e.tick_upper_index);console.log("coinAmount liquidity: ",i),console.log("coinAmount sqrtPriceX98: ",w),console.log("coinAmount lowerSqrtPrice: ",y),console.log("coinAmount upperSqrtPrice: ",v);const M=Ze.getCoinAmountFromLiquidity(i,w,y,v,!1);return console.log("coinAmount amount: ",M),{coinA:ie(M.coinA,(q=e==null?void 0:e.token0)==null?void 0:q.decimals),coinB:ie(M.coinB,(f=e==null?void 0:e.token1)==null?void 0:f.decimals)}},[e,j]);x.useState();const b=x.useMemo(()=>o==null?void 0:o.coinA,[o]),P=x.useMemo(()=>o==null?void 0:o.coinB,[o]),B=at((i,w)=>{var y,v,M,U,q,f,D,Y,K,Q,ee,te;if(w){if(o!=null&&o.coinA)if(m((y=o==null?void 0:o.coinA)==null?void 0:y.toString()).eq(0))m(i).eq(0)&&(p(ce((v=o==null?void 0:o.coinB)==null?void 0:v.toString(),(M=e==null?void 0:e.token1)==null?void 0:M.decimals,!0).toString()),E(100,100));else{const re=m(i).div((U=o==null?void 0:o.coinA)==null?void 0:U.toString()),me=m((q=o==null?void 0:o.coinB)==null?void 0:q.toString()).mul(re).toString();p(ce(me,(f=e==null?void 0:e.token1)==null?void 0:f.decimals,!0).toString()),E(Number(m(ce(re.toString(),4)).mul(100).toString()),m(re).mul(100).toNumber())}}else if(o!=null&&o.coinB)if(m((D=o==null?void 0:o.coinB)==null?void 0:D.toString()).eq(0))m(i).eq(0)&&(p(ce((Y=o==null?void 0:o.coinA)==null?void 0:Y.toString(),(K=e==null?void 0:e.token0)==null?void 0:K.decimals,!0).toString()),E(100,100));else{const re=m(i).div((Q=o==null?void 0:o.coinB)==null?void 0:Q.toString()),me=m((ee=o==null?void 0:o.coinA)==null?void 0:ee.toString()).mul(re).toString();d(ce(me,(te=e==null?void 0:e.token0)==null?void 0:te.decimals,!0).toString()),E(Number(m(ce(re.toString(),4)).mul(100).toString()),m(re).mul(100).toNumber())}},100),z=i=>{var w;((w=e==null?void 0:e.owner)==null?void 0:w.length)!==0&&(console.log("handleRemoveToken0ValueChange value: ",i),console.log("handleRemoveToken0ValueChange positionInfo?.token0: ",e==null?void 0:e.token0),d(i),B(i,!0))},X=i=>{var w;((w=e==null?void 0:e.owner)==null?void 0:w.length)!==0&&(console.log("handleAddToken1ValueChange value: ",i),console.log("handleAddToken1ValueChange positionInfo?.token1: ",e==null?void 0:e.token1),p(i),B(i,!1))},Z=i=>{var v,M,U,q,f,D,Y;if(((v=e==null?void 0:e.owner)==null?void 0:v.length)===0)return;const w=m((M=o==null?void 0:o.coinA)==null?void 0:M.toString()).mul((U=m(i))==null?void 0:U.div(100)).toString(),y=m((q=o==null?void 0:o.coinB)==null?void 0:q.toString()).mul((f=m(i))==null?void 0:f.div(100)).toString();console.log("useRemove 设置默认值 amoutnA: ",w),console.log("useRemove 设置默认值 amoutnB: ",y),d(ce(w,(D=e==null?void 0:e.token0)==null?void 0:D.decimals,!0).toString()),p(ce(y,(Y=e==null?void 0:e.token1)==null?void 0:Y.decimals,!0).toString())};x.useEffect(()=>{var i,w;console.log("useRemove coinAmount: ",(i=o==null?void 0:o.coinA)==null?void 0:i.toString(),"--",(w=o==null?void 0:o.coinB)==null?void 0:w.toString()),o&&Z(V)},[o]);const L=i=>{let w;typeof i=="string"?i==="MAX"?w=100:w=Number(i.split("%")[0]):w=i,E(w,w),Z(w),console.log("handlePercentChange value: ",i)},C=()=>{var y;const i=(e==null?void 0:e.token0.metadata)!==(e==null?void 0:e.displayToken0.metadata),w={token0:e==null?void 0:e.displayToken0,token1:e==null?void 0:e.displayToken1,amount0:i?u:l,amount1:i?l:u,fees:e!=null&&e.posId&&g===100?h[e==null?void 0:e.posId]:void 0,rewards:e!=null&&e.posId&&g===100?(y=S[e==null?void 0:e.posId])==null?void 0:y.rewards:void 0};return console.log("handleOpenSecondaryModal data: ",w),w},W=async()=>{var i,w,y,v;A(!0),console.log("handleSubmitRemove positionInfo: ",e),console.log("handleSubmitRemove removePercentage: ",g),console.log("handleSubmitRemove coinAmount: ",o);try{if(e!=null&&e.posId&&(e!=null&&e.liquidity)){const M=g===100,U=M?e==null?void 0:e.liquidity:he(m(V).div(100).mul(e==null?void 0:e.liquidity).toString(),0);console.log("handleSubmitRemove slippage: ",c);let q,f,D;if(M&&o){f=o.coinA,D=o.coinB;const ee=m(de(f,(i=e==null?void 0:e.token0)==null?void 0:i.decimals).toString()).mul(m(1).minus(c)).toString(),te=m(de(D,(w=e==null?void 0:e.token1)==null?void 0:w.decimals).toString()).mul(m(1).minus(c)).toString();q={pid:e==null?void 0:e.posId,min_amount_a:String(he(ee,0)),min_amount_b:String(he(te,0)),delta_liquidity:U,is_collect_fee:!!M,is_collect_reward:!!M}}else{f=l,D=u;const ee=m(de(f,(y=e==null?void 0:e.token0)==null?void 0:y.decimals).toString()).mul(m(1).minus(c)).toString(),te=m(de(D,(v=e==null?void 0:e.token1)==null?void 0:v.decimals).toString()).mul(m(1).minus(c)).toString();q={pid:e==null?void 0:e.posId,min_amount_a:String(he(ee,0)),min_amount_b:String(he(te,0)),delta_liquidity:U}}console.log("handleSubmitRemove params: ",q);const Y=r(q);console.log("handleSubmitRemove payload: ",Y);const K=(e==null?void 0:e.token0.metadata)!==(e==null?void 0:e.displayToken0.metadata);if(!Y)throw Error("payload is undefined");const Q=await n([Y],{action:Ue.Remove,description:"Remove Liquidity",coinA:{...e==null?void 0:e.displayToken0,amount:K?D:f},coinB:{...e==null?void 0:e.displayToken1,amount:K?f:D}});A(!1),console.log("handleSubmitRemove response: ",Q),M&&Q.isSuccess?s("/pools/position"):t()}}catch(M){console.log("handleSubmitRemove error: ",M),A(!1)}},O=x.useMemo(()=>T?!0:k?!!(m(b).lt(l||0)||m(P).lt(u||0)||!Number(l)&&!Number(u)):!1,[T,l,u,b,P,k]),I=x.useMemo(()=>k?"Remove":"Connect Wallet",[T,l,u,b,P,k]);return{handleRemoveToken0ValueChange:z,handleRemoveToken1ValueChange:X,handlePercentChange:L,getSecondaryModalData:C,handleSubmitRemove:W,removeToken0Balance:b,removeToken1Balance:P,isDisabled:O,submitBtnText:I}}function Ft(){var B,z;const k=Re(),{onboard:s}=Ce(),{positionInfo:t,removeToken0Value:c,removeToken1Value:r,removePercentage:n,removePercentageNoFormat:l,removeSubmitLoading:u,posStatus:d}=oe(),{handleRemoveToken0ValueChange:p,handleRemoveToken1ValueChange:e,handlePercentChange:j,getSecondaryModalData:_,handleSubmitRemove:T,removeToken0Balance:A,removeToken1Balance:E,isDisabled:g,submitBtnText:h}=Xt(),[S,V]=x.useState(!1),[$,o]=x.useState(),b=()=>{if(!k){s();return}const X=_();console.log("handleOpenSecondaryModal data: ",X),o(X),V(!0)},P=x.useMemo(()=>l<.1&&l>0?"<0.1":l<=100?n:"--",[l]),H=x.useMemo(()=>{var X,Z;return t?((X=t==null?void 0:t.token0)==null?void 0:X.metadata)===((Z=t==null?void 0:t.displayToken0)==null?void 0:Z.metadata):!0},[t]);return a.jsxs(G,{children:[a.jsx(R,{mt:"30px",sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:"Amount of liquidity to remove"}),a.jsx(Jt,{percentage:P,onChange:j}),a.jsxs(se,{gap:"0px",w:"100%",mt:"16px",flexDirection:H?"column":"column-reverse",children:[a.jsxs(G,{position:"relative",w:"100%",children:[d&&d===((B=t==null?void 0:t.token0)==null?void 0:B.metadata)?a.jsx(ve,{isRemove:!0}):null,a.jsx(be,{textIsAvailable:!0,currentCoin:t==null?void 0:t.token0,noArrow:!0,amount:c,balance:A,onAmountChange:p})]}),a.jsx(J,{gap:"0px",h:"8px",zIndex:98,children:a.jsx("div",{className:"exchange liquidity-add position-img"})}),a.jsxs(G,{position:"relative",w:"100%",children:[d&&d===((z=t==null?void 0:t.token1)==null?void 0:z.metadata)?a.jsx(ve,{isRemove:!0}):null,a.jsx(be,{textIsAvailable:!0,currentCoin:t==null?void 0:t.token1,noArrow:!0,amount:r,balance:E,onAmountChange:e})]})]}),a.jsx(we,{mt:"16px",w:"100%",size:"lg",onClick:b,isLoading:u,isDisabled:g,children:h}),S&&a.jsx(Yt,{data:$,isOpen:S,onClose:()=>{V(!1)},onClick:()=>{T(),V(!1)}})]})}function Jt(k){const{percentage:s,onChange:t}=k,{windowWidth:c}=Be(),r=x.useMemo(()=>s!==100?`${s}%`:"MAX",[s]);return a.jsxs(G,{mt:"20px",children:[a.jsxs(Bt,{"aria-label":"slider-ex-1",min:0,max:100,focusThumbOnChange:!1,value:Number(s),onChange:t,children:[a.jsx(Lt,{children:a.jsx($t,{})}),a.jsx(zt,{})]}),a.jsxs(N,{justifyContent:"space-between",mt:"12px",children:[a.jsxs(R,{fontSize:"md",color:"text_caption",children:[s,"%"]}),a.jsx(rt,{w:c>810?"80px":"60px",h:"32px",options:["25%","50%","75%","MAX"],value:r,onChange:t})]})]})}function Gt(k){const{tab:s,onClickTab:t}=k;return console.log(s,"tabq313"),a.jsxs(G,{w:"100%",borderRadius:"16px",backgroundColor:"card_bg",padding:"16px",children:[a.jsx(Ye,{w:"50%",h:"56px",p:"8px",borderRadius:"12px",currentTab:s=="increase"||!s?"Increase":"Remove",textList:["Increase","Remove"],onClick:c=>t(c)}),!s||s==="increase"?a.jsx(Ut,{}):a.jsx(Ft,{})]})}function Zt(k){var O,I,i,w;const{tab:s}=k,{positionInfo:t,liquidityPriceObj:c,addToken0Value:r,addToken1Value:n,removeToken0Value:l,removeToken1Value:u,removePercentageNoFormat:d}=oe(),{getCointAmountValue:p}=nt(),{hasFee:e,hasRewards:j}=Fe(),[_,T]=x.useState(""),[A,E]=x.useState(""),g=(t==null?void 0:t.displayToken0.metadata)!==(t==null?void 0:t.token0.metadata);x.useEffect(()=>{var y,v;t!=null&&t.posId&&(c!=null&&c[t==null?void 0:t.posId])&&(T((y=c==null?void 0:c[t==null?void 0:t.posId])==null?void 0:y.coinAmount0),E((v=c==null?void 0:c[t==null?void 0:t.posId])==null?void 0:v.coinAmount1))},[t,c]);const[h,S]=x.useState(""),[V,$]=x.useState(""),[o,b]=x.useState(""),P=x.useMemo(()=>s==="increase"?r.length>0||n.length>0:d<=100&&d>0,[s,r,n,d]);x.useEffect(()=>{var U,q,f,D,Y,K,Q,ee,te,re,me,$e;let y="",v="";s==="increase"?((U=t==null?void 0:t.token0)!=null&&U.metadata&&r?(console.log("position action result positionInfo: ",t),console.log("position action result addToken0Value: ",r),console.log("position action result addToken1Value: ",n),y=String(getRate(r,(q=t==null?void 0:t.token0)==null?void 0:q.metadata,4,!0))||"",S(`${ne(r)} ${ae((f=t==null?void 0:t.token0)==null?void 0:f.symbol)} / ${F(y,2)}`),console.log("position action result rateA: ",y)):S("$--"),(D=t==null?void 0:t.token1)!=null&&D.metadata&&n?(v=String(getRate(n,(Y=t==null?void 0:t.token1)==null?void 0:Y.metadata,4,!0))||"",$(`${ne(n)} ${ae((K=t==null?void 0:t.token1)==null?void 0:K.symbol)} / ${F(v,2)}`),console.log("position action result rateB: ",v)):$("$--")):((Q=t==null?void 0:t.token0)!=null&&Q.metadata&&l?(y=String(getRate(l,(ee=t==null?void 0:t.token0)==null?void 0:ee.metadata,4,!0))||"",S(`${ne(l)} ${ae((te=t==null?void 0:t.token0)==null?void 0:te.symbol)} / ${F(y,2)}`)):S("$--"),(re=t==null?void 0:t.token1)!=null&&re.metadata&&u?(v=String(getRate(u,(me=t==null?void 0:t.token1)==null?void 0:me.metadata,4,!0))||"",$(`${ne(u)} ${ae(($e=t==null?void 0:t.token1)==null?void 0:$e.symbol)} / ${F(v,2)}`)):$("$--"));const M=y==="--"||v==="--"?"--":F(m(y).add(v||0).toString(),2);b(M)},[t,r,n,l,u,s]);const[H,B]=x.useState(""),[z,X]=x.useState(""),[Z,L]=x.useState(""),C=x.useMemo(()=>d===100,[d]);if(x.useEffect(()=>{var y,v,M,U,q,f,D,Y;if(s==="increase"){if(t!=null&&t.token0&&(t!=null&&t.token1)){const K=m(_).add(r||0).toString(),Q=m(A).add(n||0).toString(),ee=p(K,(y=t==null?void 0:t.token0)==null?void 0:y.metadata,4,!0),te=p(Q,(v=t==null?void 0:t.token1)==null?void 0:v.metadata,4,!0),re=ee==="--"||te==="--"?"--":m(ee).add(te).toString();L(F(re,2)),B(`${ne(K)} ${ae((M=t==null?void 0:t.token0)==null?void 0:M.symbol)} / ${F(ee,2)}`),X(`${ne(Q)} ${ae((U=t==null?void 0:t.token1)==null?void 0:U.symbol)} / ${F(te,2)}`)}}else if(t!=null&&t.token0&&(t!=null&&t.token1)){const K=C?"0":m(_).minus(l||0).toString(),Q=C?"0":m(A).minus(u||0).toString(),ee=p(K,(q=t==null?void 0:t.token0)==null?void 0:q.metadata,4,!0),te=p(Q,(f=t==null?void 0:t.token1)==null?void 0:f.metadata,4,!0),re=ee==="--"||te==="--"?"--":m(ee).add(te).toString();L(F(re,2)),B(`${ne(K)} ${ae((D=t==null?void 0:t.token0)==null?void 0:D.symbol)} / ${F(ee,2)}`),X(`${ne(Q)} ${ae((Y=t==null?void 0:t.token1)==null?void 0:Y.symbol)} / ${F(te,2)}`)}},[t,_,A,r,n,l,u,C,s]),!P)return null;const W=()=>e&&j?"You will also claim fees and rewards earned from this position.":e?"You will also claim fees  earned from this position.":j?"You will also claim  rewards earned from this position.":"";return a.jsxs(J,{w:"100%",direction:"column",position:"relative",borderRadius:"16px",backgroundColor:"card_bg",padding:"16px",children:[a.jsx(R,{fontSize:"md",color:"text_caption",children:"Your Actions"}),a.jsxs(ke,{gap:"10px",mt:"16px",children:[a.jsx(xe,{label:s==="increase"?"Your Deposit":"Your Withdraw",value:`${o}`,isResultItem:!1,useTextWarp:!1}),a.jsx(xe,{label:(O=t==null?void 0:t.displayToken0)==null?void 0:O.symbol,value:g?V:h,isResultItem:!1}),a.jsx(xe,{label:(I=t==null?void 0:t.displayToken1)==null?void 0:I.symbol,value:g?h:V,isResultItem:!1})]}),a.jsx(Se,{position:"absolute",left:"50%",mt:"120px",xlinkHref:"#icon-icon_lead",cursor:"pointer",transform:"rotate(90deg)"}),a.jsxs(ke,{gap:"10px",mt:"16px",borderRadius:"16px",bg:"button_ghost_bg",pl:"8px",pr:"8px",pt:"20px",pb:"20px",children:[a.jsx(xe,{label:"New Liquidity Amount",value:`${Z}`,useTextWarp:!1}),a.jsx(xe,{label:(i=t==null?void 0:t.displayToken0)==null?void 0:i.symbol,value:g?z:H}),a.jsx(xe,{label:(w=t==null?void 0:t.displayToken1)==null?void 0:w.symbol,value:g?H:z})]}),s!=="increase"&&C&&(e||j)&&a.jsxs(N,{borderRadius:"8px",bg:"bg_secondary",mt:"20px",pt:"10px",pb:"10px",pl:"16px",pr:"16px",children:[a.jsx(Se,{xlinkHref:"#icon-icon_tips",variant:"grayprimary"}),a.jsx(R,{fontSize:"xs",children:W()})]})]})}function xe(k){const{label:s,value:t,useTextWarp:c=!0,isResultItem:r=!0}=k;return a.jsxs(N,{justifyContent:"space-between",children:[c?a.jsx(ge,{fontSize:"xs",children:s}):a.jsx(R,{fontSize:"xs",children:s}),a.jsx(R,{fontSize:"xs",color:r?"text_highlight":"text_caption",children:t})]})}function Kt(k){var n,l,u;const{poolInfo:s}=k,{positionInfo:t,liquidityPriceObj:c}=oe(),r=x.useMemo(()=>{var d;if(c&&(t!=null&&t.posId)&&(c!=null&&c[t==null?void 0:t.posId]))return(d=c==null?void 0:c[t==null?void 0:t.posId])==null?void 0:d.currentPrice},[t,c]);return s===void 0?a.jsx(ye,{type:"nodata"}):a.jsxs(se,{w:"100%",borderRadius:"16px",backgroundColor:"card_bg",padding:"16px",gap:4,alignItems:"space-between",children:[a.jsxs(N,{w:"100%",justifyContent:"space-between",sx:{"@media screen and (max-width: 810px)":{display:"flex",flexDirection:"column",alignItems:"flex-start"}},children:[a.jsx(R,{sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:"Current Price"}),a.jsx(G,{children:a.jsx(st,{fromToken:s==null?void 0:s.displayToken0,toToken:s==null?void 0:s.displayToken1,fromValue:"1",toValue:r,isLoading:!r,fontSize:"xs"})})]}),a.jsx(je,{label:"APR(24h)",value:lt(s!=null&&s.totalApr?m(s.totalApr).mul(100).toString():void 0)}),a.jsx(je,{label:"TVL(Total Value Locked)",value:F((n=s==null?void 0:s.pureTvlUSD)==null?void 0:n.now,2)}),a.jsx(je,{label:"Volume(24h)",value:F((l=s==null?void 0:s.volUSD)==null?void 0:l.day,2)}),a.jsx(je,{label:"Fees(24h)",value:F((u=s==null?void 0:s.feesUSD)==null?void 0:u.day,2)})]})}function je(k){const{label:s,value:t}=k;return a.jsxs(N,{justifyContent:"space-between",children:[a.jsx(R,{sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:s}),a.jsx(R,{color:"text_caption",sx:{"@media screen and (max-width: 810px)":{fontSize:"xs"}},children:t})]})}function Qt(){const k=ot(),{tokensObj:s}=ct(),{positionInfo:t}=oe(),c=St(Tt),[r,n]=x.useState([]),[l,u]=x.useState(!1),{isImportToken:d}=_e();x.useEffect(()=>{t!=null&&t.posId&&p(t==null?void 0:t.posId)},[t==null?void 0:t.posId]);const p=async e=>{u(!0);try{const j=new URLSearchParams;j.append("position_addr",e);const _=(t==null?void 0:t.displayToken0.metadata)!==(t==null?void 0:t.token0.metadata),A=await(await fetch(`${c}?${j.toString()}`)).json();if(console.log("fetchHistoryData: ",A),A&&A.data&&A.data.list){const E=[],{package_id:g}=k.clmmPool,h=`${g.toLocaleLowerCase()}::pool::RemoveLiquidityEvent`,S=`${g.toLocaleLowerCase()}::pool::CollectFeeEvent`,V=`${g.toLocaleLowerCase()}::pool::AddLiquidityEvent`;A.data.list.forEach($=>{const o=JSON.parse($.event_data),b={event_type:"Remove Liquidity",block_time:o.block_time,tx:o.tx,sender:o.sender,position_addr:o.PositionAddr,pool_addr:o.PoolAddr,coin_change:[]};switch($.event_type){case h:case S:case V:let P="";$.event_type===h?(b.event_type="Remove Liquidity",P=""):$.event_type===S?(b.event_type="Claim Fees",P=""):$.event_type===V&&(b.event_type="Add Liquidity",P=""),m(o.AmountA).gt(0)&&b.coin_change.push({amount:`${P}${ne(ie(new ue(o.AmountA),t==null?void 0:t.token0.decimals))} ${ae(t==null?void 0:t.token0.symbol)}`,image:(t==null?void 0:t.token0.image)||"",isImportToken:d(t==null?void 0:t.token0.metadata)}),m(o.AmountB).gt(0)&&b.coin_change.push({amount:`${P}${ne(ie(new ue(o.AmountB),t==null?void 0:t.token1.decimals))} ${ae(t==null?void 0:t.token1.symbol)}`,image:(t==null?void 0:t.token1.image)||"",isImportToken:d(t==null?void 0:t.token1.metadata)}),b.coin_change.length>0&&(_&&(b.coin_change=b.coin_change.reverse()),E.push(b));break;case`${g.toLocaleLowerCase()}::pool::CollectRewardEvent`:b.event_type="Claim Rewards",JSON.parse(o.RewardAmounts).forEach(H=>{const B=H.value;if(m(B).greaterThan(0)){const z=s[H.key];z&&b.coin_change.push({amount:`${ne(ie(new ue(B),z.decimals))} ${z.symbol}`,image:z.image||""})}}),b.coin_change.length>0&&E.push(b);break;default:break}}),n(E)}else n([]);u(!1)}catch(j){console.log(j,"fetchHistoryData"),u(!1)}};return{loading:l,dataList:r,fetchHistoryData:p}}function Ot(k){const{id:s,pid:t,tab:c}=k;Le();const{windowWidth:r}=Be(),{address:n}=Ce(),[l,u]=x.useState("History"),{positionInfo:d,positionLoading:p,currentPoolInfo:e,setCurrentPoolInfo:j,setCurrentPositionTab:_,setRemovePercentage:T}=oe(),{loading:A,dataList:E,fetchHistoryData:g}=Qt(),{getPositionInfoData:h,getCurrentPoolInfo:S}=Ge();x.useEffect(()=>{S(!1)},[d==null?void 0:d.pool_address]),x.useEffect(()=>{T(50,50)},[]);const V=()=>{n&&s&&t&&(h(s,t),l==="Pools Stats"?S(!0):g(t))},$=o=>a.jsxs(G,{children:[a.jsx(Ye,{w:"50%",h:"56px",p:"8px",borderRadius:"16px",currentTab:l,textList:["History","Pools Stats"],onClick:b=>{u(b)}}),a.jsx(G,{h:"10px"}),l==="History"&&a.jsx(Ht,{loading:A,dataList:E,windowWidth:o}),l==="Pools Stats"&&a.jsx(Kt,{poolInfo:e})]});return a.jsxs(J,{w:"100%",h:"100%",direction:"column",position:"relative",children:[a.jsx(Ke,{}),a.jsx(Vt,{handleRefreshClick:V}),a.jsxs(J,{gap:"16px",mt:"24px",sx:{"@media screen and (max-width: 810px)":{flexDirection:"column"}},children:[a.jsxs(J,{gap:"16px",w:"60%",minW:"580px",flexDirection:"column",sx:{"@media screen and (max-width: 810px)":{w:"100%",minW:"unset"}},children:[a.jsx(ft,{pid:t}),a.jsx(gt,{}),r>810&&$(r)]}),a.jsxs(J,{w:"40%",gap:"16px",minW:"420px",flexDirection:"column",sx:{"@media screen and (max-width: 810px)":{w:"100%",minW:"unset"}},children:[a.jsx(Gt,{tab:c,onClickTab:o=>{_(o=="Increase"?"increase":"remove")}}),a.jsx(Zt,{tab:c})]})]}),r<=810&&a.jsx(G,{mt:"16px",children:$(r)}),p&&a.jsx(Mt,{w:"100%",h:"100%",position:"absolute",left:"0px",top:"0px",bg:"background",opacity:"0.4",children:a.jsx(Dt,{w:"80px",h:"80px",color:"primary",thickness:"4px"})})]})}function On(){const k=Le(),{positionObj:s,positionInfo:t,setPositionInfo:c,setPositionLoading:r,positionLoading:n,currentPositionTab:l,clearPositionStore:u}=oe(),{getPositionInfoData:d}=Ge();x.useEffect(()=>{window.scrollTo(0,0)},[]);const{id:p,pid:e}=Xe();x.useEffect(()=>{e&&(s!=null&&s[e])&&(c(s==null?void 0:s[e]),r(!1))},[e,s]),x.useEffect(()=>{p&&e&&d(p,e)},[p,e]),x.useEffect(()=>()=>{u()},[]);const j=()=>{if(p&&e&&l)return a.jsx(Ot,{tab:l,id:p,pid:e});k("/pools/position")},_=x.useMemo(()=>e&&p?!n&&e&&p&&!t:!1,[n,e,p,t]);return a.jsxs(G,{w:"100%",maxW:"100%",p:"10px 0px 0px",boxSizing:"content-box",children:[_&&a.jsx(G,{children:a.jsx(ye,{text:"Position unavailable",type:"nodata",h:"330px",child:a.jsx(we,{borderRadius:"8px",mt:"10px",w:"120px",h:"28px",fontSize:"xs",onClick:()=>{k("/pools/pool")},children:"Back to Pool"})})}),!_&&j()]})}export{On as default};
