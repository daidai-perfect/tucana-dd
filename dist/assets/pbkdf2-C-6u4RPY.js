import{c as f}from"./@improbable-eng-BU3rlaSz.js";import{s as A}from"./safe-buffer-B7h8REzA.js";import{p as O}from"./vite-plugin-node-polyfills-2b3IylRN.js";import{m as R}from"./create-hash-B2etqZ4B.js";import{r as q}from"./ripemd160-C1CpqImb.js";import{s as V}from"./sha.js-BDwlQsPx.js";var I={},Z=Math.pow(2,30)-1,K=function(r,e){if(typeof r!="number")throw new TypeError("Iterations not a number");if(r<0)throw new TypeError("Bad iterations");if(typeof e!="number")throw new TypeError("Key length not a number");if(e<0||e>Z||e!==e)throw new TypeError("Bad key length")},d;if(f.process&&f.process.browser)d="utf-8";else if(f.process&&f.process.version){var j=parseInt(O.version.split(".")[0].slice(1),10);d=j>=6?"utf-8":"binary"}else d="utf-8";var M=d,E=A.Buffer,F=function(r,e,t){if(E.isBuffer(r))return r;if(typeof r=="string")return E.from(r,e);if(ArrayBuffer.isView(r))return E.from(r.buffer);throw new TypeError(t+" must be a string, a Buffer, a typed array or a DataView")},G=R,X=q,J=V,h=A.Buffer,Q=K,x=M,$=F,W=h.alloc(128),l={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function U(r,e,t){var a=Y(r),o=r==="sha512"||r==="sha384"?128:64;e.length>o?e=a(e):e.length<o&&(e=h.concat([e,W],o));for(var n=h.allocUnsafe(o+l[r]),i=h.allocUnsafe(o+l[r]),s=0;s<o;s++)n[s]=e[s]^54,i[s]=e[s]^92;var u=h.allocUnsafe(o+t+4);n.copy(u,0,0,o),this.ipad1=u,this.ipad2=n,this.opad=i,this.alg=r,this.blocksize=o,this.hash=a,this.size=l[r]}U.prototype.run=function(r,e){r.copy(e,this.blocksize);var t=this.hash(e);return t.copy(this.opad,this.blocksize),this.hash(this.opad)};function Y(r){function e(a){return J(r).update(a).digest()}function t(a){return new X().update(a).digest()}return r==="rmd160"||r==="ripemd160"?t:r==="md5"?G:e}function k(r,e,t,a,o){Q(t,a),r=$(r,x,"Password"),e=$(e,x,"Salt"),o=o||"sha1";var n=new U(o,r,e.length),i=h.allocUnsafe(a),s=h.allocUnsafe(e.length+4);e.copy(s,0,0,e.length);for(var u=0,B=l[o],N=Math.ceil(a/B),w=1;w<=N;w++){s.writeUInt32BE(w,e.length);for(var b=n.run(s,n.ipad1),y=b,H=1;H<t;H++){y=n.run(y,n.ipad2);for(var v=0;v<B;v++)b[v]^=y[v]}b.copy(i,u),u+=B}return i}var L=k,_=A.Buffer,g=K,T=M,z=L,D=F,m,p=f.crypto&&f.crypto.subtle,rr={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},P=[];function er(r){if(f.process&&!f.process.browser||!p||!p.importKey||!p.deriveBits)return Promise.resolve(!1);if(P[r]!==void 0)return P[r];m=m||_.alloc(8);var e=C(m,m,10,128,r).then(function(){return!0}).catch(function(){return!1});return P[r]=e,e}var c;function S(){return c||(f.process&&f.process.nextTick?c=f.process.nextTick:f.queueMicrotask?c=f.queueMicrotask:f.setImmediate?c=f.setImmediate:c=f.setTimeout,c)}function C(r,e,t,a,o){return p.importKey("raw",r,{name:"PBKDF2"},!1,["deriveBits"]).then(function(n){return p.deriveBits({name:"PBKDF2",salt:e,iterations:t,hash:{name:o}},n,a<<3)}).then(function(n){return _.from(n)})}function or(r,e){r.then(function(t){S()(function(){e(null,t)})},function(t){S()(function(){e(t)})})}var tr=function(r,e,t,a,o,n){typeof o=="function"&&(n=o,o=void 0),o=o||"sha1";var i=rr[o.toLowerCase()];if(!i||typeof f.Promise!="function"){S()(function(){var s;try{s=z(r,e,t,a,o)}catch(u){return n(u)}n(null,s)});return}if(g(t,a),r=D(r,T,"Password"),e=D(e,T,"Salt"),typeof n!="function")throw new Error("No callback provided to pbkdf2");or(er(i).then(function(s){return s?C(r,e,t,a,i):z(r,e,t,a,o)}),n)};I.pbkdf2=tr;I.pbkdf2Sync=L;export{I as b};
